{
  "projectName": "Brain Dump",
  "projectPath": "/Users/salman.rana/code/brain-dump",
  "testingRequirements": [
    "Tests must validate user-facing behavior, not implementation details",
    "Focus on what users actually do - integration tests over unit tests",
    "Don't mock excessively - test real behavior where possible",
    "Coverage metrics are meaningless - user flow coverage is everything"
  ],
  "userStories": [
    {
      "id": "ed3637e8-e933-454a-bd98-76fa2e1ab31d",
      "title": "Add tool metadata system for categorization and context tagging",
      "passes": false,
      "overview": "",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "[object Object]",
        "[object Object]",
        "[object Object]",
        "[object Object]",
        "[object Object]",
        "[object Object]"
      ],
      "references": [],
      "description": "Add metadata to all MCP tools (categories, contexts, priority) to enable context-aware filtering. This is the foundation for reducing visible tool count.",
      "priority": "high",
      "tags": [
        "mcp-server",
        "architecture",
        "tool-management"
      ]
    },
    {
      "id": "e6029a26-66c6-4a3a-bd54-c7c5b3f78a4d",
      "title": "Implement context detection system",
      "passes": false,
      "overview": "",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "[object Object]",
        "[object Object]",
        "[object Object]",
        "[object Object]",
        "[object Object]",
        "[object Object]"
      ],
      "references": [],
      "description": "Detect active context (ticket_work, planning, review, admin) from ticket status, session state, and project state.",
      "priority": "high",
      "tags": [
        "mcp-server",
        "workflow",
        "context-detection"
      ]
    },
    {
      "id": "95a4ec09-2f70-4999-82a8-bfc54235f9c3",
      "title": "Implement context-aware tool filtering",
      "passes": false,
      "overview": "",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "[object Object]",
        "[object Object]",
        "[object Object]",
        "[object Object]",
        "[object Object]",
        "[object Object]",
        "[object Object]",
        "[object Object]"
      ],
      "references": [],
      "description": "Filter MCP tools based on active context, reducing visible tools from 65 to 10-15 per context.",
      "priority": "high",
      "tags": [
        "mcp-server",
        "tool-filtering",
        "performance"
      ]
    },
    {
      "id": "f9882660-72b8-452d-82a1-d52302c99f19",
      "title": "Create workflow shortcut tools",
      "passes": false,
      "overview": "",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "[object Object]",
        "[object Object]",
        "[object Object]",
        "[object Object]",
        "[object Object]",
        "[object Object]"
      ],
      "references": [],
      "description": "Add high-level workflow tools that combine common operations (e.g., quick_start_ticket combines start_ticket_work + telemetry + git linking).",
      "priority": "medium",
      "tags": [
        "mcp-server",
        "workflow",
        "shortcuts"
      ]
    },
    {
      "id": "db586c7a-8fa8-49fa-b64b-6de68ce81872",
      "title": "Add tool usage analytics",
      "passes": false,
      "overview": "",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "[object Object]",
        "[object Object]",
        "[object Object]",
        "[object Object]",
        "[object Object]",
        "[object Object]"
      ],
      "references": [],
      "description": "Track which tools are actually used to identify candidates for consolidation or removal.",
      "priority": "medium",
      "tags": [
        "mcp-server",
        "analytics",
        "tool-management"
      ]
    },
    {
      "id": "13a9f263-9527-4d68-987b-47adb4c7e146",
      "title": "Consolidate rarely-used tools",
      "passes": false,
      "overview": "",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "[object Object]",
        "[object Object]",
        "[object Object]",
        "[object Object]",
        "[object Object]",
        "[object Object]"
      ],
      "references": [],
      "description": "Based on usage analytics, merge or remove rarely-used tools to reduce total tool count.",
      "priority": "low",
      "tags": [
        "mcp-server",
        "consolidation",
        "cleanup"
      ]
    },
    {
      "id": "ee7e8310-b463-45f7-8d46-e1a475c19e71",
      "title": "Document context-aware tool usage patterns",
      "passes": false,
      "overview": "",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "[object Object]",
        "[object Object]",
        "[object Object]",
        "[object Object]",
        "[object Object]",
        "[object Object]"
      ],
      "references": [],
      "description": "Create comprehensive documentation explaining context-aware tool filtering and best practices.",
      "priority": "low",
      "tags": [
        "documentation",
        "mcp-server",
        "user-guide"
      ]
    },
    {
      "id": "e0f46ee7-0351-4548-8f7d-9c9345d7f294",
      "title": "Migrate MCP Server from JavaScript + JSDoc to TypeScript",
      "passes": false,
      "overview": "",
      "types": [],
      "designDecisions": [
        {
          "decision": "This Matters",
          "alternatives": [],
          "rationale": []
        }
      ],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "All `.js` files in `mcp-server/` converted to `.ts`",
        "`pnpm build` compiles without errors",
        "`pnpm type-check` passes (add to root package.json for mcp-server)",
        "All existing tests pass",
        "Claude Desktop config updated to use `build/index.js`",
        "`install.sh` runs `pnpm build` in mcp-server",
        "Documentation updated (CLAUDE.md, README)"
      ],
      "references": [
        "MCP TypeScript Server Quickstart: https://modelcontextprotocol.io/docs/develop/build-server#typescript",
        "MCP TypeScript Client Quickstart: https://modelcontextprotocol.io/docs/develop/build-client#typescript",
        "lib/*.js",
        "lib/*.ts"
      ],
      "description": "## Summary\n\nConvert the `mcp-server/` directory from JavaScript with JSDoc type annotations to proper TypeScript, following MCP's official documentation and best practices.\n\n## Why This Matters\n\n1. **MCP SDK is designed for TypeScript** - All official examples use TypeScript\n2. **JSDoc was never the intended pattern** - It was a historical shortcut that became tech debt\n3. **Better feedback loops** - Compile-time errors catch bugs before runtime\n4. **Type inference** - TypeScript's inference is far superior to JSDoc annotations\n5. **Refactoring safety** - Full compile-time checks across the codebase\n\n## Current State\n\n| Aspect | Current | Target |\n|--------|---------|--------|\n| Language | JavaScript + JSDoc | TypeScript |\n| Build step | None (direct execution) | `tsc` → `build/` |\n| Type safety | IDE hints only | Full compile-time |\n| Test files | Already TypeScript ✓ | TypeScript ✓ |\n\n## Migration Steps\n\n### 1. Add TypeScript dependencies\n```bash\ncd mcp-server\npnpm add -D typescript @types/node @types/better-sqlite3\n```\n\n### 2. Create `tsconfig.json` (per MCP docs)\n```json\n{\n  \"compilerOptions\": {\n    \"target\": \"ES2022\",\n    \"module\": \"Node16\",\n    \"moduleResolution\": \"Node16\",\n    \"outDir\": \"./build\",\n    \"rootDir\": \"./\",\n    \"strict\": true,\n    \"esModuleInterop\": true,\n    \"skipLibCheck\": true,\n    \"forceConsistentCasingInFileNames\": true\n  },\n  \"include\": [\"**/*.ts\"],\n  \"exclude\": [\"node_modules\", \"build\"]\n}\n```\n\n### 3. Update `package.json`\n```json\n{\n  \"scripts\": {\n    \"build\": \"tsc\",\n    \"start\": \"node build/index.js\"\n  }\n}\n```\n\n### 4. Rename files\n- `index.js` → `index.ts`\n- `lib/*.js` → `lib/*.ts`\n- `tools/*.js` → `tools/*.ts`\n\n### 5. Let TypeScript read existing JSDoc\nTypeScript will automatically infer types from JSDoc comments during migration.\n\n### 6. Update Claude Desktop config\nPoint to `build/index.js` instead of `index.js`\n\n### 7. Update install scripts\nAdd `pnpm build` step to `install.sh`\n\n## Acceptance Criteria\n\n- [ ] All `.js` files in `mcp-server/` converted to `.ts`\n- [ ] `pnpm build` compiles without errors\n- [ ] `pnpm type-check` passes (add to root package.json for mcp-server)\n- [ ] All existing tests pass\n- [ ] Claude Desktop config updated to use `build/index.js`\n- [ ] `install.sh` runs `pnpm build` in mcp-server\n- [ ] Documentation updated (CLAUDE.md, README)\n\n## Reference\n\n- MCP TypeScript Server Quickstart: https://modelcontextprotocol.io/docs/develop/build-server#typescript\n- MCP TypeScript Client Quickstart: https://modelcontextprotocol.io/docs/develop/build-client#typescript",
      "priority": "medium",
      "tags": [
        "typescript",
        "mcp",
        "tech-debt",
        "dx"
      ]
    },
    {
      "id": "6991c44f-1ca7-4429-86bf-ef2328665238",
      "title": "Add settings UI for context-aware tool filtering opt-in",
      "passes": false,
      "overview": "",
      "types": [],
      "designDecisions": [
        {
          "decision": "This Matters",
          "alternatives": [
            "Users should be able to disable filtering if it causes issues",
            "Filtering is a new behavior that changes the tools visible to LLMs",
            "Backward compatibility: existing workflows should work without changes"
          ],
          "rationale": []
        }
      ],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "Settings schema includes `enableContextAwareToolFiltering` boolean field (default: false)",
        "Migration file created for new settings field",
        "SettingsModal has toggle for enabling/disabling context-aware filtering",
        "Setting persists correctly when saved",
        "MCP server reads setting and respects it (bypass filtering when disabled)",
        "Default behavior (filtering disabled) matches current tool exposure",
        "Help text explains what context-aware filtering does and its benefits"
      ],
      "references": [
        "Proposal: `docs/mcp-tool-consolidation-proposal.md`",
        "Depends on: Context detection system and tool filtering being implemented first"
      ],
      "description": "## Summary\n\nAdd a setting in the Settings UI to enable/disable context-aware MCP tool filtering. Per the proposal, filtering should be \"opt-in via settings\" to maintain backward compatibility.\n\n## Why This Matters\n\n- Users should be able to disable filtering if it causes issues\n- Filtering is a new behavior that changes the tools visible to LLMs\n- Backward compatibility: existing workflows should work without changes\n\n## Implementation\n\n### Database/Schema Changes\n- Add `enableContextAwareToolFiltering` boolean field to settings table (default: false)\n- Add migration for the new field\n\n### Settings UI Changes (EnterpriseTab or new \"MCP\" tab)\n- Add toggle: \"Enable Context-Aware Tool Filtering\"\n- Add description explaining what it does\n- Add tooltip or help text with examples\n\n### MCP Server Changes\n- Read setting from database in context filter function\n- If disabled, return all tools (current behavior)\n- If enabled, apply context filtering logic\n\n## Acceptance Criteria\n\n- [ ] Settings schema includes `enableContextAwareToolFiltering` boolean field (default: false)\n- [ ] Migration file created for new settings field\n- [ ] SettingsModal has toggle for enabling/disabling context-aware filtering\n- [ ] Setting persists correctly when saved\n- [ ] MCP server reads setting and respects it (bypass filtering when disabled)\n- [ ] Default behavior (filtering disabled) matches current tool exposure\n- [ ] Help text explains what context-aware filtering does and its benefits\n\n## References\n\n- Proposal: `docs/mcp-tool-consolidation-proposal.md`\n- Depends on: Context detection system and tool filtering being implemented first",
      "priority": "medium",
      "tags": [
        "settings",
        "ui",
        "mcp-server",
        "feature-flag"
      ]
    },
    {
      "id": "f4c0491d-9aba-4b34-8c21-5f64691f74a9",
      "title": "Integration testing for context-aware tool system",
      "passes": false,
      "overview": "",
      "types": [],
      "designDecisions": [
        {
          "decision": "This Matters",
          "alternatives": [
            "Tool filtering directly affects LLM tool selection",
            "Incorrect filtering could hide critical tools or expose too many",
            "Must validate context detection accuracy",
            "Must verify shortcut tools work correctly",
            "Performance benchmarking needed for metrics"
          ],
          "rationale": []
        }
      ],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "Detects `ticket_work` context when ticket is in_progress",
        "Detects `ai_review` context when ticket is in ai_review status",
        "Detects `human_review` context when ticket is in human_review status",
        "Detects `planning` context when no active ticket",
        "Detects `admin` context when explicitly requested",
        "Handles missing/corrupted ralph-state.json gracefully",
        "High-priority tools always visible regardless of context",
        "Workflow tools visible in ticket_work context",
        "Review tools visible in ai_review context",
        "Admin tools hidden unless in admin context",
        "Telemetry tools hidden unless explicitly needed",
        "Tool count reduced from 65 to expected range (10-15) per context",
        "`quick_start_ticket` combines all expected operations",
        "`quick_complete_ticket` combines all expected operations",
        "Shortcut tools handle errors in component operations gracefully",
        "Backward compatibility: individual tools still work",
        "Filtering disabled by default",
        "Enabling filtering changes tool visibility",
        "Setting persists across MCP server restarts",
        "Hot reload of setting (if supported)",
        "Measure tool selection time with filtering enabled vs disabled",
        "Measure token usage in tool descriptions with filtering",
        "Document baseline metrics for comparison",
        "Test file(s) created with all scenarios above",
        "All context detection scenarios have passing tests",
        "All tool filtering scenarios have passing tests",
        "Shortcut tool tests pass",
        "Performance benchmarks documented with baseline numbers",
        "Tests run as part of `pnpm test` suite",
        "CI/CD integration (if applicable)"
      ],
      "references": [
        "Proposal: `docs/mcp-tool-consolidation-proposal.md`",
        "Depends on: All feature tickets completed",
        "mcp-server/__tests__/"
      ],
      "description": "## Summary\n\nCreate comprehensive integration tests for the context-aware tool filtering system to validate it works correctly across different workflow scenarios.\n\n## Why This Matters\n\n- Tool filtering directly affects LLM tool selection\n- Incorrect filtering could hide critical tools or expose too many\n- Must validate context detection accuracy\n- Must verify shortcut tools work correctly\n- Performance benchmarking needed for metrics\n\n## Test Scenarios\n\n### Context Detection Tests\n- [ ] Detects `ticket_work` context when ticket is in_progress\n- [ ] Detects `ai_review` context when ticket is in ai_review status\n- [ ] Detects `human_review` context when ticket is in human_review status\n- [ ] Detects `planning` context when no active ticket\n- [ ] Detects `admin` context when explicitly requested\n- [ ] Handles missing/corrupted ralph-state.json gracefully\n\n### Tool Filtering Tests\n- [ ] High-priority tools always visible regardless of context\n- [ ] Workflow tools visible in ticket_work context\n- [ ] Review tools visible in ai_review context\n- [ ] Admin tools hidden unless in admin context\n- [ ] Telemetry tools hidden unless explicitly needed\n- [ ] Tool count reduced from 65 to expected range (10-15) per context\n\n### Shortcut Tool Tests\n- [ ] `quick_start_ticket` combines all expected operations\n- [ ] `quick_complete_ticket` combines all expected operations\n- [ ] Shortcut tools handle errors in component operations gracefully\n- [ ] Backward compatibility: individual tools still work\n\n### Settings Integration Tests\n- [ ] Filtering disabled by default\n- [ ] Enabling filtering changes tool visibility\n- [ ] Setting persists across MCP server restarts\n- [ ] Hot reload of setting (if supported)\n\n### Performance Benchmarks\n- [ ] Measure tool selection time with filtering enabled vs disabled\n- [ ] Measure token usage in tool descriptions with filtering\n- [ ] Document baseline metrics for comparison\n\n## Implementation Notes\n\n- Tests should follow Kent C. Dodds philosophy (test user behavior, not implementation)\n- Use real database fixtures\n- Integration tests in `mcp-server/__tests__/` or similar\n\n## Acceptance Criteria\n\n- [ ] Test file(s) created with all scenarios above\n- [ ] All context detection scenarios have passing tests\n- [ ] All tool filtering scenarios have passing tests\n- [ ] Shortcut tool tests pass\n- [ ] Performance benchmarks documented with baseline numbers\n- [ ] Tests run as part of `pnpm test` suite\n- [ ] CI/CD integration (if applicable)\n\n## References\n\n- Proposal: `docs/mcp-tool-consolidation-proposal.md`\n- Depends on: All feature tickets completed",
      "priority": "medium",
      "tags": [
        "testing",
        "integration-tests",
        "mcp-server",
        "quality"
      ]
    },
    {
      "id": "a74cc6a7-6e8f-479d-acbe-f8de665c358f",
      "title": "Split MCP server into modular servers",
      "passes": false,
      "overview": "",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "`mcp-server/index-core.js` entry point with ~10 core tools",
        "`mcp-server/index-workflow.js` entry point with ~8 workflow tools",
        "`mcp-server/index-telemetry.js` entry point with ~7 telemetry tools",
        "`mcp-server/index-admin.js` entry point with ~10 admin tools",
        "Shared lib imports work across all entry points",
        "Each server can be started independently",
        "Install script updated to configure modular servers",
        "Documentation updated with server descriptions"
      ],
      "references": [
        "mcp-server/index-core.js",
        "mcp-server/index-workflow.js",
        "mcp-server/index-telemetry.js",
        "mcp-server/index-admin.js"
      ],
      "description": "## Summary\n\nRefactor the monolithic MCP server into four modular servers to reduce tool count per context and improve maintainability.\n\n## Target Architecture\n\n| Server | Tools | Purpose | When Configured |\n|--------|-------|---------|-----------------|\n| `brain-dump-core` | ~10 | Essential project/ticket/epic CRUD | Always |\n| `brain-dump-workflow` | ~8 | Ticket work lifecycle | During ticket work |\n| `brain-dump-telemetry` | ~7 | Internal telemetry capture | Hooks only |\n| `brain-dump-admin` | ~10 | Compliance, cleanup, settings | Admin tasks |\n\n## Tool Distribution\n\n### brain-dump-core (~10 tools)\n- list_projects, find_project_by_path, create_project\n- create_ticket, list_tickets, update_ticket_status\n- list_epics, create_epic\n- add_ticket_comment, get_ticket_comments\n\n### brain-dump-workflow (~8 tools)\n- start_ticket_work, complete_ticket_work\n- start_epic_work\n- link_commit_to_ticket, link_pr_to_ticket, sync_ticket_links\n- update_acceptance_criterion\n- submit_review_finding, mark_finding_fixed, check_review_complete\n- generate_demo_script\n\n### brain-dump-telemetry (~7 tools)\n- start_telemetry_session, end_telemetry_session\n- log_prompt_event, log_tool_event, log_context_event\n- get_telemetry_session, list_telemetry_sessions\n\n### brain-dump-admin (~10 tools)\n- start_conversation_session, end_conversation_session\n- export_compliance_logs, archive_old_sessions\n- get_database_health, cleanup_worktrees\n- delete_project, delete_ticket, delete_epic\n- get/update settings\n\n## Implementation Approach\n\n1. Create shared lib module for database, logging, utilities\n2. Create separate entry points: `index-core.js`, `index-workflow.js`, etc.\n3. Each server imports only its tools\n4. Update package.json with multiple bin entries\n5. Create unified install script that configures appropriate servers\n\n## Acceptance Criteria\n\n- [ ] `mcp-server/index-core.js` entry point with ~10 core tools\n- [ ] `mcp-server/index-workflow.js` entry point with ~8 workflow tools\n- [ ] `mcp-server/index-telemetry.js` entry point with ~7 telemetry tools\n- [ ] `mcp-server/index-admin.js` entry point with ~10 admin tools\n- [ ] Shared lib imports work across all entry points\n- [ ] Each server can be started independently\n- [ ] Install script updated to configure modular servers\n- [ ] Documentation updated with server descriptions\n\n## Dependencies\n\n- Depends on: TypeScript migration (should complete first for cleaner refactor)\n- Blocks: Claude Code plugin creation, provider-specific configs",
      "priority": "high",
      "tags": [
        "mcp-server",
        "architecture",
        "modular",
        "refactor"
      ]
    },
    {
      "id": "b147ec6d-e302-46b9-a59d-1261f2a0df90",
      "title": "Create composite workflow tools",
      "passes": false,
      "overview": "",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "`start_work` tool implemented combining 3 operations",
        "`complete_work` tool implemented combining 3 operations",
        "`submit_review` tool implemented for bulk finding submission",
        "Rollback/cleanup on partial failures",
        "Individual tools still work independently",
        "Tool descriptions recommend composite tools for common workflows",
        "Tests for composite tool success and failure scenarios",
        "Documentation explains when to use composite vs individual tools"
      ],
      "references": [
        "Original proposal: `docs/mcp-tool-consolidation-proposal.md`",
        "Existing shortcut ticket: f9882660-72b8-452d-82a1-d52302c99f19"
      ],
      "description": "## Summary\n\nCreate higher-level composite tools that combine common multi-step operations into single tool calls, reducing the number of tool calls needed for standard workflows.\n\n## Composite Tools to Create\n\n### 1. `start_work` (combines 3 operations)\n```\nstart_ticket_work + create_ralph_session + start_telemetry_session\n```\n\n**Input:**\n- ticketId: string\n- createTelemetrySession: boolean (default: true)\n\n**Output:**\n- Branch name\n- Ticket context\n- Session IDs (ralph, telemetry)\n- Working directory (worktree path if applicable)\n\n### 2. `complete_work` (combines 3 operations)\n```\ncomplete_ticket_work + sync_ticket_links + end_telemetry_session\n```\n\n**Input:**\n- ticketId: string\n- summary: string (work summary)\n\n**Output:**\n- Ticket status\n- Linked commits/PRs\n- Session summary\n\n### 3. `submit_review` (combines review workflow)\n```\nsubmit_review_finding + check_review_complete (conditional)\n```\n\n**Input:**\n- ticketId: string\n- findings: array of { agent, severity, category, description, filePath?, suggestedFix? }\n\n**Output:**\n- Created findings\n- Review completion status\n- Next steps guidance\n\n## Implementation Notes\n\n- Composite tools should be atomic where possible (rollback on failure)\n- Individual tools remain available for fine-grained control\n- Composite tools should clearly document what they combine\n- Tool descriptions should recommend composite tools for standard workflows\n\n## Acceptance Criteria\n\n- [ ] `start_work` tool implemented combining 3 operations\n- [ ] `complete_work` tool implemented combining 3 operations\n- [ ] `submit_review` tool implemented for bulk finding submission\n- [ ] Rollback/cleanup on partial failures\n- [ ] Individual tools still work independently\n- [ ] Tool descriptions recommend composite tools for common workflows\n- [ ] Tests for composite tool success and failure scenarios\n- [ ] Documentation explains when to use composite vs individual tools\n\n## References\n\n- Original proposal: `docs/mcp-tool-consolidation-proposal.md`\n- Existing shortcut ticket: f9882660-72b8-452d-82a1-d52302c99f19",
      "priority": "high",
      "tags": [
        "mcp-server",
        "workflow",
        "composite-tools",
        "dx"
      ]
    },
    {
      "id": "0dc9b35d-4f82-40a7-8265-2dd45c54dbd1",
      "title": "Create Claude Code plugin package structure",
      "passes": false,
      "overview": "",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "Plugin directory structure created under `.claude/plugins/brain-dump-workflow/`",
        "plugin.json manifest with all components listed",
        "Skills moved and working (next-task, review, demo, reconcile)",
        "Agents moved and working (3 review agents)",
        "Hooks moved and working (state enforcement, telemetry, auto-pr)",
        "MCP config included in plugin",
        "Install script creates proper symlinks",
        "Uninstall script removes plugin cleanly",
        "Documentation updated with plugin usage"
      ],
      "references": [],
      "description": "## Summary\n\nPackage Brain Dump's Claude Code integration as a proper plugin with skills, agents, hooks, and MCP server configs. This creates a unified, installable plugin experience.\n\n## Target Structure\n\n```\n.claude/plugins/brain-dump-workflow/\n├── plugin.json              # Plugin manifest\n├── SKILL.md                 # Main plugin skill (workflow guidance)\n├── skills/\n│   ├── next-task/SKILL.md   # /next-task skill\n│   ├── review/SKILL.md      # /review skill\n│   ├── demo/SKILL.md        # /demo skill\n│   └── reconcile/SKILL.md   # /reconcile-learnings skill\n├── agents/\n│   ├── code-reviewer.md     # Code review agent\n│   ├── silent-failure-hunter.md\n│   └── code-simplifier.md\n├── hooks/\n│   ├── enforce-state.sh     # State enforcement hook\n│   ├── telemetry.sh         # Telemetry capture hooks\n│   └── auto-pr.sh           # Auto PR creation hooks\n├── commands/\n│   ├── review.md            # /review command\n│   ├── next-task.md         # /next-task command\n│   └── demo.md              # /demo command\n└── mcp/\n    └── brain-dump.json      # MCP server config for Claude Code\n```\n\n## Plugin Manifest (plugin.json)\n\n```json\n{\n  \"name\": \"brain-dump-workflow\",\n  \"version\": \"1.0.0\",\n  \"description\": \"AI-assisted ticket workflow with quality gates\",\n  \"author\": \"Brain Dump\",\n  \"skills\": [\"next-task\", \"review\", \"demo\", \"reconcile\"],\n  \"agents\": [\"code-reviewer\", \"silent-failure-hunter\", \"code-simplifier\"],\n  \"hooks\": [\"enforce-state\", \"telemetry\", \"auto-pr\"],\n  \"mcp\": {\n    \"servers\": [\"brain-dump-core\", \"brain-dump-workflow\"]\n  }\n}\n```\n\n## Implementation Steps\n\n1. Create plugin directory structure\n2. Move existing skills from `.claude/skills/` to plugin\n3. Move existing agents from `.claude/agents/` to plugin\n4. Move existing hooks from `.claude/hooks/` to plugin\n5. Create plugin.json manifest\n6. Create install script that symlinks plugin to `~/.claude/plugins/`\n7. Update CLAUDE.md with plugin usage instructions\n\n## Acceptance Criteria\n\n- [ ] Plugin directory structure created under `.claude/plugins/brain-dump-workflow/`\n- [ ] plugin.json manifest with all components listed\n- [ ] Skills moved and working (next-task, review, demo, reconcile)\n- [ ] Agents moved and working (3 review agents)\n- [ ] Hooks moved and working (state enforcement, telemetry, auto-pr)\n- [ ] MCP config included in plugin\n- [ ] Install script creates proper symlinks\n- [ ] Uninstall script removes plugin cleanly\n- [ ] Documentation updated with plugin usage\n\n## Dependencies\n\n- Depends on: Modular MCP server split (for clean MCP configs)\n- Related to: Provider-specific configs ticket",
      "priority": "high",
      "tags": [
        "claude-code",
        "plugin",
        "packaging",
        "dx"
      ]
    },
    {
      "id": "724c195c-ff21-4701-b27f-15d3af3c60f1",
      "title": "Create provider-specific configuration packages",
      "passes": false,
      "overview": "",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "`.cursor/` directory with rules.md, mcp.json, and prompts",
        "`.opencode/` directory with config.yaml, mcp.json, and skills",
        "`.vscode/` directory with mcp.json and settings",
        "Install script detects and configures each environment",
        "MCP servers work correctly from each environment",
        "Workflow guidance appropriate for each environment",
        "Documentation for each provider's setup"
      ],
      "references": [],
      "description": "## Summary\n\nCreate configuration packages for different AI coding environments (Cursor, OpenCode, VS Code) that provide the same workflow capabilities as the Claude Code plugin.\n\n## Target Structure\n\n### Cursor (.cursor/)\n```\n.cursor/\n├── rules.md                  # Cursor rules file (like CLAUDE.md)\n├── mcp.json                  # MCP server config\n└── prompts/\n    ├── workflow.md           # Workflow guidance prompt\n    └── review.md             # Review guidance prompt\n```\n\n### OpenCode (.opencode/)\n```\n.opencode/\n├── config.yaml               # OpenCode config\n├── mcp.json                  # MCP server config\n└── skills/\n    ├── next-task.md\n    ├── review.md\n    └── demo.md\n```\n\n### VS Code (.vscode/)\n```\n.vscode/\n├── mcp.json                  # MCP server config for Copilot/Continue\n├── settings.json             # VS Code settings (if needed)\n└── tasks.json                # Task definitions for workflow\n```\n\n## MCP Configuration Pattern\n\nEach provider needs an mcp.json that configures:\n1. brain-dump-core server (always)\n2. brain-dump-workflow server (for ticket work)\n\n```json\n{\n  \"mcpServers\": {\n    \"brain-dump-core\": {\n      \"command\": \"node\",\n      \"args\": [\"~/.brain-dump/mcp-server/index-core.js\"],\n      \"env\": {}\n    },\n    \"brain-dump-workflow\": {\n      \"command\": \"node\", \n      \"args\": [\"~/.brain-dump/mcp-server/index-workflow.js\"],\n      \"env\": {}\n    }\n  }\n}\n```\n\n## Cursor Rules Content\n\nThe rules.md should include:\n- Workflow status flow (backlog -> ready -> in_progress -> ai_review -> human_review -> done)\n- Required MCP tool calls for each phase\n- Review requirements before PR\n- DO/DON'T guidelines adapted from CLAUDE.md\n\n## Install Script Updates\n\n`scripts/install.sh` should:\n1. Detect installed environments\n2. Copy appropriate config to each environment's config location\n3. Verify MCP server is accessible\n4. Run health check\n\n## Acceptance Criteria\n\n- [ ] `.cursor/` directory with rules.md, mcp.json, and prompts\n- [ ] `.opencode/` directory with config.yaml, mcp.json, and skills\n- [ ] `.vscode/` directory with mcp.json and settings\n- [ ] Install script detects and configures each environment\n- [ ] MCP servers work correctly from each environment\n- [ ] Workflow guidance appropriate for each environment\n- [ ] Documentation for each provider's setup\n\n## Dependencies\n\n- Depends on: Modular MCP server split\n- Related to: Claude Code plugin package",
      "priority": "medium",
      "tags": [
        "multi-provider",
        "cursor",
        "vscode",
        "opencode",
        "configuration"
      ]
    },
    {
      "id": "225d2d18-3651-4570-9c6f-771c956100cd",
      "title": "Add explicit mode selection for tool filtering",
      "passes": false,
      "overview": "",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [
        {
          "step": 1,
          "description": "Mode Setting Tool",
          "files": [],
          "codeTemplate": "server.tool(\"set_tool_mode\", {\n  mode: z.enum([\"all\", \"core\", \"workflow\", \"review\", \"admin\", \"auto\"]),\n  persist: z.boolean().default(false),  // Save to settings\n}, async ({ mode, persist }) => {\n  // Update current session mode\n  // Optionally persist to database\n  // Emit tools/list_changed notification\n});"
        },
        {
          "step": 2,
          "description": "Mode Detection in Tool Listing",
          "files": [],
          "codeTemplate": "// In tools/list handler\nconst currentMode = getToolMode();  // From session or settings\n\nif (currentMode === \"auto\") {\n  // Use context detection (ticket status, etc.)\n  return filterToolsByContext(allTools, detectContext());\n} else if (currentMode === \"all\") {\n  return allTools;\n} else {\n  return filterToolsByMode(allTools, currentMode);\n}"
        },
        {
          "step": 3,
          "description": "Settings Integration",
          "files": []
        },
        {
          "step": 4,
          "description": "Session-Level Override",
          "files": []
        },
        {
          "step": 4,
          "description": "Session-Level Override",
          "files": []
        }
      ],
      "acceptanceCriteria": [
        "`set_tool_mode` tool implemented",
        "`get_tool_mode` tool implemented",
        "Mode filtering applied in tools/list",
        "Settings UI for default mode",
        "Session-level mode override works",
        "`auto` mode falls back to context detection",
        "Mode persists correctly when requested",
        "Tests for each mode's tool filtering"
      ],
      "references": [],
      "description": "## Summary\n\nPer agent review findings, implement explicit mode selection for context-aware tool filtering instead of relying solely on auto-detection. This gives users control and makes behavior predictable.\n\n## Modes\n\n| Mode | Description | Tool Set |\n|------|-------------|----------|\n| `all` | No filtering (current behavior) | All 65 tools |\n| `core` | Basic operations only | ~10 core tools |\n| `workflow` | Active ticket work | ~18 workflow + core tools |\n| `review` | AI review phase | ~12 review + core tools |\n| `admin` | Administrative tasks | ~20 admin + core tools |\n| `auto` | Auto-detect from context | Dynamic based on ticket status |\n\n## Implementation\n\n### 1. Mode Setting Tool\n```javascript\nserver.tool(\"set_tool_mode\", {\n  mode: z.enum([\"all\", \"core\", \"workflow\", \"review\", \"admin\", \"auto\"]),\n  persist: z.boolean().default(false),  // Save to settings\n}, async ({ mode, persist }) => {\n  // Update current session mode\n  // Optionally persist to database\n  // Emit tools/list_changed notification\n});\n```\n\n### 2. Mode Detection in Tool Listing\n```javascript\n// In tools/list handler\nconst currentMode = getToolMode();  // From session or settings\n\nif (currentMode === \"auto\") {\n  // Use context detection (ticket status, etc.)\n  return filterToolsByContext(allTools, detectContext());\n} else if (currentMode === \"all\") {\n  return allTools;\n} else {\n  return filterToolsByMode(allTools, currentMode);\n}\n```\n\n### 3. Settings Integration\n- Add `defaultToolMode` to settings table\n- UI toggle in Settings modal\n- Per-project override option\n\n### 4. Session-Level Override\n- Mode can be set per-session without persisting\n- Useful for temporary admin tasks\n- Resets on session end\n\n## Acceptance Criteria\n\n- [ ] `set_tool_mode` tool implemented\n- [ ] `get_tool_mode` tool implemented\n- [ ] Mode filtering applied in tools/list\n- [ ] Settings UI for default mode\n- [ ] Session-level mode override works\n- [ ] `auto` mode falls back to context detection\n- [ ] Mode persists correctly when requested\n- [ ] Tests for each mode's tool filtering\n\n## Dependencies\n\n- Depends on: Tool metadata system (for categorization)\n- Related to: Context detection system, shadow mode",
      "priority": "high",
      "tags": [
        "mcp-server",
        "tool-filtering",
        "mode-selection",
        "dx"
      ]
    },
    {
      "id": "2e6a823f-b0e5-46de-aa42-106f6e0e416a",
      "title": "Add shadow mode for safe tool filtering testing",
      "passes": false,
      "overview": "",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [
        {
          "step": 1,
          "description": "Shadow Mode Setting",
          "files": [],
          "codeTemplate": "// In settings\nshadowModeEnabled: boolean;  // default: false\nshadowModeStartedAt: string | null;  // ISO timestamp"
        },
        {
          "step": 2,
          "description": "Shadow Mode Logging",
          "files": [],
          "codeTemplate": "// In tool call handler\nif (shadowModeEnabled) {\n  const wouldBeFiltered = !filterToolsByContext(tools, context).includes(tool);\n  if (wouldBeFiltered) {\n    log.info(`[SHADOW] Tool '${toolName}' called but would be filtered in mode '${mode}'`);\n    // Record to telemetry\n    recordShadowModeHit(toolName, context, mode);\n  }\n}"
        },
        {
          "step": 3,
          "description": "Shadow Mode Analytics",
          "files": [],
          "codeTemplate": "server.tool(\"get_shadow_mode_stats\", {}, async () => {\n  return {\n    enabled: shadowModeEnabled,\n    startedAt: shadowModeStartedAt,\n    totalCalls: count,\n    wouldBeFilteredCalls: filteredCount,\n    byTool: { /* tool -> count of would-be-filtered */ },\n    recommendation: filteredCount === 0 \n      ? \"Safe to enable filtering - no hidden tools were used\"\n      : \"Review tools that would be hidden before enabling filtering\"\n  };\n});"
        },
        {
          "step": 4,
          "description": "UI Dashboard",
          "files": []
        },
        {
          "step": 4,
          "description": "UI Dashboard",
          "files": []
        }
      ],
      "acceptanceCriteria": [
        "Shadow mode toggle in settings",
        "Tool calls logged when would be filtered",
        "`get_shadow_mode_stats` tool implemented",
        "Statistics stored in database",
        "UI shows shadow mode status and stats",
        "Clear recommendation based on usage",
        "Shadow mode can run for configurable duration",
        "Documentation explains shadow mode workflow"
      ],
      "references": [],
      "description": "## Summary\n\nPer agent review findings, implement a \"shadow mode\" that logs what would be filtered without actually filtering. This allows safe validation of filtering rules before enabling them.\n\n## Shadow Mode Behavior\n\nWhen shadow mode is enabled:\n1. All tools remain visible (no actual filtering)\n2. Each tool call logs whether it would have been filtered\n3. Summary statistics track \"would-be-filtered\" calls\n4. Alerts when a tool that would be hidden is actually used\n\n## Implementation\n\n### 1. Shadow Mode Setting\n```typescript\n// In settings\nshadowModeEnabled: boolean;  // default: false\nshadowModeStartedAt: string | null;  // ISO timestamp\n```\n\n### 2. Shadow Mode Logging\n```javascript\n// In tool call handler\nif (shadowModeEnabled) {\n  const wouldBeFiltered = !filterToolsByContext(tools, context).includes(tool);\n  if (wouldBeFiltered) {\n    log.info(`[SHADOW] Tool '${toolName}' called but would be filtered in mode '${mode}'`);\n    // Record to telemetry\n    recordShadowModeHit(toolName, context, mode);\n  }\n}\n```\n\n### 3. Shadow Mode Analytics\n```javascript\nserver.tool(\"get_shadow_mode_stats\", {}, async () => {\n  return {\n    enabled: shadowModeEnabled,\n    startedAt: shadowModeStartedAt,\n    totalCalls: count,\n    wouldBeFilteredCalls: filteredCount,\n    byTool: { /* tool -> count of would-be-filtered */ },\n    recommendation: filteredCount === 0 \n      ? \"Safe to enable filtering - no hidden tools were used\"\n      : \"Review tools that would be hidden before enabling filtering\"\n  };\n});\n```\n\n### 4. UI Dashboard\n- Shadow mode toggle in Settings\n- Statistics display showing:\n  - Days in shadow mode\n  - Tools that would be hidden but were used\n  - Recommendation for enabling filtering\n\n## Workflow\n\n1. Enable shadow mode (all tools visible)\n2. Work normally for 1-2 weeks\n3. Review shadow mode stats\n4. Adjust filtering rules if needed\n5. Enable actual filtering with confidence\n\n## Acceptance Criteria\n\n- [ ] Shadow mode toggle in settings\n- [ ] Tool calls logged when would be filtered\n- [ ] `get_shadow_mode_stats` tool implemented\n- [ ] Statistics stored in database\n- [ ] UI shows shadow mode status and stats\n- [ ] Clear recommendation based on usage\n- [ ] Shadow mode can run for configurable duration\n- [ ] Documentation explains shadow mode workflow\n\n## Dependencies\n\n- Depends on: Tool metadata system, context detection\n- Should be implemented before: Actual filtering enablement",
      "priority": "medium",
      "tags": [
        "mcp-server",
        "tool-filtering",
        "shadow-mode",
        "testing",
        "safety"
      ]
    },
    {
      "id": "7c39dd14-02ec-4770-88e1-364aea2dc9b2",
      "title": "Add circuit breakers and feature flags for tool filtering",
      "passes": false,
      "overview": "",
      "types": [
        {
          "name": "FeatureFlags",
          "code": "interface FeatureFlags {\n  enableToolFiltering: boolean;\n  enableModularServers: boolean;\n  enableShadowMode: boolean;\n  enableCompositeTools: boolean;\n  maxToolsPerContext: number;\n}"
        },
        {
          "name": "CircuitBreakerState",
          "code": "interface CircuitBreakerState {\n  state: \"closed\" | \"open\" | \"half-open\";\n  failures: number;\n  lastFailure: string | null;\n  lastReset: string | null;\n}"
        }
      ],
      "designDecisions": [],
      "implementationGuide": [
        {
          "step": 1,
          "description": "Feature Flag Storage",
          "files": [],
          "codeTemplate": "// In settings table\ninterface FeatureFlags {\n  enableToolFiltering: boolean;\n  enableModularServers: boolean;\n  enableShadowMode: boolean;\n  enableCompositeTools: boolean;\n  maxToolsPerContext: number;\n}"
        },
        {
          "step": 2,
          "description": "Circuit Breaker State",
          "files": [],
          "codeTemplate": "// In database or memory\ninterface CircuitBreakerState {\n  state: \"closed\" | \"open\" | \"half-open\";\n  failures: number;\n  lastFailure: string | null;\n  lastReset: string | null;\n}"
        },
        {
          "step": 3,
          "description": "MCP Tool for Flag Management",
          "files": [],
          "codeTemplate": "server.tool(\"manage_feature_flags\", {\n  action: z.enum([\"get\", \"set\", \"reset\"]),\n  flag: z.string().optional(),\n  value: z.boolean().optional(),\n}, async ({ action, flag, value }) => {\n  // Get/set/reset feature flags\n});"
        },
        {
          "step": 4,
          "description": "Circuit Breaker Status Tool",
          "files": [],
          "codeTemplate": "server.tool(\"get_circuit_breaker_status\", {}, async () => {\n  return {\n    toolFiltering: circuitBreakerState,\n    recentErrors: lastNErrors,\n    recommendation: state === \"open\" \n      ? \"Filtering disabled due to errors. Review logs before re-enabling.\"\n      : \"Filtering operational.\"\n  };\n});"
        },
        {
          "step": 4,
          "description": "Circuit Breaker Status Tool",
          "files": [],
          "codeTemplate": "server.tool(\"get_circuit_breaker_status\", {}, async () => {\n  return {\n    toolFiltering: circuitBreakerState,\n    recentErrors: lastNErrors,\n    recommendation: state === \"open\" \n      ? \"Filtering disabled due to errors. Review logs before re-enabling.\"\n      : \"Filtering operational.\"\n  };\n});"
        }
      ],
      "acceptanceCriteria": [
        "Feature flags stored in settings table",
        "`manage_feature_flags` tool implemented",
        "Circuit breaker pattern for tool filtering",
        "Automatic disable on repeated failures",
        "Automatic retry after cooldown period",
        "UI for viewing/managing feature flags",
        "Logging for circuit breaker state changes",
        "Tests for circuit breaker transitions"
      ],
      "references": [],
      "description": "## Summary\n\nPer agent review findings, implement circuit breakers and feature flags to safely roll out tool filtering with automatic fallback mechanisms.\n\n## Circuit Breaker Pattern\n\nWhen tool filtering causes errors, automatically disable it:\n\n```javascript\nclass ToolFilteringCircuitBreaker {\n  constructor() {\n    this.failures = 0;\n    this.threshold = 3;  // Disable after 3 failures\n    this.resetTimeout = 300000;  // 5 minutes\n    this.state = \"closed\";  // closed = filtering active\n  }\n\n  recordFailure(error) {\n    this.failures++;\n    if (this.failures >= this.threshold) {\n      this.state = \"open\";  // Disable filtering\n      log.warn(\"Circuit breaker OPEN: Tool filtering disabled due to errors\");\n      setTimeout(() => this.halfOpen(), this.resetTimeout);\n    }\n  }\n\n  halfOpen() {\n    this.state = \"half-open\";  // Try filtering again\n    this.failures = 0;\n  }\n}\n```\n\n## Feature Flags\n\n| Flag | Default | Description |\n|------|---------|-------------|\n| `enableToolFiltering` | false | Master switch for context-aware filtering |\n| `enableModularServers` | false | Use split servers vs monolithic |\n| `enableShadowMode` | false | Log but don't filter |\n| `enableCompositeTools` | false | Enable composite workflow tools |\n| `maxToolsPerContext` | 20 | Cap tools shown per context |\n\n## Implementation\n\n### 1. Feature Flag Storage\n```typescript\n// In settings table\ninterface FeatureFlags {\n  enableToolFiltering: boolean;\n  enableModularServers: boolean;\n  enableShadowMode: boolean;\n  enableCompositeTools: boolean;\n  maxToolsPerContext: number;\n}\n```\n\n### 2. Circuit Breaker State\n```typescript\n// In database or memory\ninterface CircuitBreakerState {\n  state: \"closed\" | \"open\" | \"half-open\";\n  failures: number;\n  lastFailure: string | null;\n  lastReset: string | null;\n}\n```\n\n### 3. MCP Tool for Flag Management\n```javascript\nserver.tool(\"manage_feature_flags\", {\n  action: z.enum([\"get\", \"set\", \"reset\"]),\n  flag: z.string().optional(),\n  value: z.boolean().optional(),\n}, async ({ action, flag, value }) => {\n  // Get/set/reset feature flags\n});\n```\n\n### 4. Circuit Breaker Status Tool\n```javascript\nserver.tool(\"get_circuit_breaker_status\", {}, async () => {\n  return {\n    toolFiltering: circuitBreakerState,\n    recentErrors: lastNErrors,\n    recommendation: state === \"open\" \n      ? \"Filtering disabled due to errors. Review logs before re-enabling.\"\n      : \"Filtering operational.\"\n  };\n});\n```\n\n## Acceptance Criteria\n\n- [ ] Feature flags stored in settings table\n- [ ] `manage_feature_flags` tool implemented\n- [ ] Circuit breaker pattern for tool filtering\n- [ ] Automatic disable on repeated failures\n- [ ] Automatic retry after cooldown period\n- [ ] UI for viewing/managing feature flags\n- [ ] Logging for circuit breaker state changes\n- [ ] Tests for circuit breaker transitions\n\n## Dependencies\n\n- Related to: Tool filtering implementation\n- Should be implemented early in the filtering rollout",
      "priority": "high",
      "tags": [
        "mcp-server",
        "circuit-breaker",
        "feature-flags",
        "safety",
        "reliability"
      ]
    },
    {
      "id": "46a0cada-a216-4516-b502-fe11cb4a86c8",
      "title": "Optimize tool descriptions to under 150 tokens each",
      "passes": false,
      "overview": "",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "start_ticket_work",
        "complete_ticket_work",
        "add_ticket_comment",
        "create_ticket",
        "list_tickets",
        "update_ticket_status",
        "submit_review_finding",
        "generate_demo_script",
        "All git tools (3)",
        "All review finding tools (4)",
        "All session tools (5)",
        "All telemetry tools (7)",
        "All conversation tools (6)",
        "All admin tools (4)",
        "All demo tools (4)",
        "All 65 tools have descriptions under 150 tokens",
        "Descriptions follow consistent format",
        "Core functionality still clear from description",
        "Args and return types documented concisely",
        "Total token savings measured (target: 50%+ reduction)",
        "No loss of essential information"
      ],
      "references": [],
      "description": "## Summary\n\nPer agent review findings, shorten all MCP tool descriptions to under 150 tokens each to reduce context consumption while maintaining clarity.\n\n## Current State\n\nMany tool descriptions are verbose (200-400 tokens). Example:\n\n```javascript\n// BEFORE (start_ticket_work - ~250 tokens)\n`Start working on a ticket.\n\nThis tool handles all workflow automatically:\n1. Creates a git branch: feature/{ticket-short-id}-{slug}\n2. Sets the ticket status to in_progress\n3. Auto-posts a \"Starting work\" comment for tracking\n4. Returns ticket context including description and acceptance criteria\n\nIf the ticket belongs to an epic with worktree isolation mode:\n- Uses the epic's worktree directory instead of the main project\n- Creates the worktree if it doesn't exist yet\n- Updates ralph-state.json in the worktree's .claude directory\n\nUse this when picking up a ticket to work on.\nThe project must have a git repository initialized.\n\nArgs:\n  ticketId: The ticket ID to start working on\n\nReturns:\n  Branch name, ticket details with description/acceptance criteria, and project path (worktree path if using worktree isolation).`\n```\n\n## Target Format\n\n```javascript\n// AFTER (start_ticket_work - ~80 tokens)\n`Start ticket work. Creates branch, sets status to in_progress, returns ticket context.\n\nHandles worktree isolation if epic is configured for it.\n\nArgs: ticketId (required)\nReturns: { branchName, ticketContext, projectPath }`\n```\n\n## Guidelines\n\n1. **First line**: One-sentence summary of what tool does\n2. **Second line**: Key behavior notes (if any)\n3. **Args**: Compact list with types\n4. **Returns**: Brief structure description\n5. **No**: Detailed workflows, edge cases, or implementation details\n\n## Tools to Optimize (Priority Order)\n\n### High-Use Tools (most impact)\n- [ ] start_ticket_work\n- [ ] complete_ticket_work\n- [ ] add_ticket_comment\n- [ ] create_ticket\n- [ ] list_tickets\n- [ ] update_ticket_status\n- [ ] submit_review_finding\n- [ ] generate_demo_script\n\n### Medium-Use Tools\n- [ ] All git tools (3)\n- [ ] All review finding tools (4)\n- [ ] All session tools (5)\n- [ ] All telemetry tools (7)\n\n### Low-Use Tools\n- [ ] All conversation tools (6)\n- [ ] All admin tools (4)\n- [ ] All demo tools (4)\n\n## Acceptance Criteria\n\n- [ ] All 65 tools have descriptions under 150 tokens\n- [ ] Descriptions follow consistent format\n- [ ] Core functionality still clear from description\n- [ ] Args and return types documented concisely\n- [ ] Total token savings measured (target: 50%+ reduction)\n- [ ] No loss of essential information\n\n## Measurement\n\n```javascript\n// Add to MCP server\nfunction measureToolDescriptions() {\n  return tools.map(t => ({\n    name: t.name,\n    descriptionTokens: countTokens(t.description),\n    exceedsLimit: countTokens(t.description) > 150\n  }));\n}\n```\n\n## Dependencies\n\n- Can be done independently\n- Should be done before: Tool filtering (shorter descriptions = better filtering UX)",
      "priority": "medium",
      "tags": [
        "mcp-server",
        "dx",
        "token-optimization",
        "descriptions"
      ]
    },
    {
      "id": "1d5bec4e-cdcf-42b7-a2a7-b78306e21a82",
      "title": "Add disambiguation hints for similar tools",
      "passes": false,
      "overview": "Several tool pairs/groups have overlapping functionality that confuses tool selection:\n### 1. Session Tools\n| Tool | Purpose | When to Use |\n|------|---------|-------------|\n| `create_ralph_session` | Ralph workflow tracking | Starting Ralph autonomous loop |\n| `start_telemetry_session` | Tool usage telemetry | Any ticket work session |\n| `start_conversation_session` | Compliance logging | Enterprise audit requirements |\n### 2. Comment Tools\n| Tool | Purpose | When to Use |\n|------|---------|-------------|\n| `add_ticket_comment` | Work logs, summaries | After completing work units |\n| `log_conversation_message` | Compliance audit | Enterprise logging |\n### 3. Completion Tools\n| Tool | Purpose | When to Use |\n|------|---------|-------------|\n| `complete_ticket_work` | Finish ticket implementation | After all code written |\n| `complete_ralph_session` | End Ralph loop | After Ralph finishes |\n| `end_telemetry_session` | Finalize telemetry | Session cleanup |\n### 4. Linking Tools\n| Tool | Purpose | When to Use |\n|------|---------|-------------|\n| `link_commit_to_ticket` | Manual commit link | After specific commits |\n| `link_pr_to_ticket` | Manual PR link | After PR creation |\n| `sync_ticket_links` | Auto-discover links | Periodic or before completion |",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [
        {
          "step": 1,
          "description": "Add `relatedTools` Metadata",
          "files": [],
          "codeTemplate": "server.tool(\"create_ralph_session\", description, schema, handler, {\n  relatedTools: [\n    { name: \"start_telemetry_session\", relationship: \"complementary\", hint: \"Also start telemetry for tool tracking\" },\n    { name: \"start_conversation_session\", relationship: \"alternative\", hint: \"Use instead for compliance-only logging\" }\n  ]\n});"
        },
        {
          "step": 2,
          "description": "Add Disambiguation in Descriptions",
          "files": [],
          "codeTemplate": "// BEFORE\n`Create a Ralph session for autonomous work.`\n\n// AFTER\n`Create Ralph session for autonomous loop. NOT for telemetry (use start_telemetry_session) or compliance (use start_conversation_session).`"
        },
        {
          "step": 3,
          "description": "Add `get_tool_recommendation` Tool",
          "files": [],
          "codeTemplate": "server.tool(\"get_tool_recommendation\", {\n  intent: z.string().describe(\"What you're trying to accomplish\"),\n}, async ({ intent }) => {\n  // Analyze intent and recommend specific tool\n  return {\n    recommendedTool: \"start_ticket_work\",\n    reason: \"You want to begin work on a ticket - this handles branch creation and status update\",\n    alternatives: [\n      { tool: \"start_work\", reason: \"Composite tool if you also need telemetry session\" }\n    ]\n  };\n});"
        },
        {
          "step": 3,
          "description": "Add `get_tool_recommendation` Tool",
          "files": [],
          "codeTemplate": "server.tool(\"get_tool_recommendation\", {\n  intent: z.string().describe(\"What you're trying to accomplish\"),\n}, async ({ intent }) => {\n  // Analyze intent and recommend specific tool\n  return {\n    recommendedTool: \"start_ticket_work\",\n    reason: \"You want to begin work on a ticket - this handles branch creation and status update\",\n    alternatives: [\n      { tool: \"start_work\", reason: \"Composite tool if you also need telemetry session\" }\n    ]\n  };\n});"
        }
      ],
      "acceptanceCriteria": [
        "All similar tool groups identified and documented",
        "Disambiguation hints added to tool descriptions",
        "`relatedTools` metadata on all overlapping tools",
        "`get_tool_recommendation` helper tool implemented",
        "Documentation with decision tree for common tasks",
        "Tests verify correct tool selection for ambiguous intents"
      ],
      "references": [],
      "description": "## Summary\n\nPer agent review findings, add clear disambiguation between similar tools to help LLMs choose correctly.\n\n## Problem Tools\n\nSeveral tool pairs/groups have overlapping functionality that confuses tool selection:\n\n### 1. Session Tools\n| Tool | Purpose | When to Use |\n|------|---------|-------------|\n| `create_ralph_session` | Ralph workflow tracking | Starting Ralph autonomous loop |\n| `start_telemetry_session` | Tool usage telemetry | Any ticket work session |\n| `start_conversation_session` | Compliance logging | Enterprise audit requirements |\n\n### 2. Comment Tools\n| Tool | Purpose | When to Use |\n|------|---------|-------------|\n| `add_ticket_comment` | Work logs, summaries | After completing work units |\n| `log_conversation_message` | Compliance audit | Enterprise logging |\n\n### 3. Completion Tools\n| Tool | Purpose | When to Use |\n|------|---------|-------------|\n| `complete_ticket_work` | Finish ticket implementation | After all code written |\n| `complete_ralph_session` | End Ralph loop | After Ralph finishes |\n| `end_telemetry_session` | Finalize telemetry | Session cleanup |\n\n### 4. Linking Tools\n| Tool | Purpose | When to Use |\n|------|---------|-------------|\n| `link_commit_to_ticket` | Manual commit link | After specific commits |\n| `link_pr_to_ticket` | Manual PR link | After PR creation |\n| `sync_ticket_links` | Auto-discover links | Periodic or before completion |\n\n## Implementation\n\n### 1. Add `relatedTools` Metadata\n```javascript\nserver.tool(\"create_ralph_session\", description, schema, handler, {\n  relatedTools: [\n    { name: \"start_telemetry_session\", relationship: \"complementary\", hint: \"Also start telemetry for tool tracking\" },\n    { name: \"start_conversation_session\", relationship: \"alternative\", hint: \"Use instead for compliance-only logging\" }\n  ]\n});\n```\n\n### 2. Add Disambiguation in Descriptions\n```javascript\n// BEFORE\n`Create a Ralph session for autonomous work.`\n\n// AFTER\n`Create Ralph session for autonomous loop. NOT for telemetry (use start_telemetry_session) or compliance (use start_conversation_session).`\n```\n\n### 3. Add `get_tool_recommendation` Tool\n```javascript\nserver.tool(\"get_tool_recommendation\", {\n  intent: z.string().describe(\"What you're trying to accomplish\"),\n}, async ({ intent }) => {\n  // Analyze intent and recommend specific tool\n  return {\n    recommendedTool: \"start_ticket_work\",\n    reason: \"You want to begin work on a ticket - this handles branch creation and status update\",\n    alternatives: [\n      { tool: \"start_work\", reason: \"Composite tool if you also need telemetry session\" }\n    ]\n  };\n});\n```\n\n## Acceptance Criteria\n\n- [ ] All similar tool groups identified and documented\n- [ ] Disambiguation hints added to tool descriptions\n- [ ] `relatedTools` metadata on all overlapping tools\n- [ ] `get_tool_recommendation` helper tool implemented\n- [ ] Documentation with decision tree for common tasks\n- [ ] Tests verify correct tool selection for ambiguous intents\n\n## Decision Trees for Documentation\n\n```\nStarting ticket work?\n├── Just the ticket → start_ticket_work\n├── + Telemetry → start_work (composite)\n└── + Compliance logging → start_work + start_conversation_session\n\nEnding work?\n├── Implementation done → complete_ticket_work\n├── Ending Ralph loop → complete_ralph_session\n└── Just cleanup → end_telemetry_session\n```\n\n## Dependencies\n\n- Depends on: Tool metadata system\n- Related to: Tool description optimization",
      "priority": "medium",
      "tags": [
        "mcp-server",
        "dx",
        "disambiguation",
        "tool-selection"
      ]
    },
    {
      "id": "e1b3655e-8954-4b40-9a98-0f946db57ae6",
      "title": "Add tools/list_changed notification support",
      "passes": false,
      "overview": "",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [
        {
          "step": 1,
          "description": "Notification Helper",
          "files": [],
          "codeTemplate": "// In lib/notifications.js\nexport function notifyToolsListChanged(server) {\n  server.notification({\n    method: \"notifications/tools/list_changed\"\n  });\n}"
        },
        {
          "step": 2,
          "description": "Emit on Mode Change",
          "files": [],
          "codeTemplate": "// In set_tool_mode handler\nasync ({ mode, persist }) => {\n  updateToolMode(mode, persist);\n  notifyToolsListChanged(server);\n  return { mode, toolCount: getToolCount(mode) };\n};"
        },
        {
          "step": 3,
          "description": "Emit on Context Change",
          "files": [],
          "codeTemplate": "// In complete_ticket_work handler\nasync ({ ticketId, summary }) => {\n  // ... complete work logic ...\n  \n  // Status changed from in_progress to ai_review\n  // Tool set may change (review tools now relevant)\n  notifyToolsListChanged(server);\n  \n  return result;\n};"
        },
        {
          "step": 4,
          "description": "Debounce Rapid Changes",
          "files": [],
          "codeTemplate": "// Avoid notification spam during rapid operations\nconst debouncedNotify = debounce(notifyToolsListChanged, 500);"
        },
        {
          "step": 4,
          "description": "Debounce Rapid Changes",
          "files": [],
          "codeTemplate": "// Avoid notification spam during rapid operations\nconst debouncedNotify = debounce(notifyToolsListChanged, 500);"
        }
      ],
      "acceptanceCriteria": [
        "`notifyToolsListChanged` helper implemented",
        "Notification emitted on mode change",
        "Notification emitted on relevant status changes",
        "Notification emitted on feature flag changes",
        "Debouncing prevents notification spam",
        "Documentation explains client handling",
        "Tests verify notifications are emitted correctly"
      ],
      "references": [
        "MCP Spec: Notifications section",
        "Related: Mode selection, context detection"
      ],
      "description": "## Summary\n\nPer agent review findings, implement the MCP `tools/list_changed` notification to inform clients when available tools change (due to context changes or mode switches).\n\n## MCP Protocol\n\nThe MCP spec includes a `tools/list_changed` notification that servers can send to inform clients the tool list has changed:\n\n```typescript\n// MCP notification\n{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"notifications/tools/list_changed\"\n}\n```\n\nWhen clients receive this, they should re-fetch the tool list via `tools/list`.\n\n## When to Emit\n\n1. **Mode Change**: When `set_tool_mode` is called\n2. **Context Change**: When ticket status changes (e.g., in_progress -> ai_review)\n3. **Feature Flag Toggle**: When filtering is enabled/disabled\n4. **Session Start/End**: When starting or completing ticket work\n\n## Implementation\n\n### 1. Notification Helper\n```javascript\n// In lib/notifications.js\nexport function notifyToolsListChanged(server) {\n  server.notification({\n    method: \"notifications/tools/list_changed\"\n  });\n}\n```\n\n### 2. Emit on Mode Change\n```javascript\n// In set_tool_mode handler\nasync ({ mode, persist }) => {\n  updateToolMode(mode, persist);\n  notifyToolsListChanged(server);\n  return { mode, toolCount: getToolCount(mode) };\n};\n```\n\n### 3. Emit on Context Change\n```javascript\n// In complete_ticket_work handler\nasync ({ ticketId, summary }) => {\n  // ... complete work logic ...\n  \n  // Status changed from in_progress to ai_review\n  // Tool set may change (review tools now relevant)\n  notifyToolsListChanged(server);\n  \n  return result;\n};\n```\n\n### 4. Debounce Rapid Changes\n```javascript\n// Avoid notification spam during rapid operations\nconst debouncedNotify = debounce(notifyToolsListChanged, 500);\n```\n\n## Client Handling (Documentation)\n\nDocument for LLM clients:\n- When you receive `tools/list_changed`, call `tools/list` to refresh\n- Don't cache tool lists indefinitely\n- Expect tool availability to change during workflows\n\n## Acceptance Criteria\n\n- [ ] `notifyToolsListChanged` helper implemented\n- [ ] Notification emitted on mode change\n- [ ] Notification emitted on relevant status changes\n- [ ] Notification emitted on feature flag changes\n- [ ] Debouncing prevents notification spam\n- [ ] Documentation explains client handling\n- [ ] Tests verify notifications are emitted correctly\n\n## References\n\n- MCP Spec: Notifications section\n- Related: Mode selection, context detection",
      "priority": "medium",
      "tags": [
        "mcp-server",
        "mcp-protocol",
        "notifications",
        "tool-filtering"
      ]
    },
    {
      "id": "79d4ad9f-bae5-4dd1-b6f6-917be08543bc",
      "title": "End-to-end workflow verification testing",
      "passes": false,
      "overview": "",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "Branch/worktree created correctly",
        "Status set to in_progress",
        "Session started (telemetry, ralph if applicable)",
        "Ticket context returned",
        "State tracking works during implementation",
        "State enforcement hooks fire correctly",
        "Files can be written without errors",
        "Commits linked to ticket automatically",
        "PRs created and linked",
        "Push hooks work correctly",
        "Review agents can run",
        "Findings can be submitted",
        "Status transitions to ai_review",
        "Findings can be marked fixed",
        "Review completion checked correctly",
        "Iteration counter increments",
        "Demo script generation works",
        "Status transitions to human_review",
        "Feedback can be submitted",
        "Ticket marked complete",
        "Sessions ended correctly",
        "Status transitions to done",
        "Work summaries can be added",
        "Progress updates work",
        "Comments visible in UI",
        "Tool usage captured",
        "Prompts captured (if enabled)",
        "Session data queryable",
        "All 9 critical workflows have E2E tests",
        "Tests cover branch mode and worktree mode",
        "Tests cover review iteration scenarios",
        "Tests cover human rejection scenarios",
        "Tests verify composite tools",
        "Tests verify mode switching",
        "Tests verify circuit breaker",
        "All tests pass in CI",
        "Test report shows coverage of critical paths"
      ],
      "references": [],
      "description": "## Summary\n\nCreate comprehensive end-to-end tests that verify all 9 critical workflows work correctly after the tool consolidation changes.\n\n## Critical Workflows to Test\n\nFrom the requirements, ALL of these must work:\n\n### 1. Start Ticket\n- [ ] Branch/worktree created correctly\n- [ ] Status set to in_progress\n- [ ] Session started (telemetry, ralph if applicable)\n- [ ] Ticket context returned\n\n### 2. Coding (Write/Edit)\n- [ ] State tracking works during implementation\n- [ ] State enforcement hooks fire correctly\n- [ ] Files can be written without errors\n\n### 3. Commit/Push\n- [ ] Commits linked to ticket automatically\n- [ ] PRs created and linked\n- [ ] Push hooks work correctly\n\n### 4. AI Review\n- [ ] Review agents can run\n- [ ] Findings can be submitted\n- [ ] Status transitions to ai_review\n\n### 5. Fix Issues\n- [ ] Findings can be marked fixed\n- [ ] Review completion checked correctly\n- [ ] Iteration counter increments\n\n### 6. Human Review\n- [ ] Demo script generation works\n- [ ] Status transitions to human_review\n- [ ] Feedback can be submitted\n\n### 7. Done\n- [ ] Ticket marked complete\n- [ ] Sessions ended correctly\n- [ ] Status transitions to done\n\n### 8. AI Comments\n- [ ] Work summaries can be added\n- [ ] Progress updates work\n- [ ] Comments visible in UI\n\n### 9. Telemetry\n- [ ] Tool usage captured\n- [ ] Prompts captured (if enabled)\n- [ ] Session data queryable\n\n## Test Scenarios\n\n### Scenario A: Happy Path (Branch Mode)\n```\n1. Create ticket\n2. start_ticket_work -> branch created\n3. Write code (simulated)\n4. Commit (simulated) \n5. complete_ticket_work -> ai_review\n6. Submit 2 findings, mark both fixed\n7. generate_demo_script -> human_review\n8. submit_demo_feedback(passed) -> done\n9. Verify telemetry captured all steps\n```\n\n### Scenario B: Happy Path (Worktree Mode)\nSame as A but with epic using worktree isolation\n\n### Scenario C: Review Iteration\n```\n1-5. Same as A\n6. Submit 1 critical finding\n7. Try generate_demo_script -> should fail (unresolved finding)\n8. Mark finding fixed\n9. generate_demo_script -> succeeds\n```\n\n### Scenario D: Human Rejection\n```\n1-7. Same as A\n8. submit_demo_feedback(failed, \"Bug in form validation\")\n9. Verify ticket stays in human_review\n10. Fix and re-submit\n```\n\n### Scenario E: Composite Tools\n```\n1. start_work (composite) -> creates branch, ralph session, telemetry\n2. Work...\n3. complete_work (composite) -> completes ticket, syncs links, ends sessions\n4. Verify all individual operations occurred\n```\n\n### Scenario F: Mode Switching\n```\n1. set_tool_mode(\"workflow\")\n2. Verify only workflow tools visible\n3. Try admin tool -> should fail or not be visible\n4. set_tool_mode(\"admin\")\n5. Verify admin tools now visible\n```\n\n### Scenario G: Circuit Breaker\n```\n1. Enable tool filtering\n2. Simulate 3 filtering errors\n3. Verify circuit breaker opens\n4. Verify all tools visible (fallback)\n5. Wait for cooldown\n6. Verify filtering re-enabled\n```\n\n## Test Implementation\n\n```typescript\n// e2e/workflow-verification.test.ts\ndescribe(\"Critical Workflow Verification\", () => {\n  describe(\"Scenario A: Happy Path (Branch Mode)\", () => {\n    it(\"completes full ticket lifecycle\", async () => {\n      // Setup\n      const project = await createTestProject();\n      const ticket = await createTestTicket(project.id);\n      \n      // Start work\n      const startResult = await mcpCall(\"start_ticket_work\", { ticketId: ticket.id });\n      expect(startResult.branchName).toMatch(/^feature\\//);\n      expect(await getTicketStatus(ticket.id)).toBe(\"in_progress\");\n      \n      // ... continue through all steps\n    });\n  });\n});\n```\n\n## Acceptance Criteria\n\n- [ ] All 9 critical workflows have E2E tests\n- [ ] Tests cover branch mode and worktree mode\n- [ ] Tests cover review iteration scenarios\n- [ ] Tests cover human rejection scenarios\n- [ ] Tests verify composite tools\n- [ ] Tests verify mode switching\n- [ ] Tests verify circuit breaker\n- [ ] All tests pass in CI\n- [ ] Test report shows coverage of critical paths\n\n## Dependencies\n\n- Should run AFTER all other tickets in epic are complete\n- Serves as final validation before release",
      "priority": "high",
      "tags": [
        "testing",
        "e2e",
        "verification",
        "workflow",
        "quality"
      ]
    },
    {
      "id": "4a51a60a-dc83-4e1f-96c4-92e0c8142532",
      "title": "Update VS Code configuration to use full AI customization features",
      "passes": false,
      "overview": "",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "`.github/copilot-instructions.md` with workflow instructions",
        "`.github/skills/` with next-task, review, demo, workflow skills",
        "`.github/agents/` with 3 review agents",
        "`.github/prompts/` with start-work, complete-work prompts",
        "`.vscode/mcp.json` with modular server configs",
        "Skills work with GitHub Copilot in VS Code",
        "Agents can be invoked from chat",
        "MCP tools accessible in chat",
        "Documentation explains VS Code-specific setup"
      ],
      "references": [
        "VS Code Custom Instructions: https://code.visualstudio.com/docs/copilot/customization/custom-instructions",
        "VS Code Agent Skills: https://code.visualstudio.com/docs/copilot/customization/agent-skills",
        "VS Code Custom Agents: https://code.visualstudio.com/docs/copilot/customization/custom-agents",
        "VS Code Prompt Files: https://code.visualstudio.com/docs/copilot/customization/prompt-files",
        "VS Code MCP Servers: https://code.visualstudio.com/docs/copilot/customization/mcp-servers"
      ],
      "description": "## Summary\n\nBased on VS Code documentation review, VS Code has **near-parity** with Claude Code for AI customization. Update the VS Code configuration to use all available features.\n\n## VS Code AI Customization Features (Discovered)\n\n| Feature | VS Code Location | Claude Code Equivalent |\n|---------|-----------------|----------------------|\n| **Custom Instructions** | `.github/copilot-instructions.md` | `CLAUDE.md` |\n| **Conditional Instructions** | `.github/instructions/*.instructions.md` | `.claude/instructions/` |\n| **Agent Skills** | `.github/skills/*/SKILL.md` | `.claude/skills/*/SKILL.md` ✅ Same format! |\n| **Custom Agents** | `.github/agents/*.agent.md` | `.claude/agents/` |\n| **Prompt Files** | `.github/prompts/*.prompt.md` | Commands |\n| **MCP Servers** | `.vscode/mcp.json` | `.mcp.json` |\n| **AGENTS.md** | `.github/AGENTS.md` | `AGENTS.md` |\n| **Hooks** | ❌ Not supported | ✅ Full support |\n\n## Target VS Code Structure\n\n```\n.github/\n├── copilot-instructions.md          # Main instructions (like CLAUDE.md)\n├── instructions/\n│   ├── brain-dump-workflow.instructions.md  # Workflow guidance\n│   └── coding-standards.instructions.md     # Code quality rules\n├── skills/\n│   ├── next-task/SKILL.md           # /next-task skill\n│   ├── review/SKILL.md              # /review skill\n│   ├── demo/SKILL.md                # /demo skill\n│   └── brain-dump-workflow/SKILL.md # Main workflow skill\n├── agents/\n│   ├── code-reviewer.agent.md       # Code review agent\n│   ├── silent-failure-hunter.agent.md\n│   └── code-simplifier.agent.md\n├── prompts/\n│   ├── start-work.prompt.md         # /start-work prompt\n│   ├── complete-work.prompt.md      # /complete-work prompt\n│   └── review.prompt.md             # /review prompt\n└── AGENTS.md                        # Multi-agent workflow guide\n\n.vscode/\n├── mcp.json                         # MCP server configuration\n└── settings.json                    # VS Code settings (if needed)\n```\n\n## copilot-instructions.md Content\n\n```markdown\n# Brain Dump Workflow Instructions\n\n## Ticket Workflow Status Flow\n\nbacklog → ready → in_progress → ai_review → human_review → done\n\n## Required MCP Tools\n\nWhen working on tickets, use these Brain Dump MCP tools:\n\n- `start_ticket_work` - Begin work on a ticket (creates branch, sets status)\n- `complete_ticket_work` - Finish implementation (moves to ai_review)\n- `add_ticket_comment` - Add work summaries and progress notes\n- `submit_review_finding` - Report issues found during review\n- `generate_demo_script` - Create manual test steps for human review\n\n## Review Requirements\n\nBefore marking work complete:\n1. Run `pnpm type-check`\n2. Run `pnpm lint`\n3. Run `pnpm test`\n4. Use code-reviewer agent for code review\n5. Fix all critical/major findings\n\n## DO/DON'T Guidelines\n\n[Adapted from CLAUDE.md - concise version for Copilot]\n```\n\n## Skills Format (Same as Claude Code!)\n\n```markdown\n---\nname: next-task\ndescription: Select the next ticket to work on based on priority and dependencies\n---\n\nWhen asked to select the next task or what to work on next:\n\n1. Call `list_tickets({ status: 'ready', limit: 10 })`\n2. Evaluate by:\n   - Priority (high > medium > low)\n   - Dependencies (unblocked tickets first)\n   - Epic context (continue current epic if possible)\n3. Present top 3 recommendations with rationale\n4. Once selected, call `start_ticket_work({ ticketId })`\n```\n\n## Agent Format\n\n```markdown\n---\nname: code-reviewer\ndescription: Reviews code for bugs, security issues, and best practices\ntools:\n  - brain-dump-core/*\n  - brain-dump-workflow/*\nmcp-servers:\n  brain-dump-core:\n    command: node\n    args: [\"~/.brain-dump/mcp-server/index-core.js\"]\n---\n\n# Code Reviewer Agent\n\nYou are a senior code reviewer. When reviewing code:\n\n1. Check for logic errors and bugs\n2. Identify security vulnerabilities\n3. Verify error handling is complete\n4. Check adherence to project conventions in CLAUDE.md\n\nReport findings using `submit_review_finding` tool with appropriate severity.\n```\n\n## MCP Configuration (.vscode/mcp.json)\n\n```json\n{\n  \"servers\": {\n    \"brain-dump-core\": {\n      \"type\": \"stdio\",\n      \"command\": \"node\",\n      \"args\": [\"${userHome}/.brain-dump/mcp-server/index-core.js\"]\n    },\n    \"brain-dump-workflow\": {\n      \"type\": \"stdio\",\n      \"command\": \"node\",\n      \"args\": [\"${userHome}/.brain-dump/mcp-server/index-workflow.js\"]\n    }\n  }\n}\n```\n\n## Key Difference from Claude Code\n\nVS Code lacks **hooks** for shell-based enforcement. Workflow guidance must come from:\n- Instructions (loaded automatically)\n- Skills (loaded contextually)\n- Agents (invoked for specific tasks)\n\nState enforcement relies on MCP tool preconditions rather than PreToolUse hooks.\n\n## Acceptance Criteria\n\n- [ ] `.github/copilot-instructions.md` with workflow instructions\n- [ ] `.github/skills/` with next-task, review, demo, workflow skills\n- [ ] `.github/agents/` with 3 review agents\n- [ ] `.github/prompts/` with start-work, complete-work prompts\n- [ ] `.vscode/mcp.json` with modular server configs\n- [ ] Skills work with GitHub Copilot in VS Code\n- [ ] Agents can be invoked from chat\n- [ ] MCP tools accessible in chat\n- [ ] Documentation explains VS Code-specific setup\n\n## References\n\n- VS Code Custom Instructions: https://code.visualstudio.com/docs/copilot/customization/custom-instructions\n- VS Code Agent Skills: https://code.visualstudio.com/docs/copilot/customization/agent-skills\n- VS Code Custom Agents: https://code.visualstudio.com/docs/copilot/customization/custom-agents\n- VS Code Prompt Files: https://code.visualstudio.com/docs/copilot/customization/prompt-files\n- VS Code MCP Servers: https://code.visualstudio.com/docs/copilot/customization/mcp-servers",
      "priority": "medium",
      "tags": [
        "vscode",
        "copilot",
        "skills",
        "agents",
        "mcp",
        "configuration"
      ]
    },
    {
      "id": "7928387c-ed50-49b4-afc7-bfb228da06f1",
      "title": "Create comprehensive OpenCode configuration with plugins, agents, and skills",
      "passes": false,
      "overview": "",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "`.opencode/opencode.json` with MCP server configs",
        "`.opencode/agents/` with 3 review agents in markdown",
        "`.opencode/skills/` with next-task, review, demo, workflow skills",
        "`.opencode/plugins/state-enforcement/` with hook implementation",
        "`.opencode/plugins/brain-dump-workflow/` with telemetry hooks",
        "`AGENTS.md` with workflow instructions (or symlink to CLAUDE.md)",
        "Skills work with skill tool invocation",
        "Plugins install dependencies correctly",
        "State enforcement hooks block writes in wrong state",
        "Telemetry captured for tool usage",
        "Documentation explains OpenCode-specific setup"
      ],
      "references": [
        "OpenCode MCP Servers: https://opencode.ai/docs/mcp-servers/",
        "OpenCode Skills: https://opencode.ai/docs/skills/",
        "OpenCode Agents: https://opencode.ai/docs/agents/",
        "OpenCode Plugins: https://opencode.ai/docs/plugins/",
        "OpenCode Rules: https://opencode.ai/docs/rules/",
        "OpenCode Custom Tools: https://opencode.ai/docs/custom-tools/"
      ],
      "description": "## Summary\n\nBased on OpenCode documentation review, OpenCode has **feature parity with Claude Code** including plugins with hooks! Create comprehensive OpenCode configuration.\n\n## OpenCode Capabilities (Discovered)\n\n| Feature | OpenCode Location | Claude Code Equivalent |\n|---------|------------------|----------------------|\n| **Rules** | `AGENTS.md` or `CLAUDE.md` | `CLAUDE.md` ✅ Same! |\n| **Skills** | `.opencode/skills/*/SKILL.md` | `.claude/skills/*/SKILL.md` ✅ Same format! |\n| **Agents** | `.opencode/agents/*.md` | `.claude/agents/` ✅ Similar |\n| **MCP Servers** | `opencode.json` under `mcp` | `.mcp.json` |\n| **Plugins** | `.opencode/plugins/` | `.claude/plugins/` ✅ Similar! |\n| **Custom Tools** | `.opencode/tools/` | N/A (uses MCP instead) |\n| **Hooks** | Plugins with `tool.execute.before/after` | Shell-based hooks ✅ Equivalent! |\n\n## Key Discovery: OpenCode Has Plugin Hooks!\n\nOpenCode plugins support event hooks that provide equivalent functionality to Claude Code hooks:\n\n```typescript\n// OpenCode plugin with hooks\nexport default function(context) {\n  return {\n    hooks: {\n      \"tool.execute.before\": async (event) => {\n        // PreToolUse equivalent - can block or modify\n      },\n      \"tool.execute.after\": async (event) => {\n        // PostToolUse equivalent\n      },\n      \"session.created\": async (event) => {\n        // SessionStart equivalent\n      }\n    }\n  }\n}\n```\n\n## Target OpenCode Structure\n\n```\n.opencode/\n├── opencode.json                    # Main config file\n├── agents/\n│   ├── code-reviewer.md             # Code review agent\n│   ├── silent-failure-hunter.md     # Error handling agent\n│   └── code-simplifier.md           # Simplification agent\n├── skills/\n│   ├── next-task/SKILL.md           # /next-task skill\n│   ├── review/SKILL.md              # /review skill\n│   ├── demo/SKILL.md                # /demo skill\n│   └── brain-dump-workflow/SKILL.md # Main workflow skill\n├── plugins/\n│   ├── brain-dump-workflow/\n│   │   ├── index.ts                 # Plugin entry point\n│   │   └── package.json             # Dependencies\n│   └── state-enforcement/\n│       └── index.ts                 # State enforcement hooks\n├── tools/\n│   └── brain-dump-shortcuts.ts      # Custom composite tools (optional)\n└── package.json                     # Plugin dependencies\n\nAGENTS.md                            # Project rules (or symlink to CLAUDE.md)\n```\n\n## opencode.json Configuration\n\n```json\n{\n  \"mcp\": {\n    \"brain-dump-core\": {\n      \"type\": \"local\",\n      \"command\": [\"node\", \"~/.brain-dump/mcp-server/index-core.js\"],\n      \"enabled\": true\n    },\n    \"brain-dump-workflow\": {\n      \"type\": \"local\",\n      \"command\": [\"node\", \"~/.brain-dump/mcp-server/index-workflow.js\"],\n      \"enabled\": true\n    }\n  },\n  \"agent\": {\n    \"build\": {\n      \"tools\": {\n        \"brain-dump-core*\": true,\n        \"brain-dump-workflow*\": true\n      }\n    },\n    \"code-reviewer\": {\n      \"mode\": \"subagent\",\n      \"description\": \"Reviews code for bugs and best practices\",\n      \"prompt\": \"{file:.opencode/agents/code-reviewer.md}\",\n      \"tools\": {\n        \"brain-dump-core*\": true,\n        \"edit\": false,\n        \"write\": false\n      }\n    }\n  },\n  \"instructions\": [\"CLAUDE.md\"]\n}\n```\n\n## Plugin: State Enforcement\n\n```typescript\n// .opencode/plugins/state-enforcement/index.ts\nimport { plugin } from \"@opencode-ai/plugin\"\n\nexport default plugin((context) => ({\n  hooks: {\n    \"tool.execute.before\": async (event) => {\n      // Check ralph-state.json before allowing writes\n      if ([\"write\", \"edit\"].includes(event.tool)) {\n        const state = await readRalphState(context.worktree)\n        if (state && ![\"implementing\", \"testing\", \"committing\"].includes(state.currentState)) {\n          return {\n            blocked: true,\n            message: `Cannot write in '${state.currentState}' state. Call update_session_state first.`\n          }\n        }\n      }\n    },\n    \"session.created\": async (event) => {\n      // Auto-start telemetry session\n      const ticketId = await detectActiveTicket(context.worktree)\n      if (ticketId) {\n        console.log(`Detected active ticket: ${ticketId}`)\n        // Prompt to start telemetry\n      }\n    }\n  }\n}))\n```\n\n## Plugin: Telemetry Capture\n\n```typescript\n// .opencode/plugins/brain-dump-workflow/index.ts\nimport { plugin } from \"@opencode-ai/plugin\"\n\nexport default plugin((context) => ({\n  hooks: {\n    \"tool.execute.before\": async (event) => {\n      // Log tool start\n      await logToolEvent(context.sessionID, \"start\", event.tool)\n    },\n    \"tool.execute.after\": async (event) => {\n      // Log tool end with duration\n      await logToolEvent(context.sessionID, \"end\", event.tool, event.duration)\n    }\n  }\n}))\n```\n\n## Skills (Same Format as Claude Code!)\n\n```markdown\n---\nname: next-task\ndescription: Select the next ticket to work on based on priority and dependencies\n---\n\nWhen asked to select the next task or what to work on next:\n\n1. Call `brain-dump-core_list_tickets({ status: 'ready', limit: 10 })`\n2. Evaluate by:\n   - Priority (high > medium > low)\n   - Dependencies (unblocked tickets first)\n   - Epic context (continue current epic if possible)\n3. Present top 3 recommendations with rationale\n4. Once selected, call `brain-dump-workflow_start_ticket_work({ ticketId })`\n```\n\n## Agent Format (Markdown)\n\n```markdown\n# Code Reviewer\n\nReviews code for bugs, security issues, and best practices.\n\n## Role\nYou are a senior code reviewer. When reviewing code:\n1. Check for logic errors and bugs\n2. Identify security vulnerabilities\n3. Verify error handling is complete\n4. Check adherence to project conventions\n\n## Tool Usage\nReport findings using `brain-dump-workflow_submit_review_finding` with:\n- severity: critical, major, minor, suggestion\n- category: type-safety, error-handling, security, etc.\n- description: Clear explanation of the issue\n- suggestedFix: How to fix it\n```\n\n## Key Differences from Claude Code\n\n| Aspect | Claude Code | OpenCode |\n|--------|-------------|----------|\n| Hooks | Shell scripts | TypeScript plugins |\n| MCP config | `.mcp.json` | `opencode.json` under `mcp` |\n| Tool naming | `mcp__brain-dump__tool` | `brain-dump-core_tool` |\n| Plugin format | plugin.json manifest | TypeScript module export |\n\n## Acceptance Criteria\n\n- [ ] `.opencode/opencode.json` with MCP server configs\n- [ ] `.opencode/agents/` with 3 review agents in markdown\n- [ ] `.opencode/skills/` with next-task, review, demo, workflow skills\n- [ ] `.opencode/plugins/state-enforcement/` with hook implementation\n- [ ] `.opencode/plugins/brain-dump-workflow/` with telemetry hooks\n- [ ] `AGENTS.md` with workflow instructions (or symlink to CLAUDE.md)\n- [ ] Skills work with skill tool invocation\n- [ ] Plugins install dependencies correctly\n- [ ] State enforcement hooks block writes in wrong state\n- [ ] Telemetry captured for tool usage\n- [ ] Documentation explains OpenCode-specific setup\n\n## References\n\n- OpenCode MCP Servers: https://opencode.ai/docs/mcp-servers/\n- OpenCode Skills: https://opencode.ai/docs/skills/\n- OpenCode Agents: https://opencode.ai/docs/agents/\n- OpenCode Plugins: https://opencode.ai/docs/plugins/\n- OpenCode Rules: https://opencode.ai/docs/rules/\n- OpenCode Custom Tools: https://opencode.ai/docs/custom-tools/",
      "priority": "medium",
      "tags": [
        "opencode",
        "plugins",
        "skills",
        "agents",
        "mcp",
        "hooks",
        "configuration"
      ]
    },
    {
      "id": "0e3ab913-ebff-418a-9732-948e31fbc115",
      "title": "Configure Cursor with Full Universal Quality Workflow Support",
      "passes": false,
      "overview": "Configure Cursor IDE with complete Universal Quality Workflow support, leveraging Cursor's **full feature parity** with Claude Code including hooks, skills, subagents, rules, MCP, and commands.",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [
        {
          "step": 1,
          "description": "Hooks Configuration (`.cursor/hooks.json`)",
          "files": [],
          "codeTemplate": "{\n  \"version\": 1,\n  \"hooks\": {\n    \"preToolUse\": [\n      {\n        \"matcher\": \"Write|Edit\",\n        \"command\": \"$HOME/.cursor/hooks/enforce-state-before-write.sh\"\n      },\n      {\n        \"matcher\": \"Bash(git push:*)\",\n        \"command\": \"$HOME/.cursor/hooks/enforce-review-before-push.sh\"\n      }\n    ],\n    \"postToolUse\": [\n      {\n        \"matcher\": \"mcp__brain-dump__start_ticket_work\",\n        \"command\": \"$HOME/.cursor/hooks/create-pr-on-ticket-start.sh\"\n      },\n      {\n        \"matcher\": \"Bash(git commit:*)\",\n        \"command\": \"$HOME/.cursor/hooks/link-commit-to-ticket.sh\"\n      },\n      {\n        \"matcher\": \"Bash(gh pr create:*)\",\n        \"command\": \"$HOME/.cursor/hooks/spawn-after-pr.sh\"\n      }\n    ],\n    \"sessionStart\": [\n      {\n        \"command\": \"$HOME/.cursor/hooks/start-telemetry-session.sh\"\n      }\n    ],\n    \"sessionEnd\": [\n      {\n        \"command\": \"$HOME/.cursor/hooks/end-telemetry-session.sh\"\n      }\n    ]\n  }\n}"
        },
        {
          "step": 2,
          "description": "MCP Configuration (`.cursor/mcp.json`)",
          "files": [],
          "codeTemplate": "{\n  \"mcpServers\": {\n    \"brain-dump\": {\n      \"command\": \"node\",\n      \"args\": [\"/path/to/brain-dump/mcp-server/index.js\"],\n      \"env\": {\n        \"LOG_LEVEL\": \"info\"\n      }\n    }\n  }\n}"
        },
        {
          "step": 3,
          "description": "Skills (Same format as Claude Code)",
          "files": []
        },
        {
          "step": 4,
          "description": "Agents (Same format as Claude Code)",
          "files": []
        },
        {
          "step": 5,
          "description": "Commands (Cursor-specific)",
          "files": [],
          "codeTemplate": "# .cursor/commands/start-work.md\n---\nname: start-work\ndescription: Start work on a ticket\n---\nCall mcp__brain-dump__start_ticket_work with the ticket ID to begin work.\nThis will create a branch, set status to in_progress, and start telemetry."
        },
        {
          "step": 6,
          "description": "Rules (Cursor-specific)",
          "files": []
        },
        {
          "step": 6,
          "description": "Rules (Cursor-specific)",
          "files": []
        }
      ],
      "acceptanceCriteria": [
        "`.cursor/hooks.json` configured with all state enforcement hooks",
        "`.cursor/mcp.json` configured with brain-dump MCP server",
        "Skills copied/symlinked from `.claude/skills/`",
        "Agents copied/symlinked from `.claude/agents/`",
        "Commands created for common workflow operations",
        "Rules configured for workflow guidance",
        "Verified hooks fire correctly (test with Write tool)",
        "Verified MCP tools accessible in Cursor",
        "Verified skills load on-demand",
        "Documented setup in README or install script"
      ],
      "references": [],
      "description": "## Overview\n\nConfigure Cursor IDE with complete Universal Quality Workflow support, leveraging Cursor's **full feature parity** with Claude Code including hooks, skills, subagents, rules, MCP, and commands.\n\n## Key Discovery\n\nCursor has **FULL hook support** - unlike our initial assumption, Cursor supports:\n- `preToolUse`, `postToolUse`, `postToolUseFailure`\n- `sessionStart`, `sessionEnd`\n- `beforeShellExecution`, `afterShellExecution`\n- `beforeMCPExecution`, `afterMCPExecution`\n\nThis means ALL Brain Dump workflows including state enforcement can work in Cursor!\n\n## Target Structure\n\n```\n.cursor/\n├── hooks.json                         # Full hook configuration\n├── mcp.json                           # MCP server configuration\n├── skills/\n│   ├── next-task/SKILL.md\n│   ├── review/SKILL.md\n│   ├── review-ticket/SKILL.md\n│   └── brain-dump-workflow/SKILL.md\n├── agents/\n│   ├── code-reviewer.md\n│   ├── silent-failure-hunter.md\n│   └── code-simplifier.md\n├── commands/\n│   ├── start-work.md\n│   └── complete-work.md\n└── rules/\n    ├── brain-dump-workflow.md\n    └── testing-philosophy.md\n```\n\n## Implementation Tasks\n\n### 1. Hooks Configuration (`.cursor/hooks.json`)\n\n```json\n{\n  \"version\": 1,\n  \"hooks\": {\n    \"preToolUse\": [\n      {\n        \"matcher\": \"Write|Edit\",\n        \"command\": \"$HOME/.cursor/hooks/enforce-state-before-write.sh\"\n      },\n      {\n        \"matcher\": \"Bash(git push:*)\",\n        \"command\": \"$HOME/.cursor/hooks/enforce-review-before-push.sh\"\n      }\n    ],\n    \"postToolUse\": [\n      {\n        \"matcher\": \"mcp__brain-dump__start_ticket_work\",\n        \"command\": \"$HOME/.cursor/hooks/create-pr-on-ticket-start.sh\"\n      },\n      {\n        \"matcher\": \"Bash(git commit:*)\",\n        \"command\": \"$HOME/.cursor/hooks/link-commit-to-ticket.sh\"\n      },\n      {\n        \"matcher\": \"Bash(gh pr create:*)\",\n        \"command\": \"$HOME/.cursor/hooks/spawn-after-pr.sh\"\n      }\n    ],\n    \"sessionStart\": [\n      {\n        \"command\": \"$HOME/.cursor/hooks/start-telemetry-session.sh\"\n      }\n    ],\n    \"sessionEnd\": [\n      {\n        \"command\": \"$HOME/.cursor/hooks/end-telemetry-session.sh\"\n      }\n    ]\n  }\n}\n```\n\n### 2. MCP Configuration (`.cursor/mcp.json`)\n\n```json\n{\n  \"mcpServers\": {\n    \"brain-dump\": {\n      \"command\": \"node\",\n      \"args\": [\"/path/to/brain-dump/mcp-server/index.js\"],\n      \"env\": {\n        \"LOG_LEVEL\": \"info\"\n      }\n    }\n  }\n}\n```\n\n### 3. Skills (Same format as Claude Code)\n\nCopy/symlink from `.claude/skills/` or create in `.cursor/skills/`:\n- `next-task/SKILL.md` - Intelligent ticket selection\n- `review/SKILL.md` - Run review agents in parallel\n- `review-ticket/SKILL.md` - Review and submit findings\n- `brain-dump-workflow/SKILL.md` - Full workflow guidance\n\n### 4. Agents (Same format as Claude Code)\n\nCopy/symlink from `.claude/agents/` or create in `.cursor/agents/`:\n- `code-reviewer.md` - Code quality review\n- `silent-failure-hunter.md` - Error handling review\n- `code-simplifier.md` - Code simplification review\n\n### 5. Commands (Cursor-specific)\n\nCreate workflow shortcuts in `.cursor/commands/`:\n\n```markdown\n# .cursor/commands/start-work.md\n---\nname: start-work\ndescription: Start work on a ticket\n---\nCall mcp__brain-dump__start_ticket_work with the ticket ID to begin work.\nThis will create a branch, set status to in_progress, and start telemetry.\n```\n\n### 6. Rules (Cursor-specific)\n\nCreate rules in `.cursor/rules/`:\n- `brain-dump-workflow.md` - Universal Quality Workflow guidance\n- `testing-philosophy.md` - Kent C. Dodds testing patterns\n\nOr use `AGENTS.md` in project root (Cursor supports this).\n\n## Acceptance Criteria\n\n- [ ] `.cursor/hooks.json` configured with all state enforcement hooks\n- [ ] `.cursor/mcp.json` configured with brain-dump MCP server\n- [ ] Skills copied/symlinked from `.claude/skills/`\n- [ ] Agents copied/symlinked from `.claude/agents/`\n- [ ] Commands created for common workflow operations\n- [ ] Rules configured for workflow guidance\n- [ ] Verified hooks fire correctly (test with Write tool)\n- [ ] Verified MCP tools accessible in Cursor\n- [ ] Verified skills load on-demand\n- [ ] Documented setup in README or install script\n\n## Notes\n\n- Cursor supports both `.cursor/` AND `.claude/` directories for skills/agents\n- Hook scripts can be shared between Claude Code and Cursor\n- Consider adding `setup-cursor.sh` script to automate configuration\n- Update capability matrix in docs to show Cursor has FULL parity",
      "priority": "high",
      "tags": [
        "cursor",
        "configuration",
        "hooks",
        "skills",
        "mcp",
        "multi-provider"
      ]
    }
  ],
  "projectContext": {
    "techStack": [
      "Framework: TanStack Start (React 19 + Vite + Nitro)",
      "Database: SQLite with better-sqlite3, Drizzle ORM",
      "Styling: Tailwind CSS v4",
      "State: TanStack Query for server state",
      "Drag & Drop: @dnd-kit"
    ],
    "dosDonts": [
      {
        "category": "Database Queries",
        "dos": [
          "Use Drizzle ORM: `db.select().from(tickets)`",
          "Use typed schema imports: `import { tickets } from \"../lib/schema\"`",
          "Use `eq()`, `and()`, `sql` from drizzle-orm for conditions",
          "Use transactions for multi-table operations: `db.transaction(() => {...})`",
          "Use `.get()` for single row, `.all()` for multiple"
        ],
        "donts": [
          "Raw SQL strings: `db.run(\"SELECT * FROM tickets\")`",
          "String-based table names",
          "String concatenation for WHERE clauses",
          "Multiple independent queries that should be atomic",
          "Assume query returns what you expect without checking"
        ]
      },
      {
        "category": "React & TanStack Query",
        "dos": [
          "Use `useQuery` with `queryKeys` for data fetching",
          "Use `useMutation` with `onSuccess` for state changes",
          "Invalidate queries after mutations: `queryClient.invalidateQueries({ queryKey: queryKeys.tickets })`",
          "Use centralized `queryKeys` object from `src/lib/hooks.ts`",
          "Create custom hooks in `src/lib/hooks.ts` for reusable query logic"
        ],
        "donts": [
          "`useState` + `useEffect` for fetched data",
          "Direct API calls without proper cache invalidation",
          "Manual cache manipulation or refetch after every change",
          "Hardcoded query key strings throughout components",
          "Duplicate query setup in multiple components"
        ]
      },
      {
        "category": "Styling Patterns",
        "dos": [
          "Use Tailwind classes for static styles: `className=\"p-4 bg-slate-800\"`",
          "Use CSS variables for theming: `var(--bg-primary)`, `var(--shadow-modal)`",
          "Reserve inline styles for dynamic/computed values: `style={{ width: `${percent}%` }}`",
          "Define shared style constants at module level for referential stability",
          "Use `React.CSSProperties` type for inline style objects when needed"
        ],
        "donts": [
          "Inline style objects for single-use styles",
          "Hardcoded colors that don't adapt to themes",
          "Mix Tailwind and inline styles inconsistently",
          "Create new objects inside components that are reused",
          "Untyped style objects that miss IDE autocomplete"
        ]
      },
      {
        "category": "Server Functions",
        "dos": [
          "Use `createServerFn({ method: \"GET\" })` for reads, `\"POST\"` for writes",
          "Use `.inputValidator()` for type-safe input handling",
          "Return typed data directly: `return db.select().from(tickets).all()`",
          "Use `ensureExists()` for required lookups: `ensureExists(project, \"Project\")`",
          "Import from `@tanstack/react-start` (not `@tanstack/react-start/server`)"
        ],
        "donts": [
          "Mix GET/POST inconsistently",
          "Access raw input without validation",
          "Wrap in unnecessary response objects",
          "Return null and let caller handle missing data",
          "Wrong import path"
        ]
      },
      {
        "category": "MCP Tool Implementation",
        "dos": [
          "Use Zod schemas for input validation: `{ ticketId: z.string() }`",
          "Return structured `{ content: [{ type: \"text\", text: ... }] }` format",
          "Set `isError: true` for error responses",
          "Use `log.info()` / `log.error()` from `../lib/logging.js`",
          "Include helpful error messages: `\"Project not found. Use list_projects to see available.\"`"
        ],
        "donts": [
          "Trust input without validation",
          "Return plain strings",
          "Return error text without the error flag",
          "`console.log` in MCP server code",
          "Generic \"Not found\" errors"
        ]
      },
      {
        "category": "Testing Patterns (Kent C. Dodds)",
        "dos": [
          "Test user behavior: what users see, click, and experience",
          "Integration tests for workflows: test components together",
          "Real database fixtures with actual schema",
          "Tests that fail when user-facing behavior breaks",
          "Ask: \"Does this test catch bugs users would encounter?\""
        ],
        "donts": [
          "Test implementation details, internal state, or private methods",
          "Unit tests for every function",
          "Excessive mocking of internals",
          "Tests that break on refactoring internals",
          "Chase 100% code coverage as a goal"
        ]
      }
    ],
    "verificationSteps": [
      "Run `pnpm type-check` - must pass with no errors",
      "Run `pnpm lint` - must pass with no errors",
      "Run `pnpm test` - all tests must pass"
    ]
  },
  "generatedAt": "2026-01-28T19:33:51.061Z",
  "epicTitle": "MCP Tool Consolidation and Context-Aware Filtering",
  "epicDescription": "Reduce Claude's tool context overhead by implementing intelligent tool filtering based on workflow context. This epic consolidates MCP tools and adds smart filtering to show only relevant tools for the current task."
}
{
  "projectName": "Brain Dump",
  "projectPath": "/Users/salman.rana/code/brain-dump",
  "testingRequirements": [
    "Tests must validate user-facing behavior, not implementation details",
    "Focus on what users actually do - integration tests over unit tests",
    "Don't mock excessively - test real behavior where possible",
    "Coverage metrics are meaningless - user flow coverage is everything"
  ],
  "userStories": [
    {
      "id": "8cd08bfe-617c-4edd-a39b-99f1a6f6b3cf",
      "title": "Create core/ foundation (errors, types, db)",
      "passes": false,
      "overview": "",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "All error classes defined with codes matching spec error table",
        "All result types defined for every core function",
        "Database initializer works standalone (not tied to MCP server)",
        "`pnpm type-check` passes"
      ],
      "references": [
        "mcp-server/lib/database.ts",
        "plans/specs/core-extraction-and-cli.md"
      ],
      "description": "Create the foundational `core/` directory with shared types, typed error classes, and database initialization.\n\n**Files to create:**\n- `core/errors.ts` - All typed error classes (TicketNotFoundError, InvalidStateError, etc.)\n- `core/types.ts` - All shared TypeScript interfaces (StartWorkResult, ReviewFinding, TicketWithProject, etc.)\n- `core/db.ts` - Database initialization extracted from `mcp-server/lib/database.ts`, works standalone\n\n**Acceptance criteria:**\n- [ ] All error classes defined with codes matching spec error table\n- [ ] All result types defined for every core function\n- [ ] Database initializer works standalone (not tied to MCP server)\n- [ ] `pnpm type-check` passes\n\n**Spec:** `plans/specs/core-extraction-and-cli.md` - Ticket 1",
      "priority": "high",
      "tags": [
        "core",
        "foundation"
      ]
    },
    {
      "id": "2254cf38-d428-41c2-b28a-e75fa8aae8bc",
      "title": "Extract core/ticket.ts and core/project.ts",
      "passes": false,
      "overview": "",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "All functions extracted with typed inputs/outputs",
        "Throw typed errors instead of returning MCP error objects",
        "Unit tests for each function using real SQLite in-memory database",
        "MCP tool handlers updated to call core functions (thin wrappers)",
        "Existing MCP behavior unchanged (regression test)"
      ],
      "references": [
        "mcp-server/tools/tickets.ts",
        "mcp-server/tools/projects.ts",
        "plans/specs/core-extraction-and-cli.md"
      ],
      "description": "Extract ticket and project business logic from MCP handlers into core functions.\n\n**Extract from:** `mcp-server/tools/tickets.ts` (28KB), `mcp-server/tools/projects.ts` (11KB)\n\n**Functions to extract:**\n- `createTicket(db, params)` → `TicketWithProject`\n- `listTickets(db, filters)` → `TicketWithProject[]`\n- `getTicket(db, ticketId)` → `TicketWithProject`\n- `updateTicketStatus(db, ticketId, status)` → `TicketWithProject`\n- `updateAcceptanceCriterion(db, ticketId, criterionId, status, note?)` → `Ticket`\n- `deleteTicket(db, ticketId, confirm)` → `DeleteResult`\n- `createProject(db, params)` → `Project`\n- `listProjects(db)` → `Project[]`\n- `findProjectByPath(db, path)` → `Project | null`\n- `deleteProject(db, projectId, confirm)` → `DeleteResult`\n\n**Acceptance criteria:**\n- [ ] All functions extracted with typed inputs/outputs\n- [ ] Throw typed errors instead of returning MCP error objects\n- [ ] Unit tests for each function using real SQLite in-memory database\n- [ ] MCP tool handlers updated to call core functions (thin wrappers)\n- [ ] Existing MCP behavior unchanged (regression test)\n\n**Depends on:** Ticket 1 (core foundation)\n**Spec:** `plans/specs/core-extraction-and-cli.md` - Ticket 2",
      "priority": "high",
      "tags": [
        "core",
        "extraction"
      ]
    },
    {
      "id": "ef8fdcc9-5fd4-4f36-a769-565229aea73e",
      "title": "Extract core/epic.ts and core/comment.ts",
      "passes": true,
      "overview": "",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "Same extraction pattern as ticket/project",
        "Unit tests with in-memory SQLite",
        "MCP wrappers updated to call core functions"
      ],
      "references": [
        "mcp-server/tools/epics.ts",
        "mcp-server/tools/comments.ts",
        "plans/specs/core-extraction-and-cli.md"
      ],
      "description": "Extract epic and comment business logic from MCP handlers into core functions.\n\n**Extract from:** `mcp-server/tools/epics.ts` (10KB), `mcp-server/tools/comments.ts` (5KB)\n\n**Functions to extract:**\n- `createEpic(db, params)` → `Epic`\n- `listEpics(db, projectId)` → `Epic[]`\n- `updateEpic(db, epicId, params)` → `Epic`\n- `deleteEpic(db, epicId, confirm)` → `DeleteResult`\n- `addComment(db, ticketId, params)` → `Comment`\n- `listComments(db, ticketId)` → `Comment[]`\n\n**Acceptance criteria:**\n- [ ] Same extraction pattern as ticket/project\n- [ ] Unit tests with in-memory SQLite\n- [ ] MCP wrappers updated to call core functions\n\n**Depends on:** Ticket 1 (core foundation)\n**Spec:** `plans/specs/core-extraction-and-cli.md` - Ticket 3",
      "priority": "high",
      "tags": [
        "core",
        "extraction"
      ]
    },
    {
      "id": "ae4be249-3772-46e0-ad31-ed45937ab974",
      "title": "Extract core/review.ts",
      "passes": true,
      "overview": "",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "State validation (ticket must be in ai_review for findings)",
        "Review iteration auto-increment logic preserved",
        "Demo generation validates all critical/major findings fixed",
        "Unit tests for each function"
      ],
      "references": [
        "mcp-server/tools/review-findings.ts",
        "mcp-server/tools/demo.ts",
        "plans/specs/core-extraction-and-cli.md"
      ],
      "description": "Extract review findings and demo script business logic from MCP handlers into core functions.\n\n**Extract from:** `mcp-server/tools/review-findings.ts` (18KB), `mcp-server/tools/demo.ts` (18KB)\n\n**Functions to extract:**\n- `submitFinding(db, params)` → `ReviewFinding`\n- `markFixed(db, findingId, status, description?)` → `ReviewFinding`\n- `getFindings(db, ticketId, filters?)` → `ReviewFinding[]`\n- `checkComplete(db, ticketId)` → `ReviewCompletionStatus`\n- `generateDemo(db, ticketId, steps)` → `DemoScript`\n- `getDemo(db, ticketId)` → `DemoScript | null`\n- `updateDemoStep(db, demoScriptId, stepOrder, status, notes?)` → `DemoScript`\n- `submitFeedback(db, ticketId, passed, feedback, stepResults?)` → `FeedbackResult`\n\n**Acceptance criteria:**\n- [ ] State validation (ticket must be in ai_review for findings)\n- [ ] Review iteration auto-increment logic preserved\n- [ ] Demo generation validates all critical/major findings fixed\n- [ ] Unit tests for each function\n\n**Depends on:** Ticket 1 (core foundation)\n**Spec:** `plans/specs/core-extraction-and-cli.md` - Ticket 5",
      "priority": "high",
      "tags": [
        "core",
        "extraction",
        "review"
      ]
    },
    {
      "id": "a32fe775-11fe-4598-914b-4b8c21e485a9",
      "title": "Extract core/session.ts and core/telemetry.ts",
      "passes": false,
      "overview": "",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "State machine transitions validated (idle → analyzing → implementing → ...)",
        "Ralph state file (`.claude/ralph-state.json`) management in core",
        "Telemetry correlation ID logic preserved",
        "Unit tests for state transitions"
      ],
      "references": [
        "mcp-server/tools/sessions.ts",
        "mcp-server/tools/events.ts",
        "mcp-server/tools/telemetry.ts",
        "plans/specs/core-extraction-and-cli.md"
      ],
      "description": "Extract Ralph session management, events, and telemetry from MCP handlers into core functions.\n\n**Extract from:** `mcp-server/tools/sessions.ts` (24KB), `mcp-server/tools/events.ts` (10KB), `mcp-server/tools/telemetry.ts` (33KB)\n\n**Functions to extract:**\n- Session: createSession, updateState, completeSession, getState, listSessions\n- Events: emitEvent, getEvents, clearEvents\n- Telemetry: startSession, logTool, logPrompt, logContext, endSession, getSession, listSessions\n\n**Acceptance criteria:**\n- [ ] State machine transitions validated (idle → analyzing → implementing → ...)\n- [ ] Ralph state file (`.claude/ralph-state.json`) management in core\n- [ ] Telemetry correlation ID logic preserved\n- [ ] Unit tests for state transitions\n\n**Depends on:** Ticket 1 (core foundation)\n**Spec:** `plans/specs/core-extraction-and-cli.md` - Ticket 6",
      "priority": "medium",
      "tags": [
        "core",
        "extraction",
        "session"
      ]
    },
    {
      "id": "83a55430-7450-4d8a-8304-77633b9380e3",
      "title": "Extract remaining core modules (git, files, compliance, tasks, health, learnings)",
      "passes": false,
      "overview": "",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "All functions extracted with typed inputs/outputs",
        "Unit tests for each module",
        "MCP wrappers updated to call core functions"
      ],
      "references": [
        "mcp-server/tools/git.ts",
        "plans/specs/core-extraction-and-cli.md"
      ],
      "description": "Extract all remaining MCP tool logic into core modules.\n\n**Extract from:** `mcp-server/tools/git.ts`, `files.ts`, `conversations.ts`, `claude-tasks.ts`, `health.ts`, `learnings.ts`\n\n**Creates:**\n- `core/git.ts` - linkCommit, linkPr, syncLinks\n- `core/files.ts` - linkFiles, getTicketsForFile\n- `core/compliance.ts` - conversation session CRUD, export, archival\n- `core/tasks.ts` - saveTasks, getTasks, clearTasks, getSnapshots\n- `core/health.ts` - getHealth, getEnvironment, getSettings, updateSettings\n- `core/learnings.ts` - reconcileLearnings, getEpicLearnings\n\n**Acceptance criteria:**\n- [ ] All functions extracted with typed inputs/outputs\n- [ ] Unit tests for each module\n- [ ] MCP wrappers updated to call core functions\n\n**Depends on:** Ticket 1 (core foundation)\n**Spec:** `plans/specs/core-extraction-and-cli.md` - Ticket 7",
      "priority": "medium",
      "tags": [
        "core",
        "extraction"
      ]
    },
    {
      "id": "781b0dee-94c7-4e85-ae85-9bc9af8e154d",
      "title": "Build CLI commands",
      "passes": false,
      "overview": "",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "Every command works end-to-end",
        "JSON output parseable by jq",
        "--pretty flag produces human-readable output",
        "--help for every resource and action",
        "Exit code 0 on success, 1 on error",
        "Integration tests: run CLI commands against real SQLite",
        "Existing brain-dump backup/check/doctor commands still work"
      ],
      "references": [
        "plans/specs/core-extraction-and-cli.md"
      ],
      "description": "Build all CLI commands that wrap core functions. Extends existing `brain-dump` CLI.\n\n**Creates:** `cli/commands/*.ts`, `cli/lib/output.ts`, `cli/lib/args.ts`\n\n**CLI structure:** `brain-dump <resource> <action> [--flags]`\n- JSON output by default (for AI consumption)\n- `--pretty` flag for human-readable output\n- Exit code 0 on success, 1 on error\n\n**Full command list:**\n- workflow: start-work, complete-work, start-epic\n- ticket: create, list, get, update, delete\n- epic: create, list, update, delete\n- comment: add, list\n- review: submit-finding, mark-fixed, check-complete, generate-demo, get-demo, submit-feedback, get-findings\n- session: create, update, complete, get, list\n- git: link-commit, link-pr, sync\n- admin: backup, restore, check, doctor, health (existing, reorganized)\n\n**Acceptance criteria:**\n- [ ] Every command works end-to-end\n- [ ] JSON output parseable by jq\n- [ ] --pretty flag produces human-readable output\n- [ ] --help for every resource and action\n- [ ] Exit code 0 on success, 1 on error\n- [ ] Integration tests: run CLI commands against real SQLite\n- [ ] Existing brain-dump backup/check/doctor commands still work\n\n**Depends on:** Tickets 1-7 (all core extractions)\n**Spec:** `plans/specs/core-extraction-and-cli.md` - Ticket 8",
      "priority": "high",
      "tags": [
        "cli"
      ]
    },
    {
      "id": "22c7e965-6ab5-4a06-8c7a-47cf93469c2f",
      "title": "Consolidate MCP server (55 → 8 resource tools)",
      "passes": false,
      "overview": "",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "8 resource tools registered",
        "All existing MCP functionality preserved",
        "OpenCode config updated (8 tools instead of 13)",
        "Integration tests: call each tool via MCP protocol",
        "Context reduction verified (count tool schema tokens before/after)"
      ],
      "references": [
        "plans/specs/core-extraction-and-cli.md"
      ],
      "description": "Rewrite MCP server to use 8 resource-based tools instead of 55 individual tools. Each tool accepts an `action` parameter and dispatches to core functions.\n\n**8 resource tools:**\n1. `ticket` - create, list, get, update, delete, update-criterion\n2. `epic` - create, list, update, delete\n3. `comment` - add, list\n4. `workflow` - start-work, complete-work, start-epic\n5. `review` - submit-finding, mark-fixed, check-complete, generate-demo, get-demo, submit-feedback, get-findings\n6. `session` - create, update, complete, get, list, emit-event, get-events, clear-events\n7. `telemetry` - start, log-tool, log-prompt, log-context, end, get, list\n8. `admin` - health, environment, settings, update-settings\n\n**Each tool:** validates action → validates action-specific params with Zod → calls core function → formats result as MCP content → catches CoreError for isError responses\n\n**Acceptance criteria:**\n- [ ] 8 resource tools registered\n- [ ] All existing MCP functionality preserved\n- [ ] OpenCode config updated (8 tools instead of 13)\n- [ ] Integration tests: call each tool via MCP protocol\n- [ ] Context reduction verified (count tool schema tokens before/after)\n\n**Depends on:** Tickets 1-7 (all core extractions)\n**Spec:** `plans/specs/core-extraction-and-cli.md` - Ticket 9",
      "priority": "high",
      "tags": [
        "mcp",
        "consolidation"
      ]
    },
    {
      "id": "e89b80e3-b972-492b-beac-98391522fa54",
      "title": "Extract core/workflow.ts + absorb start-ticket-workflow.ts",
      "passes": false,
      "overview": "",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "All 3 functions extracted with typed inputs/outputs",
        "`src/api/start-ticket-workflow.ts` DELETED — replaced by core/workflow.ts",
        "`src/api/ralph.ts` updated to import startWork/startEpicWork from core",
        "Git helpers in core/git-utils.ts (single copy, no duplication)",
        "Git operations abstracted behind interface for testability",
        "Unit tests for state transitions and error cases",
        "Integration tests for full startWork → completeWork flow",
        "UI Ralph launch still works after wiring change (manual verification)"
      ],
      "references": [
        "mcp-server/tools/workflow.ts",
        "src/api/start-ticket-workflow.ts",
        "mcp-server/lib/git-utils.ts",
        "src/api/ralph.ts",
        "plans/specs/core-extraction-and-cli.md"
      ],
      "description": "Extract workflow business logic into core. This is the most critical ticket because it must absorb the existing shared function AND wire up the UI path.\n\n**Extract from:**\n- `mcp-server/tools/workflow.ts` (49KB)\n- `src/api/start-ticket-workflow.ts` (400 lines — ABSORB then DELETE)\n- `mcp-server/lib/git-utils.ts` (move to `core/git-utils.ts`)\n\n**Functions:**\n- `startWork(db, ticketId)` → `StartWorkResult`\n- `completeWork(db, ticketId, summary?)` → `CompleteWorkResult`\n- `startEpicWork(db, epicId, createPr?)` → `StartEpicWorkResult`\n\n**Critical wiring:**\n- `src/api/start-ticket-workflow.ts` is already called by BOTH the UI (`launchRalphForTicket` in `src/api/ralph.ts`) AND the MCP server. It has duplicated git utils (copy-pasted from mcp-server). Must be absorbed into `core/workflow.ts`.\n- After extraction: `src/api/ralph.ts` imports from core, MCP wrapper imports from core, CLI imports from core. One copy of the logic.\n\n**Acceptance criteria:**\n- [ ] All 3 functions extracted with typed inputs/outputs\n- [ ] `src/api/start-ticket-workflow.ts` DELETED — replaced by core/workflow.ts\n- [ ] `src/api/ralph.ts` updated to import startWork/startEpicWork from core\n- [ ] Git helpers in core/git-utils.ts (single copy, no duplication)\n- [ ] Git operations abstracted behind interface for testability\n- [ ] Unit tests for state transitions and error cases\n- [ ] Integration tests for full startWork → completeWork flow\n- [ ] UI Ralph launch still works after wiring change (manual verification)\n\n**Depends on:** Ticket 1 (core foundation)\n**Spec:** `plans/specs/core-extraction-and-cli.md` - Ticket 4 + Section 7.1-7.2",
      "priority": "high",
      "tags": [
        "core",
        "extraction",
        "workflow",
        "critical"
      ]
    },
    {
      "id": "747e2c0a-fd5f-4b61-bf0d-37bb0e96a170",
      "title": "Wire up end-to-end integration (hooks, skills, configs, prompts)",
      "passes": false,
      "overview": "",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "UI → Ralph Launch (Claude Code) → terminal opens → workflow completes",
        "UI → Ralph Launch (OpenCode) → terminal opens → workflow completes",
        "Direct CLI workflow (start → complete → review → demo)",
        "Hook integration (PR auto-create, commit linking, next-ticket spawn)",
        "Kanban drag-drop still works (unaffected path)"
      ],
      "references": [
        "plans/specs/core-extraction-and-cli.md"
      ],
      "description": "Capstone ticket: plug everything together so the full system works end-to-end. See spec Section 7 for complete trace.\n\n**Hook matchers (settings.json) — 6 matchers to update:**\n- `start_ticket_work` → new CLI/MCP matcher\n- `complete_ticket_work` → new CLI/MCP matcher\n- `update_session_state` → new CLI/MCP matcher\n- `create_ralph_session` → new CLI/MCP matcher\n- `complete_ralph_session` → new CLI/MCP matcher\n- `sync_ticket_links` → new CLI/MCP matcher\n\n**Hook scripts — 8 scripts need updates:**\n- create-pr-on-ticket-start.sh, spawn-next-ticket.sh, record-state-change.sh, clear-pending-links.sh (trigger matchers)\n- link-commit-to-ticket.sh, check-pending-links.sh, start-telemetry-session.sh, end-telemetry-session.sh (output text)\n\n**getRalphPrompt() in src/api/ralph.ts:**\n- Update all 8+ MCP tool name references to CLI commands\n- Make environment-aware (CLI for Claude Code/OpenCode, MCP for VS Code)\n\n**Skills:** brain-dump-workflow, /next-task, /review-ticket, /demo, /reconcile-learnings\n\n**Provider configs:** OpenCode (AGENTS.md + opencode.json), Cursor, VS Code\n\n**Setup scripts:** setup-claude-code.sh, setup-opencode.sh, setup-cursor.sh, setup-vscode.sh\n\n**CLAUDE.md:** Update architecture docs, MCP references, hook documentation\n\n**End-to-end verification (ALL must pass):**\n- [ ] UI → Ralph Launch (Claude Code) → terminal opens → workflow completes\n- [ ] UI → Ralph Launch (OpenCode) → terminal opens → workflow completes\n- [ ] Direct CLI workflow (start → complete → review → demo)\n- [ ] Hook integration (PR auto-create, commit linking, next-ticket spawn)\n- [ ] Kanban drag-drop still works (unaffected path)\n\n**Depends on:** Tickets 8-9 (CLI + MCP consolidation)\n**Spec:** `plans/specs/core-extraction-and-cli.md` - Ticket 10 + Section 7",
      "priority": "high",
      "tags": [
        "integration",
        "hooks",
        "skills",
        "critical"
      ]
    }
  ],
  "projectContext": {
    "techStack": [
      "Framework: TanStack Start (React 19 + Vite + Nitro)",
      "Database: SQLite with better-sqlite3, Drizzle ORM",
      "Styling: Tailwind CSS v4",
      "State: TanStack Query for server state",
      "Drag & Drop: @dnd-kit"
    ],
    "dosDonts": [
      {
        "category": "Database Queries",
        "dos": [
          "Use Drizzle ORM: `db.select().from(tickets)`",
          "Use typed schema imports: `import { tickets } from \"../lib/schema\"`",
          "Use `eq()`, `and()`, `sql` from drizzle-orm for conditions",
          "Use transactions for multi-table operations: `db.transaction(() => {...})`",
          "Use `.get()` for single row, `.all()` for multiple"
        ],
        "donts": [
          "Raw SQL strings: `db.run(\"SELECT * FROM tickets\")`",
          "String-based table names",
          "String concatenation for WHERE clauses",
          "Multiple independent queries that should be atomic",
          "Assume query returns what you expect without checking"
        ]
      },
      {
        "category": "React & TanStack Query",
        "dos": [
          "Use `useQuery` with `queryKeys` for data fetching",
          "Use `useMutation` with `onSuccess` for state changes",
          "Invalidate queries after mutations: `queryClient.invalidateQueries({ queryKey: queryKeys.tickets })`",
          "Use centralized `queryKeys` object from `src/lib/hooks.ts`",
          "Create custom hooks in `src/lib/hooks.ts` for reusable query logic"
        ],
        "donts": [
          "`useState` + `useEffect` for fetched data",
          "Direct API calls without proper cache invalidation",
          "Manual cache manipulation or refetch after every change",
          "Hardcoded query key strings throughout components",
          "Duplicate query setup in multiple components"
        ]
      },
      {
        "category": "Styling Patterns",
        "dos": [
          "Use Tailwind classes for static styles: `className=\"p-4 bg-slate-800\"`",
          "Use CSS variables for theming: `var(--bg-primary)`, `var(--shadow-modal)`",
          "Reserve inline styles for dynamic/computed values: `style={{ width: `${percent}%` }}`",
          "Define shared style constants at module level for referential stability",
          "Use `React.CSSProperties` type for inline style objects when needed"
        ],
        "donts": [
          "Inline style objects for single-use styles",
          "Hardcoded colors that don't adapt to themes",
          "Mix Tailwind and inline styles inconsistently",
          "Create new objects inside components that are reused",
          "Untyped style objects that miss IDE autocomplete"
        ]
      },
      {
        "category": "Server Functions",
        "dos": [
          "Use `createServerFn({ method: \"GET\" })` for reads, `\"POST\"` for writes",
          "Use `.inputValidator()` for type-safe input handling",
          "Return typed data directly: `return db.select().from(tickets).all()`",
          "Use `ensureExists()` for required lookups: `ensureExists(project, \"Project\")`",
          "Import from `@tanstack/react-start` (not `@tanstack/react-start/server`)"
        ],
        "donts": [
          "Mix GET/POST inconsistently",
          "Access raw input without validation",
          "Wrap in unnecessary response objects",
          "Return null and let caller handle missing data",
          "Wrong import path"
        ]
      },
      {
        "category": "MCP Tool Implementation",
        "dos": [
          "Use Zod schemas for input validation: `{ ticketId: z.string() }`",
          "Return structured `{ content: [{ type: \"text\", text: ... }] }` format",
          "Set `isError: true` for error responses",
          "Use `log.info()` / `log.error()` from `../lib/logging.js`",
          "Include helpful error messages: `\"Project not found. Use list_projects to see available.\"`"
        ],
        "donts": [
          "Trust input without validation",
          "Return plain strings",
          "Return error text without the error flag",
          "`console.log` in MCP server code",
          "Generic \"Not found\" errors"
        ]
      },
      {
        "category": "Testing Patterns (Kent C. Dodds)",
        "dos": [
          "Test user behavior: what users see, click, and experience",
          "Integration tests for workflows: test components together",
          "Real database fixtures with actual schema",
          "Tests that fail when user-facing behavior breaks",
          "Ask: \"Does this test catch bugs users would encounter?\""
        ],
        "donts": [
          "Test implementation details, internal state, or private methods",
          "Unit tests for every function",
          "Excessive mocking of internals",
          "Tests that break on refactoring internals",
          "Chase 100% code coverage as a goal"
        ]
      }
    ],
    "verificationSteps": [
      "Run `pnpm type-check` - must pass with no errors",
      "Run `pnpm lint` - must pass with no errors",
      "Run `pnpm test` - all tests must pass",
      "Added tests for new functionality (ONLY tests that verify real user behavior - see Testing Philosophy above)",
      "Used typed error classes (not generic `Error`)",
      "Used Drizzle ORM (not raw SQL) - see DO/DON'T table above",
      "Followed existing patterns from DO/DON'T tables",
      "No hardcoded values that should be configurable",
      "Existing tests still pass",
      "No regressions in related functionality",
      "Updated tests if behavior changed",
      "Did not break backward compatibility (unless explicitly requested)",
      "Manually verified in browser at `localhost:4242`",
      "Checked responsive layout",
      "Verified TanStack Query invalidates and updates correctly",
      "Accessibility: keyboard navigation works, proper ARIA labels",
      "Migration file created via `pnpm db:generate`",
      "Migration tested with `pnpm db:migrate`",
      "Backup tested if schema changed (use `pnpm brain-dump backup` then test restore)",
      "Updated `src/lib/schema.ts` with proper types and constraints",
      "Tested tool via Claude Code integration",
      "Verified error responses are informative (see DO/DON'T table)",
      "Updated tool documentation if interface changed",
      "Added Zod schema for input validation",
      "All acceptance criteria from ticket met",
      "Work summary added via `add_ticket_comment` (for Ralph sessions)",
      "Session completed with appropriate outcome (for Ralph sessions)",
      "Committed with proper message format: `feat(<ticket-id>): <description>`"
    ]
  },
  "generatedAt": "2026-02-02T06:03:02.891Z",
  "epicTitle": "Core Extraction + CLI + MCP Consolidation",
  "epicDescription": "All 10 tickets in this epic share ONE branch and ONE PR. Nothing merges to main until the entire epic is complete and tested end-to-end.\n\n**Branch:** `feature/epic-630de809-core-extraction-cli-mcp-consolidation`\n**PR:** Single draft PR created when the first ticket starts work\n\nDO NOT create per-ticket branches. When `start_ticket_work` is called for any ticket in this epic, it MUST use the epic branch (not a ticket-specific branch). The epic workflow state tracks which ticket is currently active on the shared branch.\n\n**Spec:** `plans/specs/core-extraction-and-cli.md`"
}

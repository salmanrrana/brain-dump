{
  "projectName": "Brain Dump",
  "projectPath": "/Users/salman.rana/code/brain-dump",
  "testingRequirements": [
    "Tests must validate user-facing behavior, not implementation details",
    "Focus on what users actually do - integration tests over unit tests",
    "Don't mock excessively - test real behavior where possible",
    "Coverage metrics are meaningless - user flow coverage is everything"
  ],
  "userStories": [
    {
      "id": "c17273b8-646a-415c-abf8-0ee48f4345b9",
      "title": "Install telemetry hooks to ~/.claude/hooks/ and configure settings.json",
      "passes": false,
      "overview": "Telemetry hooks exist in the project (`.claude/hooks/`) but are NOT installed globally or configured in `~/.claude/settings.json`. This means no telemetry is captured.",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "All 4 telemetry hooks copied to `~/.claude/hooks/`",
        "`~/.claude/settings.json` has SessionStart, PreToolUse, PostToolUse, PostToolUseFailure, UserPromptSubmit, Stop hooks configured",
        "Running `claude --print-hooks` shows telemetry hooks",
        "Starting a new Claude session creates a telemetry session in database",
        "Tool usage creates events in `telemetry_events` table"
      ],
      "references": [],
      "description": "## Problem\nTelemetry hooks exist in the project (`.claude/hooks/`) but are NOT installed globally or configured in `~/.claude/settings.json`. This means no telemetry is captured.\n\n## Spec References\n- **Lines 2382-2399**: Claude Code Specific Integration checklist\n- **Lines 2384-2398**: Required hooks (SessionStart, PreToolUse, PostToolUse, PostToolUseFailure, UserPromptSubmit, Stop)\n- **Lines 229-385**: Detailed hook implementation specs\n\n## Current State\n```\n~/.claude/hooks/\n├── enforce-state-before-write.sh  ✅ (workflow)\n├── link-commit-to-ticket.sh       ✅ (workflow)\n└── [NO TELEMETRY HOOKS]           ❌\n```\n\n## Required Changes\n\n### 1. Copy telemetry hooks to global location\n```bash\ncp .claude/hooks/start-telemetry-session.sh ~/.claude/hooks/\ncp .claude/hooks/log-tool-telemetry.sh ~/.claude/hooks/\ncp .claude/hooks/log-prompt-telemetry.sh ~/.claude/hooks/\ncp .claude/hooks/end-telemetry-session.sh ~/.claude/hooks/\n```\n\n### 2. Update ~/.claude/settings.json with telemetry hooks\nAdd these hook configurations (spec lines 2384-2398):\n- `SessionStart` → `start-telemetry-session.sh`\n- `PreToolUse` → `log-tool-telemetry.sh` (tool start)\n- `PostToolUse` → `log-tool-telemetry.sh` (tool end)\n- `PostToolUseFailure` → `log-tool-telemetry.sh` (tool failure)\n- `UserPromptSubmit` → `log-prompt-telemetry.sh`\n- `Stop` → `end-telemetry-session.sh`\n\n### 3. Update scripts/setup-claude-code.sh\nModify the setup script to install telemetry hooks alongside workflow hooks.\n\n## Acceptance Criteria\n- [ ] All 4 telemetry hooks copied to `~/.claude/hooks/`\n- [ ] `~/.claude/settings.json` has SessionStart, PreToolUse, PostToolUse, PostToolUseFailure, UserPromptSubmit, Stop hooks configured\n- [ ] Running `claude --print-hooks` shows telemetry hooks\n- [ ] Starting a new Claude session creates a telemetry session in database\n- [ ] Tool usage creates events in `telemetry_events` table",
      "priority": "high",
      "tags": [
        "telemetry",
        "hooks",
        "claude-code",
        "critical"
      ]
    },
    {
      "id": "da371598-350c-44cb-b92c-4688f981e362",
      "title": "Make MCP workflow tools create mandatory ticket comments",
      "passes": false,
      "overview": "The spec mandates that every workflow phase creates a ticket comment for audit trail. Currently, MCP tools don't create comments.",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "`start_ticket_work` creates \"Started work\" progress comment",
        "`complete_ticket_work` creates work_summary comment",
        "`submit_review_finding` creates progress comment with finding summary",
        "`mark_finding_fixed` creates progress comment",
        "`generate_demo_script` creates progress comment",
        "`submit_demo_feedback` creates comment with user feedback",
        "All comments have correct author (claude, ralph:claude, user)"
      ],
      "references": [
        "mcp-server/tools/workflow.js",
        "mcp-server/tools/workflow-v2.js"
      ],
      "description": "## Problem\nThe spec mandates that every workflow phase creates a ticket comment for audit trail. Currently, MCP tools don't create comments.\n\n## Spec References\n- **Lines 91-127**: Comments & Documentation (MANDATORY) - full table of required comments\n- **Lines 2309-2319**: Comments & Documentation checklist\n- **Lines 1601-1633**: `documentAction` helper implementation pattern\n\n## Required Comment Creation\n\n| MCP Tool | Comment Type | Content (from spec line 93-109) |\n|----------|-------------|--------------------------------|\n| `start_ticket_work` | `progress` | \"Started work on ticket. Branch: {branch}\" |\n| `complete_ticket_work` | `work_summary` | Full summary of changes made |\n| `submit_review_finding` | `progress` | \"Review found {n} issues: {P0}×P0, {P1}×P1...\" |\n| `mark_finding_fixed` | `progress` | \"Fixed: {summary} [{priority}]\" |\n| `generate_demo_script` | `progress` | \"Demo script generated with {n} steps\" |\n| `submit_demo_feedback` | `comment` | User's feedback from demo |\n| `reconcile_learnings` | `progress` | \"Updated: CLAUDE.md, {n} specs, {n} tickets\" |\n\n## Implementation Pattern (spec lines 1601-1633)\n```javascript\nasync function documentAction(ticketId, { commentType, commentContent, author }) {\n  await addTicketComment(db, {\n    ticketId,\n    content: commentContent,\n    author,\n    type: commentType,\n  });\n}\n```\n\n## Files to Modify\n- `mcp-server/tools/workflow.js` - Add comment creation to each tool\n- `mcp-server/tools/workflow-v2.js` - If separate file exists\n\n## Acceptance Criteria\n- [ ] `start_ticket_work` creates \"Started work\" progress comment\n- [ ] `complete_ticket_work` creates work_summary comment\n- [ ] `submit_review_finding` creates progress comment with finding summary\n- [ ] `mark_finding_fixed` creates progress comment\n- [ ] `generate_demo_script` creates progress comment\n- [ ] `submit_demo_feedback` creates comment with user feedback\n- [ ] All comments have correct author (claude, ralph:claude, user)",
      "priority": "high",
      "tags": [
        "mcp",
        "comments",
        "audit-trail"
      ]
    },
    {
      "id": "bc92b026-b826-4f9b-8cc1-9541f395b90e",
      "title": "Update Ralph script to enforce full workflow: ai_review → human_review → done",
      "passes": false,
      "overview": "Ralph completed tickets by going directly to `done` status, skipping:\n- AI review phase (no `submit_review_finding` calls)\n- Demo generation (no `generate_demo_script` calls)\n- Human review (no `submit_demo_feedback` calls)",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "Ralph calls `complete_ticket_work` (not direct status update)",
        "Ralph runs review agents and submits findings via MCP",
        "Ralph fixes findings and marks them fixed via MCP",
        "Ralph generates demo script via MCP",
        "Ralph STOPS at `human_review` (does not auto-complete)",
        "Tickets have workflow data populated (review_findings, demo_scripts)"
      ],
      "references": [
        "src/api/ralph.ts",
        "src/api/ralph-workflow.ts"
      ],
      "description": "## Problem\nRalph completed tickets by going directly to `done` status, skipping:\n- AI review phase (no `submit_review_finding` calls)\n- Demo generation (no `generate_demo_script` calls)\n- Human review (no `submit_demo_feedback` calls)\n\n## Spec References\n- **Lines 1319-1360**: Ticket Workflow state machine\n- **Lines 2466-2474**: Integration checklist\n- **Lines 1035-1045**: Status Updates (MANDATORY)\n- **Lines 50-64**: Workflow Gates table\n\n## Current Ralph Behavior\n```\nin_progress → done (WRONG!)\n```\n\n## Required Ralph Behavior (spec line 1323-1340)\n```\nin_progress → ai_review → human_review → done\n```\n\n### Ralph Should:\n\n1. **After implementation** (complete_ticket_work):\n   - Call `complete_ticket_work({ ticketId, summary })`\n   - Status becomes `ai_review`\n\n2. **During ai_review** phase:\n   - Run all 3 review agents in parallel\n   - Call `submit_review_finding` for each issue found\n   - Fix issues and call `mark_finding_fixed`\n   - Repeat until `check_review_complete` returns true\n\n3. **Generate demo** (when ai_review passes):\n   - Call `generate_demo_script` with test steps\n   - Status becomes `human_review`\n\n4. **STOP and wait for human**:\n   - Ralph should NOT auto-approve\n   - Ticket stays in `human_review` until human calls `submit_demo_feedback`\n\n## Files to Modify\n- `src/api/ralph.ts` - Main Ralph implementation\n- Possibly create `src/api/ralph-workflow.ts` for workflow logic\n\n## Acceptance Criteria\n- [ ] Ralph calls `complete_ticket_work` (not direct status update)\n- [ ] Ralph runs review agents and submits findings via MCP\n- [ ] Ralph fixes findings and marks them fixed via MCP\n- [ ] Ralph generates demo script via MCP\n- [ ] Ralph STOPS at `human_review` (does not auto-complete)\n- [ ] Tickets have workflow data populated (review_findings, demo_scripts)",
      "priority": "high",
      "tags": [
        "ralph",
        "workflow",
        "critical"
      ]
    },
    {
      "id": "0640944f-e839-4199-a626-c82663e80757",
      "title": "Enforce feature branch + PR workflow for epic work",
      "passes": false,
      "overview": "Phase 1 Ralph session committed 20+ commits directly to main branch instead of creating a feature branch and PR for human review.",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [
        {
          "step": 1,
          "description": "Epic-level branch creation",
          "files": []
        },
        {
          "step": 2,
          "description": "PR creation gate",
          "files": []
        },
        {
          "step": 3,
          "description": "Pre-push hook enforcement",
          "files": []
        },
        {
          "step": 4,
          "description": "Epic completion flow",
          "files": [],
          "codeTemplate": "all_tickets_done → epic_review → demo → human_approval → create_pr → merge"
        },
        {
          "step": 4,
          "description": "Epic completion flow",
          "files": [],
          "codeTemplate": "all_tickets_done → epic_review → demo → human_approval → create_pr → merge"
        }
      ],
      "acceptanceCriteria": [
        "Ralph creates feature branch when starting epic work",
        "All commits during epic go to feature branch (not main)",
        "Push to main blocked during epic work",
        "PR created before epic marked complete",
        "Human can review PR before merge"
      ],
      "references": [
        "src/api/ralph.ts"
      ],
      "description": "## Problem\nPhase 1 Ralph session committed 20+ commits directly to main branch instead of creating a feature branch and PR for human review.\n\n## Spec References\n- **Lines 78-89**: Epic Workflow Gates - \"PR Created\" is a blocking gate\n- **Lines 2466-2474**: Integration checklist\n- **Lines 3167-3173**: PR workflow requirements\n\n## Current Behavior\n```\nRalph commits → main (direct)\n```\n\n## Required Behavior (spec lines 78-89)\n```\nRalph commits → feature/epic-{id} branch → PR → human review → merge to main\n```\n\n## Implementation Requirements\n\n### 1. Epic-level branch creation\nWhen Ralph starts working on an epic:\n- Create branch: `feature/epic-{epic-id}-{slug}`\n- All ticket work happens on this branch\n\n### 2. PR creation gate\nBefore marking epic complete:\n- PR must exist for the epic branch\n- All commits should reference ticket IDs\n\n### 3. Pre-push hook enforcement\nThe existing `enforce-review-before-push.sh` should:\n- Block push to main if epic work is in progress\n- Require PR creation before push\n\n### 4. Epic completion flow\n```\nall_tickets_done → epic_review → demo → human_approval → create_pr → merge\n```\n\n## Files to Modify\n- `src/api/ralph.ts` - Add branch creation at epic start\n- `~/.claude/hooks/enforce-review-before-push.sh` - Strengthen main protection\n- Possibly add pre-commit hook for ticket ID requirement\n\n## Acceptance Criteria\n- [ ] Ralph creates feature branch when starting epic work\n- [ ] All commits during epic go to feature branch (not main)\n- [ ] Push to main blocked during epic work\n- [ ] PR created before epic marked complete\n- [ ] Human can review PR before merge",
      "priority": "high",
      "tags": [
        "git",
        "pr-workflow",
        "ralph",
        "critical"
      ]
    },
    {
      "id": "7f232e72-af4c-4678-9ab8-7185febc3a35",
      "title": "Populate ticket_workflow_state during workflow execution",
      "passes": false,
      "overview": "The `ticket_workflow_state` table exists but is never populated during workflow execution. This means we can't track workflow progress.",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "`start_ticket_work` creates/updates workflow state row",
        "All workflow flags are updated at appropriate times",
        "`review_iteration` increments correctly",
        "`review_findings_count` is accurate",
        "State is queryable for UI display"
      ],
      "references": [
        "mcp-server/tools/workflow.js",
        "mcp-server/tools/review.js"
      ],
      "description": "## Problem\nThe `ticket_workflow_state` table exists but is never populated during workflow execution. This means we can't track workflow progress.\n\n## Spec References\n- **Lines 1194-1222**: TicketWorkflowState type definition\n- **Lines 1443-1478**: Database schema for ticket_workflow_state\n- **Lines 1699-1716**: Workflow state insertion in start_ticket_work\n\n## Required State Tracking\n\nEach MCP tool should update workflow state:\n\n| MCP Tool | State Updates |\n|----------|---------------|\n| `start_ticket_work` | Create row, set `started_at` |\n| `complete_ticket_work` | Set `validation_passed=1`, `ai_review_started=1` |\n| `submit_review_finding` | Increment `review_findings_count` |\n| First finding per iteration | Increment `review_iteration` |\n| `mark_finding_fixed` | Check if all fixed → set `all_findings_fixed=1` |\n| `generate_demo_script` | Set `demo_script_generated=1`, store script ID |\n| `submit_demo_feedback` | Set `human_ran_demo=1`, `human_feedback`, `human_approved` |\n| `reconcile_learnings` | Set `learnings_reconciled=1`, store learnings |\n\n## Implementation Pattern (spec lines 1699-1716)\n```javascript\nawait db\n  .insert(ticketWorkflowState)\n  .values({\n    ticket_id: ticketId,\n    started_at: new Date().toISOString(),\n  })\n  .onConflictDoUpdate({\n    target: ticketWorkflowState.ticket_id,\n    set: { started_at: new Date().toISOString() },\n  });\n```\n\n## Files to Modify\n- `mcp-server/tools/workflow.js` - Add state updates to each tool\n- `mcp-server/tools/review.js` - Update state during review operations\n\n## Acceptance Criteria\n- [ ] `start_ticket_work` creates/updates workflow state row\n- [ ] All workflow flags are updated at appropriate times\n- [ ] `review_iteration` increments correctly\n- [ ] `review_findings_count` is accurate\n- [ ] State is queryable for UI display",
      "priority": "high",
      "tags": [
        "database",
        "workflow-state",
        "mcp"
      ]
    },
    {
      "id": "f8e7ed0c-bf76-4e7d-9cd4-6ffaaf8840a4",
      "title": "Add MCP tool self-logging for telemetry in non-hook environments",
      "passes": false,
      "overview": "In environments without hooks (VS Code, OpenCode without plugin), MCP tools should self-log telemetry events. Currently they don't.",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "All MCP workflow tools self-log when telemetry session is active",
        "Events include correlationId for pairing start/end",
        "Duration is calculated and logged",
        "Success/failure is captured",
        "Works in VS Code and other non-hook environments"
      ],
      "references": [
        "mcp-server/tools/workflow.js",
        "mcp-server/tools/review.js",
        "mcp-server/tools/demo.js"
      ],
      "description": "## Problem\nIn environments without hooks (VS Code, OpenCode without plugin), MCP tools should self-log telemetry events. Currently they don't.\n\n## Spec References\n- **Lines 951-957**: MCP Telemetry Tools Reference\n- **Lines 1003-1034**: Tool Event Capture diagram\n- **Lines 979-1002**: Coverage Comparison table\n\n## Self-Logging Pattern (spec lines 1003-1034)\n```\nMCP workflow tools (each logs itself)\n         │\n         ▼\nDirect DB insert → telemetry_events table\n```\n\n## Required Self-Logging\n\nEach MCP tool should:\n1. Check if telemetry session is active\n2. Log tool start event (before main logic)\n3. Log tool end event (after completion, with success/failure)\n\n```javascript\n// In each MCP tool\nconst session = await getActiveTelemetrySession(ticketId);\nif (session) {\n  const correlationId = crypto.randomUUID();\n  \n  // Log start\n  await logToolEvent(db, {\n    sessionId: session.id,\n    event: 'start',\n    toolName: 'start_ticket_work',\n    correlationId,\n    params: { ticketId },\n  });\n  \n  // ... tool logic ...\n  \n  // Log end\n  await logToolEvent(db, {\n    sessionId: session.id,\n    event: 'end',\n    toolName: 'start_ticket_work',\n    correlationId,\n    success: true,\n    durationMs: Date.now() - startTime,\n  });\n}\n```\n\n## Files to Modify\n- `mcp-server/tools/workflow.js` - Add self-logging to workflow tools\n- `mcp-server/tools/review.js` - Add self-logging to review tools\n- `mcp-server/tools/demo.js` - Add self-logging to demo tools\n\n## Acceptance Criteria\n- [ ] All MCP workflow tools self-log when telemetry session is active\n- [ ] Events include correlationId for pairing start/end\n- [ ] Duration is calculated and logged\n- [ ] Success/failure is captured\n- [ ] Works in VS Code and other non-hook environments",
      "priority": "medium",
      "tags": [
        "telemetry",
        "mcp",
        "vs-code"
      ]
    },
    {
      "id": "4236cfeb-2e15-4c93-a897-b0a7b83ccdef",
      "title": "Add workflow state display to ticket detail UI",
      "passes": false,
      "overview": "The ticket detail UI doesn't show workflow state (review iteration, findings count, demo status, etc.)",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "Ticket detail shows workflow progress indicator",
        "Review findings count is displayed",
        "Demo status badge shows when in human_review",
        "Kanban card shows \"Demo Ready\" for human_review tickets",
        "Workflow state refreshes when data changes"
      ],
      "references": [
        "src/components/ticket/TicketDetail.tsx",
        "src/components/board/TicketCard.tsx",
        "src/api/tickets.ts",
        "src/components/ticket/WorkflowProgress.tsx"
      ],
      "description": "## Problem\nThe ticket detail UI doesn't show workflow state (review iteration, findings count, demo status, etc.)\n\n## Spec References\n- **Lines 1061-1104**: Data Flow Diagram showing UI components\n- **Lines 2448-2465**: Human Review Approval UI requirements\n- **Lines 1086-1102**: UI mockup showing Activity Feed, Telemetry Dashboard, Claude Tasks, Review Findings\n\n## Required UI Components\n\n### 1. Workflow Progress Indicator\nShow current phase and progress:\n```\n[✓ Started] → [✓ Implemented] → [◐ AI Review] → [ Human Review] → [ Done]\n```\n\n### 2. Review Findings Panel (spec line 1097-1100)\n```\nReview Findings\n├── P0: 0\n├── P1: 1  \n├── P2: 3\n└── Fixed: 2/4\n```\n\n### 3. Demo Status Badge\nWhen in `human_review`:\n- Show \"Demo Ready\" badge on kanban card (spec line 2456)\n- Show \"Start Demo Review\" CTA in ticket detail (spec line 2457)\n\n### 4. Workflow State Summary\n```\nWorkflow State\n├── Review Iterations: 2\n├── Findings: 4 total, 2 fixed\n├── Demo Generated: Yes\n├── Human Approved: Pending\n```\n\n## Files to Modify\n- `src/components/ticket/TicketDetail.tsx` - Add workflow state display\n- `src/components/board/TicketCard.tsx` - Add status badges\n- `src/api/tickets.ts` - Add query for workflow state\n- Create `src/components/ticket/WorkflowProgress.tsx`\n\n## Acceptance Criteria\n- [ ] Ticket detail shows workflow progress indicator\n- [ ] Review findings count is displayed\n- [ ] Demo status badge shows when in human_review\n- [ ] Kanban card shows \"Demo Ready\" for human_review tickets\n- [ ] Workflow state refreshes when data changes",
      "priority": "medium",
      "tags": [
        "ui",
        "workflow-state",
        "ticket-detail"
      ]
    },
    {
      "id": "ca451996-9d95-41dc-b778-c85b1a66ed41",
      "title": "Create brain-dump doctor command for environment verification",
      "passes": false,
      "overview": "The spec mentions a `brain-dump doctor` command for verifying all environments are configured correctly. This doesn't exist yet.",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "Hooks installed in `~/.claude/hooks/`",
        "settings.json has all required hook configurations",
        "Telemetry hooks configured (SessionStart, PreToolUse, etc.)",
        "Skills installed in `~/.claude/commands/`",
        "MCP server configured",
        "Hooks in `~/.cursor/hooks/` or `.cursor/hooks/`",
        "`hooks.json` configured",
        "MCP server configured",
        "Rules in `.cursor/rules/`",
        "Plugin installed in `~/.config/opencode/plugins/`",
        "`AGENTS.md` exists",
        "MCP server configured in `opencode.json`",
        "`.vscode/mcp.json` exists",
        "`.github/copilot-instructions.md` exists",
        "MCP server accessible",
        "`pnpm brain-dump doctor` runs successfully",
        "Checks all 4 environments (Claude Code, Cursor, OpenCode, VS Code)",
        "Reports missing components clearly",
        "Suggests fix command when issues found",
        "Exit code 1 if issues found, 0 if clean"
      ],
      "references": [],
      "description": "## Problem\nThe spec mentions a `brain-dump doctor` command for verifying all environments are configured correctly. This doesn't exist yet.\n\n## Spec References\n- **Lines 2379**: \"brain-dump doctor command verifies all environments\"\n- **Lines 2483-2489**: Supported Environments table\n- **Lines 2398**: \"Verify hooks work with claude --print-hooks\"\n\n## Required Checks\n\n### Claude Code\n- [ ] Hooks installed in `~/.claude/hooks/`\n- [ ] settings.json has all required hook configurations\n- [ ] Telemetry hooks configured (SessionStart, PreToolUse, etc.)\n- [ ] Skills installed in `~/.claude/commands/`\n- [ ] MCP server configured\n\n### Cursor\n- [ ] Hooks in `~/.cursor/hooks/` or `.cursor/hooks/`\n- [ ] `hooks.json` configured\n- [ ] MCP server configured\n- [ ] Rules in `.cursor/rules/`\n\n### OpenCode\n- [ ] Plugin installed in `~/.config/opencode/plugins/`\n- [ ] `AGENTS.md` exists\n- [ ] MCP server configured in `opencode.json`\n\n### VS Code\n- [ ] `.vscode/mcp.json` exists\n- [ ] `.github/copilot-instructions.md` exists\n- [ ] MCP server accessible\n\n## Output Format\n```\nbrain-dump doctor\n\nClaude Code\n  ✓ Hooks directory exists\n  ✓ Workflow hooks installed (5/5)\n  ✗ Telemetry hooks NOT installed (0/4) ← PROBLEM!\n  ✓ Skills installed (5/5)\n  ✓ MCP server configured\n\nCursor\n  ✓ Detected at ~/.cursor\n  ✗ Hooks not configured\n  \nOpenCode\n  ✓ Plugin installed\n  ✓ AGENTS.md exists\n\nVS Code\n  ✓ Templates exist in .vscode/\n  \nIssues Found: 2\n  1. Claude Code telemetry hooks not installed\n  2. Cursor hooks not configured\n\nRun: ./scripts/install.sh to fix\n```\n\n## Files to Create/Modify\n- `cli/commands/doctor.ts` - New doctor command\n- `cli/index.ts` - Register doctor command\n\n## Acceptance Criteria\n- [ ] `pnpm brain-dump doctor` runs successfully\n- [ ] Checks all 4 environments (Claude Code, Cursor, OpenCode, VS Code)\n- [ ] Reports missing components clearly\n- [ ] Suggests fix command when issues found\n- [ ] Exit code 1 if issues found, 0 if clean",
      "priority": "medium",
      "tags": [
        "cli",
        "doctor",
        "verification"
      ]
    },
    {
      "id": "27f7f7f6-1e4d-4d25-b58f-cfbd25daa659",
      "title": "End-to-end test: Full workflow with telemetry capture",
      "passes": false,
      "overview": "Need to verify the entire workflow works end-to-end with actual telemetry capture, not just unit tests.",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "`telemetry_sessions` has 1 session",
        "`telemetry_events` has tool events (start/end pairs)",
        "`review_findings` has 3 findings (all fixed)",
        "`demo_scripts` has 1 demo",
        "`ticket_workflow_state` has complete state",
        "`ticket_comments` has all mandatory comments",
        "Test creates ticket and runs full workflow",
        "All telemetry data is captured",
        "All workflow state is populated",
        "All comments are created",
        "Test can run in CI"
      ],
      "references": [],
      "description": "## Problem\nNeed to verify the entire workflow works end-to-end with actual telemetry capture, not just unit tests.\n\n## Spec References\n- **Lines 894-946**: Telemetry Data Flow diagram\n- **Lines 979-1002**: Coverage Comparison table\n- **Lines 2466-2474**: Integration checklist\n\n## Test Scenario\n\nSimulate a complete ticket lifecycle and verify data capture:\n\n### 1. Setup\n- Create test project and ticket\n- Install telemetry hooks\n- Start Claude Code session (simulated)\n\n### 2. Workflow Execution\n```\nstart_ticket_work → creates telemetry session\n  ↓\n[Tool calls] → events captured\n  ↓\ncomplete_ticket_work → status = ai_review\n  ↓\nsubmit_review_finding (x3) → findings in DB\n  ↓\nmark_finding_fixed (x3) → findings updated\n  ↓\ngenerate_demo_script → demo in DB\n  ↓\nsubmit_demo_feedback(passed=true) → status = done\n```\n\n### 3. Verification\nQuery database and verify:\n- [ ] `telemetry_sessions` has 1 session\n- [ ] `telemetry_events` has tool events (start/end pairs)\n- [ ] `review_findings` has 3 findings (all fixed)\n- [ ] `demo_scripts` has 1 demo\n- [ ] `ticket_workflow_state` has complete state\n- [ ] `ticket_comments` has all mandatory comments\n\n## Files to Create\n- `e2e/full-workflow-telemetry.spec.ts` - Playwright test\n\n## Acceptance Criteria\n- [ ] Test creates ticket and runs full workflow\n- [ ] All telemetry data is captured\n- [ ] All workflow state is populated\n- [ ] All comments are created\n- [ ] Test can run in CI",
      "priority": "medium",
      "tags": [
        "e2e",
        "testing",
        "telemetry"
      ]
    },
    {
      "id": "f1a63837-c3a4-447c-8b47-807cd4d53e9f",
      "title": "Update install.sh to include telemetry hooks installation",
      "passes": false,
      "overview": "The current `scripts/install.sh` and `scripts/setup-claude-code.sh` install workflow enforcement hooks but NOT telemetry capture hooks.",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "Running `./scripts/install.sh` installs telemetry hooks",
        "`~/.claude/hooks/` contains all 4 telemetry scripts",
        "`~/.claude/settings.json` has telemetry hook configurations",
        "`claude --print-hooks` shows telemetry hooks",
        "Installation is idempotent (can run multiple times safely)"
      ],
      "references": [],
      "description": "## Problem\nThe current `scripts/install.sh` and `scripts/setup-claude-code.sh` install workflow enforcement hooks but NOT telemetry capture hooks.\n\n## Spec References\n- **Lines 2368-2380**: Installation & Multi-Environment checklist\n- **Lines 2382-2399**: Claude Code Specific Integration\n- **Lines 2384-2398**: Required telemetry hooks list\n\n## Current install.sh Behavior\n```\n✓ Installs workflow enforcement hooks\n✓ Installs skills\n✗ Does NOT install telemetry hooks\n```\n\n## Required Changes\n\n### 1. Copy telemetry hook scripts\n```bash\n# In install_claude_code()\ncp \"$BRAIN_DUMP_DIR/.claude/hooks/start-telemetry-session.sh\" \"$HOME/.claude/hooks/\"\ncp \"$BRAIN_DUMP_DIR/.claude/hooks/log-tool-telemetry.sh\" \"$HOME/.claude/hooks/\"\ncp \"$BRAIN_DUMP_DIR/.claude/hooks/log-prompt-telemetry.sh\" \"$HOME/.claude/hooks/\"\ncp \"$BRAIN_DUMP_DIR/.claude/hooks/end-telemetry-session.sh\" \"$HOME/.claude/hooks/\"\nchmod +x \"$HOME/.claude/hooks/\"*.sh\n```\n\n### 2. Update settings.json merger\nThe existing `merge-telemetry-hooks.sh` should be called, or its logic integrated:\n- Add `SessionStart` hook configuration\n- Add `PreToolUse` hook for all tools (telemetry logging)\n- Add `PostToolUse` hook for all tools\n- Add `PostToolUseFailure` hook\n- Add `UserPromptSubmit` hook\n- Add `Stop` hook\n\n### 3. Verify installation\nAfter installation, verify:\n```bash\nclaude --print-hooks | grep telemetry\n```\n\n## Files to Modify\n- `scripts/install.sh` - Add telemetry hook installation\n- `scripts/setup-claude-code.sh` - Add telemetry hook configuration\n- `.claude/hooks/merge-telemetry-hooks.sh` - Ensure it works correctly\n\n## Acceptance Criteria\n- [ ] Running `./scripts/install.sh` installs telemetry hooks\n- [ ] `~/.claude/hooks/` contains all 4 telemetry scripts\n- [ ] `~/.claude/settings.json` has telemetry hook configurations\n- [ ] `claude --print-hooks` shows telemetry hooks\n- [ ] Installation is idempotent (can run multiple times safely)",
      "priority": "high",
      "tags": [
        "install",
        "telemetry",
        "hooks",
        "critical"
      ]
    },
    {
      "id": "ad9a319d-dadf-464b-9093-7b3749b50152",
      "title": "Fix status migration: Convert remaining 'review' tickets to new statuses",
      "passes": false,
      "overview": "During Phase 1, tickets were left in the deprecated `review` status. The migration to `ai_review`/`human_review`/`done` didn't run properly on the production database.",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "No tickets have `status = 'review'`",
        "Completed tickets are in `done`",
        "In-progress review tickets are in `ai_review`",
        "UI shows all tickets correctly",
        "Migration is reversible (has down migration)"
      ],
      "references": [
        "src/lib/migrations/0010_migrate_review_status.sql"
      ],
      "description": "## Problem\nDuring Phase 1, tickets were left in the deprecated `review` status. The migration to `ai_review`/`human_review`/`done` didn't run properly on the production database.\n\n## Evidence\n```sql\nSELECT status, COUNT(*) FROM tickets \nWHERE epic_id = 'a5c97489-...' \nGROUP BY status;\n-- Result: review: 18, in_progress: 1\n```\n\nThe kanban board doesn't show a `review` column anymore, so these tickets are invisible.\n\n## Spec References\n- **Lines 2300-2307**: Status Cleanup checklist\n- **Lines 1404-1410**: Why Remove the `review` Status?\n- **Lines 37-48**: Ticket Statuses (Cleaned Up) table\n\n## Required Actions\n\n### 1. Create migration script\n```sql\n-- Migrate old 'review' status to new statuses\n-- For completed work (has work summary), move to 'done'\nUPDATE tickets \nSET status = 'done', \n    completed_at = COALESCE(completed_at, datetime('now'))\nWHERE status = 'review'\n  AND id IN (\n    SELECT ticket_id FROM ticket_comments \n    WHERE type = 'work_summary'\n  );\n\n-- For incomplete work, move to 'ai_review'\nUPDATE tickets \nSET status = 'ai_review'\nWHERE status = 'review';\n```\n\n### 2. Add migration file\nCreate `src/lib/migrations/0010_migrate_review_status.sql`\n\n### 3. Prevent future regressions\nAdd check constraint or validation to prevent `review` status from being set.\n\n## Files to Modify\n- Create migration file\n- Run migration with `pnpm db:migrate`\n\n## Acceptance Criteria\n- [ ] No tickets have `status = 'review'`\n- [ ] Completed tickets are in `done`\n- [ ] In-progress review tickets are in `ai_review`\n- [ ] UI shows all tickets correctly\n- [ ] Migration is reversible (has down migration)",
      "priority": "high",
      "tags": [
        "database",
        "migration",
        "status",
        "critical"
      ]
    },
    {
      "id": "45767992-b62d-43ad-ad0b-58072a819855",
      "title": "Create workflow skills (/next-task, /review-ticket, /review-epic, /demo, /reconcile-learnings)",
      "passes": false,
      "overview": "The spec requires 5 workflow skills to be created and installed, but Phase 2 has no tickets for this.",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "All 5 skills created in `.claude/commands/`",
        "Skills follow spec implementation guide format",
        "Install script copies skills to `~/.claude/commands/`",
        "Skills are accessible via `/command-name` in Claude Code",
        "Skills work correctly when invoked"
      ],
      "references": [],
      "description": "## Problem\nThe spec requires 5 workflow skills to be created and installed, but Phase 2 has no tickets for this.\n\n## Spec References\n- **Lines 2360-2366**: Skills checklist\n- **Lines 2192-2225**: `/next-task` skill implementation guide\n- **Lines 2227-2291**: `/review-ticket` skill implementation guide\n\n## Required Skills\n\n### 1. `/next-task` skill\n**Location**: `.claude/commands/next-task.md`\n**Purpose**: Pick up the next task with precondition checking\n**Content**: See spec lines 2192-2225\n\n### 2. `/review-ticket` skill\n**Location**: `.claude/commands/review-ticket.md`\n**Purpose**: Run full review workflow on a ticket\n**Content**: See spec lines 2227-2291\n\n### 3. `/review-epic` skill\n**Location**: `.claude/commands/review-epic.md`\n**Purpose**: Run Tracer Review on an entire epic\n**Content**: Similar to review-ticket but for epic-level review\n\n### 4. `/demo` skill\n**Location**: `.claude/commands/demo.md`\n**Purpose**: Generate demo script after AI review passes\n**Content**: Guide for demo generation workflow\n\n### 5. `/reconcile-learnings` skill\n**Location**: `.claude/commands/reconcile-learnings.md`\n**Purpose**: Extract and apply learnings to project docs\n**Content**: Guide for updating CLAUDE.md and specs\n\n## Installation Requirements\n\nSkills should be:\n1. Created in `.claude/commands/` (project-level)\n2. Copied to `~/.claude/commands/` (global) by install script\n3. Available in all Claude Code sessions\n\n## Files to Create\n- `.claude/commands/next-task.md`\n- `.claude/commands/review-ticket.md`\n- `.claude/commands/review-epic.md`\n- `.claude/commands/demo.md`\n- `.claude/commands/reconcile-learnings.md`\n\n## Files to Modify\n- `scripts/install.sh` - Add `install_skills()` function to copy skills globally\n- `scripts/setup-claude-code.sh` - Ensure skills are installed\n\n## Acceptance Criteria\n- [ ] All 5 skills created in `.claude/commands/`\n- [ ] Skills follow spec implementation guide format\n- [ ] Install script copies skills to `~/.claude/commands/`\n- [ ] Skills are accessible via `/command-name` in Claude Code\n- [ ] Skills work correctly when invoked",
      "priority": "high",
      "tags": [
        "skills",
        "claude-code",
        "workflow"
      ]
    },
    {
      "id": "5ded08ee-39e5-4c8c-970a-dbcd0b2061e6",
      "title": "OpenCode integration: Plugin, AGENTS.md, skills, and install script support",
      "passes": false,
      "overview": "OpenCode integration is completely missing from Phase 2. The spec requires a full OpenCode plugin, AGENTS.md template, skills, and install script integration.",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "Plugin created with all required event handlers",
        "Plugin installed to global OpenCode plugins directory",
        "AGENTS.md template created",
        "Skill created in `.opencode/skills/`",
        "Install script detects OpenCode and installs plugin",
        "Install script creates AGENTS.md if not exists",
        "Plugin tested with `opencode mcp debug brain-dump`",
        "Documentation references OpenCode plugin docs",
        "Telemetry captured correctly via plugin events"
      ],
      "references": [],
      "description": "## Problem\nOpenCode integration is completely missing from Phase 2. The spec requires a full OpenCode plugin, AGENTS.md template, skills, and install script integration.\n\n## Spec References\n- **Lines 2401-2415**: OpenCode Specific Integration checklist\n- **Lines 386-563**: OpenCode Telemetry (Plugins + MCP) implementation details\n- **Lines 534-563**: OpenCode Configuration and Rules\n\n## Required Components\n\n### 1. Brain Dump Plugin\n**File**: `~/.config/opencode/plugins/brain-dump-telemetry.ts` (global)\n**Purpose**: Capture telemetry via OpenCode plugin events\n**Events to implement**:\n- `tool.execute.before` - Log tool start\n- `tool.execute.after` - Log tool end\n- `session.created` - Start telemetry session\n- `session.idle` - End telemetry session\n\n**Implementation**: See spec lines 407-500 for full plugin code\n\n### 2. AGENTS.md Template\n**File**: `.opencode/AGENTS.md` or `~/.config/opencode/AGENTS.md`\n**Purpose**: Workflow enforcement rules for OpenCode\n**Content**: See spec lines 534-563\n\n### 3. OpenCode Skill\n**File**: `.opencode/skills/brain-dump-workflow/SKILL.md`\n**Purpose**: Reusable workflow guidance\n**Content**: See spec lines 565-599\n\n### 4. opencode.json Configuration\n**File**: `opencode.json` snippet\n**Purpose**: MCP server configuration\n**Content**: See spec lines 516-532\n\n### 5. Install Script Integration\n**File**: `scripts/install.sh`\n**Changes**:\n- Detect OpenCode installation\n- Copy plugin to `~/.config/opencode/plugins/`\n- Create `AGENTS.md` if not exists\n- Configure `opencode.json` with MCP server\n\n## Files to Create\n- `~/.config/opencode/plugins/brain-dump-telemetry.ts` (template in repo, copied on install)\n- `.opencode/AGENTS.md` (template)\n- `.opencode/skills/brain-dump-workflow/SKILL.md`\n- `docs/opencode-integration.md` (documentation)\n\n## Files to Modify\n- `scripts/install.sh` - Add OpenCode detection and plugin installation\n- `scripts/uninstall.sh` - Add OpenCode cleanup\n\n## Acceptance Criteria\n- [ ] Plugin created with all required event handlers\n- [ ] Plugin installed to global OpenCode plugins directory\n- [ ] AGENTS.md template created\n- [ ] Skill created in `.opencode/skills/`\n- [ ] Install script detects OpenCode and installs plugin\n- [ ] Install script creates AGENTS.md if not exists\n- [ ] Plugin tested with `opencode mcp debug brain-dump`\n- [ ] Documentation references OpenCode plugin docs\n- [ ] Telemetry captured correctly via plugin events",
      "priority": "high",
      "tags": [
        "opencode",
        "telemetry",
        "integration"
      ]
    },
    {
      "id": "592a97e0-0622-4dc7-b887-9db0cbfa8e06",
      "title": "VS Code integration: MCP config, copilot instructions, skills, and install script support",
      "passes": false,
      "overview": "VS Code integration is completely missing from Phase 2. The spec requires MCP configuration, copilot instructions, skills, and install script integration.",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "`.vscode/mcp.json` template created",
        "`.github/copilot-instructions.md` template created",
        "`.github/skills/brain-dump-workflow.skill.md` created",
        "Install script detects VS Code",
        "Install script creates MCP config",
        "Install script offers to create copilot instructions",
        "MCP server works with VS Code stdio transport",
        "Documentation explains VS Code MCP server trust flow",
        "Workflow guidance works via instructions + MCP preconditions"
      ],
      "references": [],
      "description": "## Problem\nVS Code integration is completely missing from Phase 2. The spec requires MCP configuration, copilot instructions, skills, and install script integration.\n\n## Spec References\n- **Lines 2417-2427**: VS Code Specific Integration checklist\n- **Lines 625-682**: VS Code Telemetry (Extension + Instructions + MCP) implementation\n- **Lines 2913-2948**: VS Code Additional Setup\n\n## Required Components\n\n### 1. MCP Configuration Template\n**File**: `.vscode/mcp.json` (project-level, shareable)\n**Purpose**: MCP server configuration for VS Code\n**Content**: See spec lines 2900-2910\n\n### 2. Copilot Instructions Template\n**File**: `.github/copilot-instructions.md`\n**Purpose**: Workflow enforcement via prompt guidance\n**Content**: See spec lines 639-658\n\n### 3. VS Code Skill\n**File**: `.github/skills/brain-dump-workflow.skill.md`\n**Purpose**: Auto-activated workflow guidance\n**Content**: See spec lines 660-682\n\n### 4. Install Script Integration\n**File**: `scripts/install.sh`\n**Changes**:\n- Detect VS Code installation\n- Create `.vscode/mcp.json` template\n- Offer to create `.github/copilot-instructions.md`\n- Copy skill to `.github/skills/`\n\n### 5. Documentation\n**File**: `docs/vscode-integration.md`\n**Content**:\n- MCP server trust flow\n- How to enable MCP in VS Code settings\n- Custom instructions setup\n\n## Files to Create\n- `.vscode/mcp.json` (template)\n- `.github/copilot-instructions.md` (template)\n- `.github/skills/brain-dump-workflow.skill.md`\n- `docs/vscode-integration.md`\n\n## Files to Modify\n- `scripts/install.sh` - Add VS Code detection and config creation\n- `scripts/uninstall.sh` - Add VS Code cleanup\n\n## Acceptance Criteria\n- [ ] `.vscode/mcp.json` template created\n- [ ] `.github/copilot-instructions.md` template created\n- [ ] `.github/skills/brain-dump-workflow.skill.md` created\n- [ ] Install script detects VS Code\n- [ ] Install script creates MCP config\n- [ ] Install script offers to create copilot instructions\n- [ ] MCP server works with VS Code stdio transport\n- [ ] Documentation explains VS Code MCP server trust flow\n- [ ] Workflow guidance works via instructions + MCP preconditions",
      "priority": "medium",
      "tags": [
        "vscode",
        "integration",
        "mcp"
      ]
    },
    {
      "id": "a3412843-1b9f-4273-872d-605aee54c660",
      "title": "Cursor integration: Hooks, rules, skills, MCP config, and install script support",
      "passes": false,
      "overview": "Cursor integration is completely missing from Phase 2. The spec requires hooks, rules, skills, MCP configuration, and install script integration.",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "All 6 hooks created",
        "`.cursor/hooks.json` configured correctly",
        "`.cursor/mcp.json` template created",
        "`.cursor/rules/brain-dump-workflow.md` created",
        "`.cursor/skills/brain-dump-workflow/SKILL.md` created",
        "Install script detects Cursor",
        "Install script installs hooks globally",
        "Install script creates/updates hooks.json",
        "Cursor hook compatibility tested (loads Claude hooks)",
        "MCP server compatibility verified",
        "Documentation explains Cursor-specific differences"
      ],
      "references": [],
      "description": "## Problem\nCursor integration is completely missing from Phase 2. The spec requires hooks, rules, skills, MCP configuration, and install script integration.\n\n## Spec References\n- **Lines 2429-2446**: Cursor Specific Integration checklist\n- **Lines 684-833**: Cursor Telemetry (Hooks + MCP) implementation\n- **Lines 3340-3372**: Cursor Documentation references\n\n## Required Components\n\n### 1. Cursor Hooks\n**Directory**: `.cursor/hooks/` (project) or `~/.cursor/hooks/` (global)\n**Hooks to create**:\n- `sessionStart` - Start telemetry session\n- `sessionEnd` - End telemetry session\n- `preToolUse` - Log tool start\n- `postToolUse` - Log tool end (success)\n- `postToolUseFailure` - Log tool end (failure)\n- `beforeSubmitPrompt` - Capture user prompt\n\n**Implementation**: See spec lines 767-800 for hook script example\n\n### 2. Hooks Configuration\n**File**: `.cursor/hooks.json` or `~/.cursor/hooks.json`\n**Purpose**: Hook configuration file\n**Content**: See spec lines 729-764\n\n### 3. MCP Configuration\n**File**: `.cursor/mcp.json`\n**Purpose**: MCP server configuration\n**Content**: See spec lines 865-876\n\n### 4. Cursor Rules\n**File**: `.cursor/rules/brain-dump-workflow.md`\n**Purpose**: Workflow enforcement rules\n**Content**: See spec lines 803-832\n\n### 5. Cursor Skill\n**File**: `.cursor/skills/brain-dump-workflow/SKILL.md`\n**Purpose**: Reusable workflow guidance\n**Content**: See spec lines 834-863\n\n### 6. Install Script Integration\n**File**: `scripts/install.sh`\n**Changes**:\n- Detect Cursor installation\n- Copy hooks to `~/.cursor/hooks/`\n- Create or update `.cursor/hooks.json`\n- Create `.cursor/mcp.json` template\n- Create `.cursor/rules/brain-dump-workflow.md`\n- Create `.cursor/skills/brain-dump-workflow/SKILL.md`\n\n### 7. Claude Code Hook Compatibility\n**Note**: Cursor can load Claude Code hooks directly (spec line 2444)\n- Test that Cursor loads `.claude/settings.json` hooks\n- Document any format differences\n\n## Files to Create\n- `.cursor/hooks/sessionStart.sh`\n- `.cursor/hooks/sessionEnd.sh`\n- `.cursor/hooks/preToolUse.sh`\n- `.cursor/hooks/postToolUse.sh`\n- `.cursor/hooks/postToolUseFailure.sh`\n- `.cursor/hooks/beforeSubmitPrompt.sh`\n- `.cursor/hooks.json` (template)\n- `.cursor/mcp.json` (template)\n- `.cursor/rules/brain-dump-workflow.md`\n- `.cursor/skills/brain-dump-workflow/SKILL.md`\n- `docs/cursor-integration.md`\n\n## Files to Modify\n- `scripts/install.sh` - Add Cursor detection and hook installation\n- `scripts/uninstall.sh` - Add Cursor cleanup\n\n## Acceptance Criteria\n- [ ] All 6 hooks created\n- [ ] `.cursor/hooks.json` configured correctly\n- [ ] `.cursor/mcp.json` template created\n- [ ] `.cursor/rules/brain-dump-workflow.md` created\n- [ ] `.cursor/skills/brain-dump-workflow/SKILL.md` created\n- [ ] Install script detects Cursor\n- [ ] Install script installs hooks globally\n- [ ] Install script creates/updates hooks.json\n- [ ] Cursor hook compatibility tested (loads Claude hooks)\n- [ ] MCP server compatibility verified\n- [ ] Documentation explains Cursor-specific differences",
      "priority": "high",
      "tags": [
        "cursor",
        "hooks",
        "integration"
      ]
    },
    {
      "id": "f1aa0de8-9baf-4d24-918c-36aeef303fdd",
      "title": "Human Review Approval UI: DemoPanel, DemoStep components, server functions, and TanStack Query hooks",
      "passes": false,
      "overview": "The existing ticket \"Add workflow state display to ticket detail UI\" only covers workflow state display, not the full demo approval UI required by the spec.",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "DemoPanel component shows demo steps",
        "DemoStep component has pass/fail/skip buttons",
        "Notes field for each step",
        "Overall feedback text area",
        "\"Approve & Complete\" button validates all steps marked",
        "\"Request Changes\" button requires failed step or feedback",
        "Kanban card shows \"Demo Ready\" badge when in human_review",
        "Ticket detail shows prominent \"Start Demo Review\" CTA",
        "Toast notification when ticket enters human_review",
        "`getDemoScript` server function works",
        "`updateDemoStep` server function works",
        "`submitDemoFeedback` server function works",
        "`useDemoScript` TanStack Query hook works",
        "Approval triggers `/reconcile-learnings` prompt",
        "Rejection creates comment with issues for AI"
      ],
      "references": [
        "src/components/ticket/DemoPanel.tsx",
        "src/components/ticket/DemoStep.tsx",
        "src/api/demo.ts",
        "src/lib/hooks.ts",
        "src/components/board/TicketCard.tsx",
        "src/components/ticket/TicketDetail.tsx"
      ],
      "description": "## Problem\nThe existing ticket \"Add workflow state display to ticket detail UI\" only covers workflow state display, not the full demo approval UI required by the spec.\n\n## Spec References\n- **Lines 2448-2464**: Human Review Approval UI checklist\n- **Lines 2961-3210**: Human Review Approval UI detailed requirements\n- **Lines 3114-3165**: Data Flow for Human Approval\n\n## Required UI Components\n\n### 1. DemoPanel Component\n**File**: `src/components/ticket/DemoPanel.tsx`\n**Purpose**: Main container for demo verification\n**Features**:\n- Shows demo title and description\n- Lists all demo steps\n- Overall feedback text area\n- Approve/Reject buttons\n\n### 2. DemoStep Component\n**File**: `src/components/ticket/DemoStep.tsx`\n**Purpose**: Individual step with pass/fail/skip buttons\n**Features**:\n- Step instruction and expected result\n- Pass (✓), Fail (✗), Skip (—) buttons\n- Notes field for each step\n- Visual status indicator\n\n### 3. Server Functions\n**File**: `src/api/demo.ts`\n**Functions**:\n- `getDemoScript(ticketId)` - Fetch demo for a ticket\n- `updateDemoStep({ demoId, stepNumber, passed, notes })` - Update step status\n- `submitDemoFeedback({ demoId, passed, feedback, stepResults })` - Submit approval/rejection\n\n### 4. TanStack Query Hooks\n**File**: `src/lib/hooks.ts`\n**Hooks**:\n- `useDemoScript(ticketId)` - Fetch demo script\n- `useUpdateDemoStep()` - Mutation for updating steps\n- `useSubmitDemoFeedback()` - Mutation for approval/rejection\n\n### 5. UI Integration\n**Files**:\n- `src/components/board/TicketCard.tsx` - Add \"Demo Ready\" badge for human_review tickets\n- `src/components/ticket/TicketDetail.tsx` - Show DemoPanel when in human_review\n- `src/components/ticket/TicketDetail.tsx` - Add \"Start Demo Review\" CTA\n\n### 6. Notifications\n**File**: `src/components/ticket/TicketDetail.tsx` or notification system\n**Features**:\n- Toast notification when ticket enters human_review\n- Badge on kanban card showing \"Demo Ready\"\n\n## Files to Create\n- `src/components/ticket/DemoPanel.tsx`\n- `src/components/ticket/DemoStep.tsx`\n- `src/api/demo.ts`\n\n## Files to Modify\n- `src/lib/hooks.ts` - Add demo-related query hooks\n- `src/components/board/TicketCard.tsx` - Add demo badge\n- `src/components/ticket/TicketDetail.tsx` - Integrate DemoPanel\n\n## Acceptance Criteria\n- [ ] DemoPanel component shows demo steps\n- [ ] DemoStep component has pass/fail/skip buttons\n- [ ] Notes field for each step\n- [ ] Overall feedback text area\n- [ ] \"Approve & Complete\" button validates all steps marked\n- [ ] \"Request Changes\" button requires failed step or feedback\n- [ ] Kanban card shows \"Demo Ready\" badge when in human_review\n- [ ] Ticket detail shows prominent \"Start Demo Review\" CTA\n- [ ] Toast notification when ticket enters human_review\n- [ ] `getDemoScript` server function works\n- [ ] `updateDemoStep` server function works\n- [ ] `submitDemoFeedback` server function works\n- [ ] `useDemoScript` TanStack Query hook works\n- [ ] Approval triggers `/reconcile-learnings` prompt\n- [ ] Rejection creates comment with issues for AI",
      "priority": "high",
      "tags": [
        "ui",
        "demo",
        "human-review"
      ]
    },
    {
      "id": "e45d09bc-94e7-454f-bbcd-1fc171fead5b",
      "title": "Verify status transitions: Atomic updates, UI real-time updates, and E2E testing",
      "passes": false,
      "overview": "No explicit ticket exists to verify that status transitions work correctly, are atomic with workflow state updates, and trigger UI updates in real-time.",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "All status transitions work correctly",
        "Status changes are atomic with workflow state updates",
        "UI reflects status changes in real-time (no refresh needed)",
        "TanStack Query invalidates correctly",
        "Kanban board updates when status changes",
        "Ticket detail page updates when status changes",
        "E2E test covers full status transition flow",
        "Atomic update test verifies transaction integrity"
      ],
      "references": [
        "mcp-server/tools/workflow.js",
        "src/api/tickets.ts"
      ],
      "description": "## Problem\nNo explicit ticket exists to verify that status transitions work correctly, are atomic with workflow state updates, and trigger UI updates in real-time.\n\n## Spec References\n- **Lines 2333-2340**: Status Updates (MANDATORY) checklist\n- **Lines 1035-1045**: Status Updates table\n- **Lines 1319-1360**: Ticket Workflow state machine\n\n## Required Verification\n\n### 1. Status Transition Verification\nVerify each status transition:\n- `ready` → `in_progress` (via `start_ticket_work`)\n- `in_progress` → `ai_review` (via `complete_ticket_work`)\n- `ai_review` → `human_review` (when all findings fixed)\n- `human_review` → `done` (via `submit_demo_feedback(passed=true)`)\n- `human_review` → `in_progress` (via `submit_demo_feedback(passed=false)` for major issues)\n\n### 2. Atomic Updates Verification\nVerify that status changes are atomic with workflow state updates:\n- When `start_ticket_work` sets status to `in_progress`, it also creates/updates `ticket_workflow_state`\n- When `complete_ticket_work` sets status to `ai_review`, it also updates workflow state\n- When demo feedback approves, status → `done` AND workflow state updated\n- All updates happen in a single transaction\n\n### 3. UI Real-Time Updates\nVerify TanStack Query invalidation:\n- Status changes trigger query invalidation\n- UI reflects status changes immediately (no manual refresh)\n- Kanban board columns update when status changes\n- Ticket detail page updates when status changes\n\n### 4. E2E Test\nCreate comprehensive E2E test:\n- Create ticket\n- Start work → verify status + workflow state\n- Complete work → verify status + workflow state\n- Submit findings → verify status stays in ai_review\n- Fix findings → verify status transitions to human_review\n- Submit demo feedback → verify status → done\n\n## Files to Create\n- `e2e/status-transitions.spec.ts` - E2E test for status transitions\n- `integration-tests/workflow-state-atomic.test.ts` - Test atomic updates\n\n## Files to Modify\n- `mcp-server/tools/workflow.js` - Ensure atomic updates (if not already)\n- `src/api/tickets.ts` - Verify query invalidation\n\n## Acceptance Criteria\n- [ ] All status transitions work correctly\n- [ ] Status changes are atomic with workflow state updates\n- [ ] UI reflects status changes in real-time (no refresh needed)\n- [ ] TanStack Query invalidates correctly\n- [ ] Kanban board updates when status changes\n- [ ] Ticket detail page updates when status changes\n- [ ] E2E test covers full status transition flow\n- [ ] Atomic update test verifies transaction integrity",
      "priority": "medium",
      "tags": [
        "testing",
        "status",
        "e2e"
      ]
    },
    {
      "id": "29633522-1f00-4f99-8e6d-ade276e435a7",
      "title": "Update install.sh for multi-environment MCP configuration (Claude Code, OpenCode, VS Code, Cursor)",
      "passes": false,
      "overview": "The install script needs to be updated to configure MCP servers for all supported environments, not just Claude Code. Currently it may only handle Claude Code.",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "Install script detects all 4 environments",
        "Install script configures MCP for Claude Code",
        "Install script configures MCP for OpenCode (if installed)",
        "Install script configures MCP for VS Code (if installed)",
        "Install script configures MCP for Cursor (if installed)",
        "Config files use correct format for each environment",
        "Cross-platform paths handled correctly (macOS/Linux/Windows)",
        "Uninstall script removes MCP config from all environments",
        "Installation is idempotent (can run multiple times safely)",
        "`brain-dump doctor` command verifies MCP configuration",
        "Documentation explains multi-environment setup"
      ],
      "references": [],
      "description": "## Problem\nThe install script needs to be updated to configure MCP servers for all supported environments, not just Claude Code. Currently it may only handle Claude Code.\n\n## Spec References\n- **Lines 2368-2380**: Installation & Multi-Environment checklist\n- **Lines 2562-2688**: Install Script Requirements\n- **Lines 2783-2911**: Configuration file locations and MCP config differences\n\n## Required Changes\n\n### 1. Multi-Environment Detection\n**File**: `scripts/install.sh`\n**Function**: `detect_environments()`\n**Purpose**: Detect which environments are installed\n**Logic**: See spec lines 2828-2857\n\n### 2. MCP Server Configuration\n**File**: `scripts/install.sh`\n**Function**: `install_mcp_server()`\n**Environments to configure**:\n- **Claude Code**: `~/.claude/settings.json` (or `~/.claude.json`)\n- **OpenCode**: `~/.config/opencode/opencode.json` or project `opencode.json`\n- **VS Code**: `.vscode/mcp.json` (workspace) or global settings\n- **Cursor**: `.cursor/mcp.json` or `~/.cursor/mcp.json`\n\n**Config formats**: See spec lines 2868-2911\n\n### 3. Environment-Specific Config Files\nCreate templates/configs for each environment:\n- Claude Code: Already handled\n- OpenCode: Add to `opencode.json` under `mcp` key\n- VS Code: Create `.vscode/mcp.json` template\n- Cursor: Create `.cursor/mcp.json` template\n\n### 4. Cross-Platform Support\nHandle different config file locations by OS:\n- **macOS**: See spec lines 2862-2866\n- **Linux**: See spec lines 2862-2866\n- **Windows**: See spec lines 2862-2866\n\n### 5. Uninstall Support\n**File**: `scripts/uninstall.sh`\n**Function**: `uninstall_mcp_server()`\n**Purpose**: Cleanly remove MCP config from all environments\n**Logic**: See spec lines 2672-2706\n\n## Files to Modify\n- `scripts/install.sh` - Add multi-environment MCP configuration\n- `scripts/uninstall.sh` - Add multi-environment cleanup\n\n## Files to Create\n- `.vscode/mcp.json` (template)\n- `.cursor/mcp.json` (template)\n- `docs/multi-environment-setup.md` (documentation)\n\n## Acceptance Criteria\n- [ ] Install script detects all 4 environments\n- [ ] Install script configures MCP for Claude Code\n- [ ] Install script configures MCP for OpenCode (if installed)\n- [ ] Install script configures MCP for VS Code (if installed)\n- [ ] Install script configures MCP for Cursor (if installed)\n- [ ] Config files use correct format for each environment\n- [ ] Cross-platform paths handled correctly (macOS/Linux/Windows)\n- [ ] Uninstall script removes MCP config from all environments\n- [ ] Installation is idempotent (can run multiple times safely)\n- [ ] `brain-dump doctor` command verifies MCP configuration\n- [ ] Documentation explains multi-environment setup",
      "priority": "high",
      "tags": [
        "install",
        "mcp",
        "multi-environment"
      ]
    },
    {
      "id": "c67df4aa-8112-444d-ae1d-aaef9cb7610b",
      "title": "Implement start_epic_work MCP tool: Create epic branch and ensure all tickets use same branch/PR",
      "passes": false,
      "overview": "The Phase 2 epic requires all tickets to be worked on in a single branch/PR, but there's no mechanism to:\n1. Create an epic-level branch when starting work on an epic\n2. Ensure all tickets in that epic use the same branch (instead of creating individual ticket branches)\n3. Track that all epic work is happening in one PR\nCurrently, `start_ticket_work` creates a branch per ticket (`feature/{ticket-id}-{slug}`), which would result in multiple PRs for the epic instead of one.",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "`start_epic_work` tool creates epic branch",
        "`start_epic_work` stores branch name in `epic_workflow_state`",
        "`start_ticket_work` detects epic and uses epic branch if exists",
        "`start_ticket_work` creates epic branch if missing (or errors with helpful message)",
        "All tickets in epic use same branch",
        "Epic branch can be used for single PR",
        "PR creation is tracked in epic workflow state",
        "Epic completion requires PR to exist",
        "Works for both Ralph and human/AI workflows"
      ],
      "references": [
        "mcp-server/tools/workflow.js",
        "src/lib/schema.ts",
        "mcp-server/lib/git-utils.js"
      ],
      "description": "## Problem\nThe Phase 2 epic requires all tickets to be worked on in a single branch/PR, but there's no mechanism to:\n1. Create an epic-level branch when starting work on an epic\n2. Ensure all tickets in that epic use the same branch (instead of creating individual ticket branches)\n3. Track that all epic work is happening in one PR\n\nCurrently, `start_ticket_work` creates a branch per ticket (`feature/{ticket-id}-{slug}`), which would result in multiple PRs for the epic instead of one.\n\n## Required Solution\n\n### 1. Create `start_epic_work` MCP Tool\n**File**: `mcp-server/tools/workflow.js`\n**Purpose**: Initialize epic work with a single branch\n**Behavior**:\n- Creates branch: `feature/epic-{epic-short-id}-{slug}` (using existing `generateEpicBranchName`)\n- Stores epic branch name in epic metadata or `epic_workflow_state`\n- Returns branch name and epic context\n- Creates initial commit or empty commit to establish branch\n\n### 2. Modify `start_ticket_work` to Use Epic Branch\n**File**: `mcp-server/tools/workflow.js`\n**Logic**:\n- Check if ticket belongs to an epic\n- If epic has an active branch (epic branch exists and is current), use that branch\n- If epic branch doesn't exist, create it (or prompt to call `start_epic_work` first)\n- If ticket has no epic, create ticket-specific branch (current behavior)\n\n### 3. Epic Branch Tracking\n**Database**: `epic_workflow_state` table\n**Fields**:\n- `epic_branch_name` - Store the epic branch name\n- `epic_branch_created_at` - When branch was created\n- `pr_number` - PR number once created\n- `pr_url` - PR URL once created\n\n### 4. PR Creation Gate\n**File**: `mcp-server/tools/workflow.js` or separate tool\n**Behavior**:\n- When epic work starts, create draft PR immediately (or prompt to create)\n- Link PR to epic\n- All commits go to this PR\n- Epic completion requires PR to exist\n\n## Implementation Details\n\n### start_epic_work Tool\n```javascript\nserver.tool(\n  \"start_epic_work\",\n  {\n    description: \"Start working on an epic. Creates epic-level branch and ensures all tickets use it.\",\n    inputSchema: {\n      type: \"object\",\n      properties: {\n        epicId: { type: \"string\" },\n        createPr: { type: \"boolean\", default: true }\n      },\n      required: [\"epicId\"]\n    }\n  },\n  async ({ epicId, createPr }) => {\n    // 1. Get epic\n    // 2. Generate branch name\n    // 3. Create branch from main/dev\n    // 4. Store branch name in epic_workflow_state\n    // 5. Optionally create draft PR\n    // 6. Return branch name and epic context\n  }\n);\n```\n\n### Modified start_ticket_work Logic\n```javascript\n// In start_ticket_work:\nif (ticket.epic_id) {\n  const epicState = getEpicWorkflowState(ticket.epic_id);\n  if (epicState?.epic_branch_name) {\n    // Use existing epic branch\n    branchName = epicState.epic_branch_name;\n    // Checkout if not already on it\n    if (currentBranch !== branchName) {\n      runGitCommand(`checkout ${branchName}`);\n    }\n  } else {\n    // No epic branch exists - create it or prompt\n    return error(\"Epic branch not found. Call start_epic_work first.\");\n  }\n} else {\n  // No epic - create ticket branch (current behavior)\n  branchName = generateBranchName(ticket.id, ticket.title);\n}\n```\n\n## Files to Modify\n- `mcp-server/tools/workflow.js` - Add `start_epic_work` tool, modify `start_ticket_work`\n- `src/lib/schema.ts` - Add `epic_branch_name`, `epic_branch_created_at` to `epic_workflow_state`\n- `mcp-server/lib/git-utils.js` - Already has `generateEpicBranchName`, may need helpers\n\n## Files to Create\n- Migration to add epic branch fields to `epic_workflow_state`\n\n## Acceptance Criteria\n- [ ] `start_epic_work` tool creates epic branch\n- [ ] `start_epic_work` stores branch name in `epic_workflow_state`\n- [ ] `start_ticket_work` detects epic and uses epic branch if exists\n- [ ] `start_ticket_work` creates epic branch if missing (or errors with helpful message)\n- [ ] All tickets in epic use same branch\n- [ ] Epic branch can be used for single PR\n- [ ] PR creation is tracked in epic workflow state\n- [ ] Epic completion requires PR to exist\n- [ ] Works for both Ralph and human/AI workflows",
      "priority": "high",
      "tags": [
        "epic",
        "git",
        "pr-workflow",
        "critical"
      ]
    }
  ],
  "projectContext": {
    "techStack": [
      "Framework: TanStack Start (React 19 + Vite + Nitro)",
      "Database: SQLite with better-sqlite3, Drizzle ORM",
      "Styling: Tailwind CSS v4",
      "State: TanStack Query for server state",
      "Drag & Drop: @dnd-kit"
    ],
    "dosDonts": [
      {
        "category": "Database Queries",
        "dos": [
          "Use Drizzle ORM: `db.select().from(tickets)`",
          "Use typed schema imports: `import { tickets } from \"../lib/schema\"`",
          "Use `eq()`, `and()`, `sql` from drizzle-orm for conditions",
          "Use transactions for multi-table operations: `db.transaction(() => {...})`",
          "Use `.get()` for single row, `.all()` for multiple"
        ],
        "donts": [
          "Raw SQL strings: `db.run(\"SELECT * FROM tickets\")`",
          "String-based table names",
          "String concatenation for WHERE clauses",
          "Multiple independent queries that should be atomic",
          "Assume query returns what you expect without checking"
        ]
      },
      {
        "category": "React & TanStack Query",
        "dos": [
          "Use `useQuery` with `queryKeys` for data fetching",
          "Use `useMutation` with `onSuccess` for state changes",
          "Invalidate queries after mutations: `queryClient.invalidateQueries({ queryKey: queryKeys.tickets })`",
          "Use centralized `queryKeys` object from `src/lib/hooks.ts`",
          "Create custom hooks in `src/lib/hooks.ts` for reusable query logic"
        ],
        "donts": [
          "`useState` + `useEffect` for fetched data",
          "Direct API calls without proper cache invalidation",
          "Manual cache manipulation or refetch after every change",
          "Hardcoded query key strings throughout components",
          "Duplicate query setup in multiple components"
        ]
      },
      {
        "category": "Styling Patterns",
        "dos": [
          "Use Tailwind classes for static styles: `className=\"p-4 bg-slate-800\"`",
          "Use CSS variables for theming: `var(--bg-primary)`, `var(--shadow-modal)`",
          "Reserve inline styles for dynamic/computed values: `style={{ width: `${percent}%` }}`",
          "Define shared style constants at module level for referential stability",
          "Use `React.CSSProperties` type for inline style objects when needed"
        ],
        "donts": [
          "Inline style objects for single-use styles",
          "Hardcoded colors that don't adapt to themes",
          "Mix Tailwind and inline styles inconsistently",
          "Create new objects inside components that are reused",
          "Untyped style objects that miss IDE autocomplete"
        ]
      },
      {
        "category": "Server Functions",
        "dos": [
          "Use `createServerFn({ method: \"GET\" })` for reads, `\"POST\"` for writes",
          "Use `.inputValidator()` for type-safe input handling",
          "Return typed data directly: `return db.select().from(tickets).all()`",
          "Use `ensureExists()` for required lookups: `ensureExists(project, \"Project\")`",
          "Import from `@tanstack/react-start` (not `@tanstack/react-start/server`)"
        ],
        "donts": [
          "Mix GET/POST inconsistently",
          "Access raw input without validation",
          "Wrap in unnecessary response objects",
          "Return null and let caller handle missing data",
          "Wrong import path"
        ]
      },
      {
        "category": "MCP Tool Implementation",
        "dos": [
          "Use Zod schemas for input validation: `{ ticketId: z.string() }`",
          "Return structured `{ content: [{ type: \"text\", text: ... }] }` format",
          "Set `isError: true` for error responses",
          "Use `log.info()` / `log.error()` from `../lib/logging.js`",
          "Include helpful error messages: `\"Project not found. Use list_projects to see available.\"`"
        ],
        "donts": [
          "Trust input without validation",
          "Return plain strings",
          "Return error text without the error flag",
          "`console.log` in MCP server code",
          "Generic \"Not found\" errors"
        ]
      },
      {
        "category": "Testing Patterns (Kent C. Dodds)",
        "dos": [
          "Test user behavior: what users see, click, and experience",
          "Integration tests for workflows: test components together",
          "Real database fixtures with actual schema",
          "Tests that fail when user-facing behavior breaks",
          "Ask: \"Does this test catch bugs users would encounter?\""
        ],
        "donts": [
          "Test implementation details, internal state, or private methods",
          "Unit tests for every function",
          "Excessive mocking of internals",
          "Tests that break on refactoring internals",
          "Chase 100% code coverage as a goal"
        ]
      }
    ],
    "verificationSteps": [
      "Run `pnpm type-check` - must pass with no errors",
      "Run `pnpm lint` - must pass with no errors",
      "Run `pnpm test` - all tests must pass",
      "Added tests for new functionality (ONLY tests that verify real user behavior - see Testing Philosophy above)",
      "Used typed error classes (not generic `Error`)",
      "Used Drizzle ORM (not raw SQL) - see DO/DON'T table above",
      "Followed existing patterns from DO/DON'T tables",
      "No hardcoded values that should be configurable",
      "Existing tests still pass",
      "No regressions in related functionality",
      "Updated tests if behavior changed",
      "Did not break backward compatibility (unless explicitly requested)",
      "Manually verified in browser at `localhost:4242`",
      "Checked responsive layout",
      "Verified TanStack Query invalidates and updates correctly",
      "Accessibility: keyboard navigation works, proper ARIA labels",
      "Migration file created via `pnpm db:generate`",
      "Migration tested with `pnpm db:migrate`",
      "Backup tested if schema changed (use `pnpm brain-dump backup` then test restore)",
      "Updated `src/lib/schema.ts` with proper types and constraints",
      "Tested tool via Claude Code integration",
      "Verified error responses are informative (see DO/DON'T table)",
      "Updated tool documentation if interface changed",
      "Added Zod schema for input validation",
      "All acceptance criteria from ticket met",
      "Work summary added via `add_ticket_comment` (for Ralph sessions)",
      "Session completed with appropriate outcome (for Ralph sessions)",
      "Committed with proper message format: `feat(<ticket-id>): <description>`"
    ]
  },
  "generatedAt": "2026-01-25T08:20:20.149Z",
  "epicTitle": "Universal Quality Workflow - Phase 2: Activation & Integration",
  "epicDescription": "## Overview\n\nPhase 1 implemented the infrastructure (MCP tools, database tables, hooks, UI components). Phase 2 activates the workflow by:\n\n1. Installing and configuring telemetry hooks properly\n2. Making Ralph use the workflow it implements\n3. Enforcing PR workflow (branch + PR before merge to main)\n4. Verifying end-to-end data capture\n\n**CRITICAL: All Phase 2 tickets must be worked on in a single branch/PR.**\n- Use `start_epic_work` to create epic branch: `feature/epic-{epic-id}-{slug}`\n- All tickets in this epic will use the same branch\n- Single PR for the entire epic\n\n## Reference Spec\n`plans/specs/universal-quality-workflow.md` (3,387 lines)\n\n## Gap Analysis Evidence\n- Telemetry sessions: 0\n- Telemetry events: 0\n- Review findings: 0\n- Demo scripts: 0\n\nAll infrastructure exists but was never activated during Phase 1."
}
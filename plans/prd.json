{
  "projectName": "Brain Dump",
  "projectPath": "/Users/salman.rana/code/brain-dump",
  "testingRequirements": [
    "Tests must validate user-facing behavior, not implementation details",
    "Focus on what users actually do - integration tests over unit tests",
    "Don't mock excessively - test real behavior where possible",
    "Coverage metrics are meaningless - user flow coverage is everything"
  ],
  "userStories": [
    {
      "id": "b81a2c29-79c9-4587-b139-8ca52e85422b",
      "title": "Design data model for Claude Tasks storage",
      "passes": true,
      "overview": "Design and implement the database schema for storing Claude's tasks that are created when working on tickets.\nWhen Claude works on a ticket (either interactively or via Ralph), it creates tasks using the TaskCreate tool. These tasks represent Claude's breakdown of the work and should be captured and associated with the ticket for visibility.",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "Implement as described",
        "Verify functionality works as expected"
      ],
      "references": [],
      "description": "## Overview\n\nDesign and implement the database schema for storing Claude's tasks that are created when working on tickets.\n\n## Context\n\nWhen Claude works on a ticket (either interactively or via Ralph), it creates tasks using the TaskCreate tool. These tasks represent Claude's breakdown of the work and should be captured and associated with the ticket for visibility.\n\n## Requirements\n\n- Store tasks with: id, subject, description, status, activeForm, created_at, updated_at\n- Associate tasks with a ticket_id\n- Support both pending, in_progress, and completed statuses\n- Track task ordering/position\n- Consider storing the full task history vs. just current state\n\n## Considerations\n\n- Should this be a new `claude_tasks` table or a JSON column on tickets?\n- How to handle task updates (overwrite vs. append history)?\n- Retention policy for completed task data",
      "priority": "high",
      "tags": [
        "database",
        "schema",
        "design"
      ]
    },
    {
      "id": "3ebe925e-acaa-4718-b3df-47fdcca62e18",
      "title": "Add MCP tools for Claude Tasks management",
      "passes": true,
      "overview": "Create MCP tools to store and retrieve Claude's tasks associated with tickets.",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "Implement as described",
        "Verify functionality works as expected"
      ],
      "references": [],
      "description": "## Overview\n\nCreate MCP tools to store and retrieve Claude's tasks associated with tickets.\n\n## Tools to Implement\n\n### `save_claude_tasks`\nSave the current task list to a ticket. Called when Claude creates/updates tasks while working on a ticket.\n\nInput:\n- ticketId: string\n- tasks: array of { id, subject, description, status, activeForm }\n\n### `get_claude_tasks`\nRetrieve stored Claude tasks for a ticket.\n\nInput:\n- ticketId: string\n\nOutput:\n- Array of tasks with full details\n\n## Integration Points\n\n- Should be called automatically via hooks when TaskCreate/TaskUpdate is used\n- Or called explicitly by Claude when task planning is complete\n- Consider auto-detection of active ticket from Ralph state",
      "priority": "high",
      "tags": [
        "mcp",
        "api",
        "tools"
      ]
    },
    {
      "id": "6d3ee693-5bd3-49d3-85a5-5321d8f0fa0a",
      "title": "Build UI component for Claude Tasks display",
      "passes": true,
      "overview": "Create a UI component to display Claude's tasks in the ticket details view.",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "Implement as described",
        "Verify functionality works as expected"
      ],
      "references": [],
      "description": "## Overview\n\nCreate a UI component to display Claude's tasks in the ticket details view.\n\n## Design Requirements\n\n- Dedicated \"Claude Tasks\" section in ticket details (not mixed with acceptance criteria)\n- Show task subject, status indicator, and description on expand\n- Visual distinction between pending/in_progress/completed tasks\n- Show timestamps (when task was created, last updated)\n- Collapsible section to not overwhelm the view\n\n## Component Structure\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ ğŸ¤– Claude Tasks                    [â–¼]  â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ âœ… Investigate error logs               â”‚\nâ”‚ âœ… Check database schema                â”‚\nâ”‚ ğŸ”„ Implement fix for loading issue      â”‚\nâ”‚ â—‹  Add error handling tests             â”‚\nâ”‚ â—‹  Update documentation                 â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## Technical Notes\n\n- Use TanStack Query to fetch tasks\n- Consider real-time updates if session is active\n- Handle empty state gracefully (\"No tasks recorded for this ticket\")",
      "priority": "medium",
      "tags": [
        "frontend",
        "ui",
        "component"
      ]
    },
    {
      "id": "76af8d06-2899-4713-bff4-07dc3067bdd4",
      "title": "Add hooks to auto-capture Claude tasks",
      "passes": true,
      "overview": "Create Claude Code hooks that automatically capture tasks when Claude uses TaskCreate/TaskUpdate tools during ticket work.",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "Implement as described",
        "Verify functionality works as expected"
      ],
      "references": [],
      "description": "## Overview\n\nCreate Claude Code hooks that automatically capture tasks when Claude uses TaskCreate/TaskUpdate tools during ticket work.\n\n## Hook Design\n\n### PostToolUse Hook for TaskCreate\n- Trigger: `TaskCreate` tool usage\n- Action: Call `save_claude_tasks` MCP tool with updated task list\n- Condition: Only when Ralph session is active (`.claude/ralph-state.json` exists)\n\n### PostToolUse Hook for TaskUpdate\n- Trigger: `TaskUpdate` tool usage\n- Action: Update the stored tasks for the active ticket\n- Track status changes (pending â†’ in_progress â†’ completed)\n\n## Implementation\n\n```bash\n# hooks/capture-claude-tasks.sh\n# Reads task data from tool input/output\n# Calls MCP tool to persist to Brain Dump\n```\n\n## Considerations\n\n- Handle case where no ticket is active (skip capture)\n- Batch updates to avoid excessive MCP calls\n- Consider a \"sync_claude_tasks\" tool that captures current state on demand",
      "priority": "medium",
      "tags": [
        "hooks",
        "automation",
        "integration"
      ]
    },
    {
      "id": "14ac6bba-83e4-423c-ba09-0da3ec096c3d",
      "title": "Add Claude Tasks to ticket detail page",
      "passes": true,
      "overview": "Integrate the Claude Tasks component into the ticket detail page layout.",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "Implement as described",
        "Verify functionality works as expected"
      ],
      "references": [],
      "description": "## Overview\n\nIntegrate the Claude Tasks component into the ticket detail page layout.\n\n## Requirements\n\n- Add Claude Tasks section below description, above comments\n- Section should be collapsible (default expanded if tasks exist)\n- Show task count in section header\n- Ensure responsive layout works on all screen sizes\n\n## Layout\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Ticket: Investigate telemetry error     â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ Description                             â”‚\nâ”‚ [ticket description text...]            â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ Acceptance Criteria (3)                 â”‚\nâ”‚ [criteria list...]                      â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ ğŸ¤– Claude Tasks (5)              [â–¼]    â”‚  â† NEW\nâ”‚ [task list component...]                â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ Activity / Comments                     â”‚\nâ”‚ [comments list...]                      â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## Dependencies\n\n- Requires: \"Build UI component for Claude Tasks display\"\n- Requires: \"Add MCP tools for Claude Tasks management\"",
      "priority": "medium",
      "tags": [
        "frontend",
        "ui",
        "integration"
      ]
    },
    {
      "id": "8e93eb7d-7802-4815-bf0a-e3485a77c4f5",
      "title": "Add Claude Tasks section to Edit Ticket Modal (Kanban board)",
      "passes": true,
      "overview": "Integrate the Claude Tasks component into the Edit Ticket Modal (TicketModal.tsx) so users can see Claude's task breakdown when editing tickets from the kanban board view.",
      "types": [],
      "designDecisions": [],
      "implementationGuide": [],
      "acceptanceCriteria": [
        "ClaudeTasks component imported in TicketModal.tsx",
        "Claude Tasks section renders in edit modal",
        "Section is collapsible with default collapsed state",
        "Empty state handled gracefully (no section or \"No tasks recorded\")",
        "Real-time updates work when ticket is in progress"
      ],
      "references": [
        "src/components/tickets/ClaudeTasks.tsx",
        "src/routes/ticket.$id.tsx:473-475",
        "src/components/TicketModal.tsx"
      ],
      "description": "## Overview\n\nIntegrate the Claude Tasks component into the Edit Ticket Modal (TicketModal.tsx) so users can see Claude's task breakdown when editing tickets from the kanban board view.\n\n## Current State\n\n- âœ… Claude Tasks component exists: `src/components/tickets/ClaudeTasks.tsx`\n- âœ… Ticket Detail Page has Claude Tasks: `src/routes/ticket.$id.tsx:473-475`\n- âŒ **Edit Ticket Modal is missing Claude Tasks**: `src/components/TicketModal.tsx`\n\n## Requirements\n\n- Add Claude Tasks section to TicketModal below the AI Telemetry panel (around line 1549)\n- Use the existing `ClaudeTasks` component from `src/components/tickets/ClaudeTasks.tsx`\n- Section should be collapsible (default collapsed to save space in modal)\n- Only show section if ticket has recorded Claude tasks (use same pattern as ticket detail page)\n\n## Suggested Location\n\nAfter the `TelemetryPanel` component (line 1549) and before the Activity/Comments section:\n\n```tsx\n{/* AI Telemetry */}\n<TelemetryPanel ticketId={ticket.id} />\n\n{/* Claude Tasks - NEW */}\n<ClaudeTasks \n  ticketId={ticket.id} \n  ticketStatus={currentStatus} \n  defaultExpanded={false} \n/>\n\n{/* Activity / Comments */}\n```\n\n## Acceptance Criteria\n\n- [ ] ClaudeTasks component imported in TicketModal.tsx\n- [ ] Claude Tasks section renders in edit modal\n- [ ] Section is collapsible with default collapsed state\n- [ ] Empty state handled gracefully (no section or \"No tasks recorded\")\n- [ ] Real-time updates work when ticket is in progress",
      "priority": "high",
      "tags": [
        "ui",
        "claude-tasks",
        "modal",
        "kanban"
      ]
    }
  ],
  "projectContext": {
    "techStack": [
      "Framework: TanStack Start (React 19 + Vite + Nitro)",
      "Database: SQLite with better-sqlite3, Drizzle ORM",
      "Styling: Tailwind CSS v4",
      "State: TanStack Query for server state",
      "Drag & Drop: @dnd-kit"
    ],
    "dosDonts": [
      {
        "category": "Database Queries",
        "dos": [
          "Use Drizzle ORM: `db.select().from(tickets)`",
          "Use typed schema imports: `import { tickets } from \"../lib/schema\"`",
          "Use `eq()`, `and()`, `sql` from drizzle-orm for conditions",
          "Use transactions for multi-table operations: `db.transaction(() => {...})`",
          "Use `.get()` for single row, `.all()` for multiple"
        ],
        "donts": [
          "Raw SQL strings: `db.run(\"SELECT * FROM tickets\")`",
          "String-based table names",
          "String concatenation for WHERE clauses",
          "Multiple independent queries that should be atomic",
          "Assume query returns what you expect without checking"
        ]
      },
      {
        "category": "React & TanStack Query",
        "dos": [
          "Use `useQuery` with `queryKeys` for data fetching",
          "Use `useMutation` with `onSuccess` for state changes",
          "Invalidate queries after mutations: `queryClient.invalidateQueries({ queryKey: queryKeys.tickets })`",
          "Use centralized `queryKeys` object from `src/lib/hooks.ts`",
          "Create custom hooks in `src/lib/hooks.ts` for reusable query logic"
        ],
        "donts": [
          "`useState` + `useEffect` for fetched data",
          "Direct API calls without proper cache invalidation",
          "Manual cache manipulation or refetch after every change",
          "Hardcoded query key strings throughout components",
          "Duplicate query setup in multiple components"
        ]
      },
      {
        "category": "Styling Patterns",
        "dos": [
          "Use Tailwind classes for static styles: `className=\"p-4 bg-slate-800\"`",
          "Use CSS variables for theming: `var(--bg-primary)`, `var(--shadow-modal)`",
          "Reserve inline styles for dynamic/computed values: `style={{ width: `${percent}%` }}`",
          "Define shared style constants at module level for referential stability",
          "Use `React.CSSProperties` type for inline style objects when needed"
        ],
        "donts": [
          "Inline style objects for single-use styles",
          "Hardcoded colors that don't adapt to themes",
          "Mix Tailwind and inline styles inconsistently",
          "Create new objects inside components that are reused",
          "Untyped style objects that miss IDE autocomplete"
        ]
      },
      {
        "category": "Server Functions",
        "dos": [
          "Use `createServerFn({ method: \"GET\" })` for reads, `\"POST\"` for writes",
          "Use `.inputValidator()` for type-safe input handling",
          "Return typed data directly: `return db.select().from(tickets).all()`",
          "Use `ensureExists()` for required lookups: `ensureExists(project, \"Project\")`",
          "Import from `@tanstack/react-start` (not `@tanstack/react-start/server`)"
        ],
        "donts": [
          "Mix GET/POST inconsistently",
          "Access raw input without validation",
          "Wrap in unnecessary response objects",
          "Return null and let caller handle missing data",
          "Wrong import path"
        ]
      },
      {
        "category": "MCP Tool Implementation",
        "dos": [
          "Use Zod schemas for input validation: `{ ticketId: z.string() }`",
          "Return structured `{ content: [{ type: \"text\", text: ... }] }` format",
          "Set `isError: true` for error responses",
          "Use `log.info()` / `log.error()` from `../lib/logging.js`",
          "Include helpful error messages: `\"Project not found. Use list_projects to see available.\"`"
        ],
        "donts": [
          "Trust input without validation",
          "Return plain strings",
          "Return error text without the error flag",
          "`console.log` in MCP server code",
          "Generic \"Not found\" errors"
        ]
      },
      {
        "category": "Testing Patterns (Kent C. Dodds)",
        "dos": [
          "Test user behavior: what users see, click, and experience",
          "Integration tests for workflows: test components together",
          "Real database fixtures with actual schema",
          "Tests that fail when user-facing behavior breaks",
          "Ask: \"Does this test catch bugs users would encounter?\""
        ],
        "donts": [
          "Test implementation details, internal state, or private methods",
          "Unit tests for every function",
          "Excessive mocking of internals",
          "Tests that break on refactoring internals",
          "Chase 100% code coverage as a goal"
        ]
      }
    ],
    "verificationSteps": [
      "Run `pnpm type-check` - must pass with no errors",
      "Run `pnpm lint` - must pass with no errors",
      "Run `pnpm test` - all tests must pass",
      "Added tests for new functionality (ONLY tests that verify real user behavior - see Testing Philosophy above)",
      "Used typed error classes (not generic `Error`)",
      "Used Drizzle ORM (not raw SQL) - see DO/DON'T table above",
      "Followed existing patterns from DO/DON'T tables",
      "No hardcoded values that should be configurable",
      "Existing tests still pass",
      "No regressions in related functionality",
      "Updated tests if behavior changed",
      "Did not break backward compatibility (unless explicitly requested)",
      "Manually verified in browser at `localhost:4242`",
      "Checked responsive layout",
      "Verified TanStack Query invalidates and updates correctly",
      "Accessibility: keyboard navigation works, proper ARIA labels",
      "Migration file created via `pnpm db:generate`",
      "Migration tested with `pnpm db:migrate`",
      "Backup tested if schema changed (use `pnpm brain-dump backup` then test restore)",
      "Updated `src/lib/schema.ts` with proper types and constraints",
      "Tested tool via Claude Code integration",
      "Verified error responses are informative (see DO/DON'T table)",
      "Updated tool documentation if interface changed",
      "Added Zod schema for input validation",
      "All acceptance criteria from ticket met",
      "Work summary added via `add_ticket_comment` (for Ralph sessions)",
      "Session completed with appropriate outcome (for Ralph sessions)",
      "Committed with proper message format: `feat(<ticket-id>): <description>`"
    ]
  },
  "generatedAt": "2026-01-24T18:53:29.782Z",
  "epicTitle": "Claude Tasks Integration",
  "epicDescription": "Feature to capture and display the tasks that Claude creates (via TaskCreate/TaskList tools) when working on tickets. This provides visibility into Claude's work breakdown and planning for both interactive Claude sessions and Ralph autonomous mode."
}
